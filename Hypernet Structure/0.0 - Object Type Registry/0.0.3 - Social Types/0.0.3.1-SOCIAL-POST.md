# SOCIAL-POST - Social Media Post Object Type

**Type ID:** `hypernet.social.post`
**Version:** 1.0
**Category:** 0.0.3 - Social Types
**Parent:** BaseObject
**Status:** Active - Core Social Type
**Created:** 2026-02-09
**Last Updated:** 2026-02-09

---

## Object Type Metadata

```yaml
type_name: "SocialPost"
type_id: "hypernet.social.post"
version: "1.0"
parent_type: "BaseObject"
category: "0.0.3 - Social Types"
abstract: false
instantiable: true
```

---

## Purpose and Description

### What is a SocialPost?

The SocialPost object type represents any content published to a social media platform. This includes Instagram posts, Facebook updates, Twitter/X tweets, LinkedIn articles, TikTok videos, and more. SocialPost preserves the complete social graph and engagement data associated with each post, enabling users to own their social media history permanently.

### Revolutionary Design Philosophy

Hypernet treats social posts as permanent, owned content separate from platforms:
- **Platform Agnostic** - Unified schema for all social platforms (Instagram, Facebook, Twitter, etc.)
- **Complete Preservation** - Captures content, metadata, engagement, and social context
- **Relationship Rich** - Links to media, accounts, mentions, hashtags, and comments
- **Timeline Reconstruction** - Rebuild complete social media timeline across all platforms
- **Content Liberation** - Free your posts from platform lock-in and algorithmic feeds
- **Analytics Preservation** - Keep engagement metrics even after platform deletion

### Core Functions

1. **Content Archival** - Permanently store all social media posts
2. **Engagement Tracking** - Preserve likes, comments, shares, and other metrics
3. **Cross-Platform Unification** - View unified timeline across all social networks
4. **Search and Discovery** - Full-text search across all posts and comments
5. **Relationship Mapping** - Track mentions, tags, and social connections
6. **Export and Backup** - Download complete social media archive

### When to Use

- Importing posts from Instagram, Facebook, Twitter, LinkedIn, TikTok
- Archiving social media content before deleting accounts
- Creating unified social media timeline
- Analyzing posting patterns and engagement over time
- Preserving memories and significant life events shared on social media
- Building personal portfolio from social media content

---

## Inherited Fields from BaseObject

```yaml
id: UUID
  - Globally unique post identifier
  - Generated on import

created_at: DateTime
  - Import timestamp (when added to Hypernet)
  - Immutable
  - May differ from posted_at (original publish time)

updated_at: DateTime
  - Last modification timestamp
  - Auto-updated on any field change

deleted_at: DateTime (nullable)
  - Soft delete timestamp
  - Null for active posts
  - Posts preserved indefinitely unless user deletes

user_id: UUID
  - Foreign key to User who owns this post
  - Required - all posts must have an owner
  - Typically the user who published the post
  - Immutable

metadata: JSONB
  - Extensible metadata storage
  - See Metadata Schema section below
  - Stores platform-specific data and engagement details
```

---

## Required Fields

### Post Identity

```yaml
platform: String(50)
  type: String
  max_length: 50
  nullable: false
  indexed: true
  description: "Social media platform where post was published"
  allowed_values:
    - "instagram"
    - "facebook"
    - "twitter"
    - "linkedin"
    - "tiktok"
    - "youtube"
    - "reddit"
    - "threads"
    - "mastodon"
    - "other"
  examples:
    - "instagram" (photos/videos)
    - "twitter" (tweets)
    - "linkedin" (professional posts)

platform_id: String(200)
  type: String
  max_length: 200
  nullable: false
  indexed: true
  unique: "Per platform+user combination"
  description: "Unique post ID from platform"
  examples:
    - Instagram: "2847593720193"
    - Twitter: "1234567890123456789"
    - Facebook: "user_id_post_id"
  purpose: "Prevent duplicate imports, link to original"
  constraints:
    - Composite unique with (user_id, platform, platform_id)

post_type: Enum
  type: String
  max_length: 20
  nullable: false
  indexed: true
  description: "Type of social media post"
  allowed_values:
    - "photo": Single photo or photo carousel
    - "video": Video post
    - "text": Text-only post
    - "link": Link share with preview
    - "story": Ephemeral story (24-hour content)
    - "reel": Short-form video (Instagram Reels, TikTok)
    - "live": Live stream recording
    - "article": Long-form article (LinkedIn, Medium)
  derivation: "Auto-detected from platform data and media type"
```

### Temporal Information

```yaml
posted_at: DateTime
  type: DateTime
  nullable: false
  indexed: true
  timezone: true
  description: "Original publication timestamp from platform"
  usage: "Primary field for timeline reconstruction"
  sources:
    - Instagram: timestamp field
    - Twitter: created_at field
    - Platform API timestamp
  importance: "Critical for chronological ordering"
```

---

## Optional Fields

### Content

```yaml
text_content: Text
  type: Text
  nullable: true
  max_length: 100000
  description: "Post caption, body text, or tweet content"
  examples:
    - Instagram caption with hashtags
    - Tweet text (280 chars)
    - LinkedIn article body
    - Facebook status update
  searchable: true
  format: "Plain text, may include hashtags and mentions"
  constraints:
    - Platform-specific length limits preserved in metadata

title: String(500)
  type: String
  max_length: 500
  nullable: true
  indexed: true
  description: "Post title (for articles, videos, etc.)"
  applicable: "LinkedIn articles, YouTube videos, blog posts"
  searchable: true

link_url: String(2000)
  type: String
  max_length: 2000
  nullable: true
  description: "External link shared in post"
  examples:
    - "https://example.com/article"
    - "https://youtube.com/watch?v=abc123"
  applicable: "post_type = 'link' or link shares"

permalink: String(1000)
  type: String
  max_length: 1000
  nullable: true
  indexed: true
  description: "Permanent URL to original post on platform"
  examples:
    - "https://www.instagram.com/p/ABC123/"
    - "https://twitter.com/user/status/123456"
    - "https://www.linkedin.com/posts/activity-id"
  purpose: "Link back to original, verify authenticity"
  behavior: "May become invalid if user deletes platform post"
```

### Location

```yaml
location_name: String(500)
  type: String
  max_length: 500
  nullable: true
  indexed: true
  description: "Location tag from platform"
  examples:
    - "Golden Gate Bridge, San Francisco"
    - "New York, NY"
    - "Home"
  sources: "Platform location tag"
  searchable: true

latitude: Decimal(10,8)
  type: Decimal
  precision: 10
  scale: 8
  nullable: true
  indexed: true
  description: "GPS latitude if available"
  range: "-90.0 to 90.0"
  sources: "Media EXIF or platform location"

longitude: Decimal(11,8)
  type: Decimal
  precision: 11
  scale: 8
  nullable: true
  indexed: true
  description: "GPS longitude if available"
  range: "-180.0 to 180.0"
```

### Engagement Metrics

```yaml
like_count: Integer
  type: Integer
  nullable: false
  default: 0
  indexed: true
  description: "Number of likes/reactions"
  platform_names:
    - Instagram: "likes"
    - Facebook: "reactions"
    - Twitter: "likes"
    - LinkedIn: "reactions"
  constraints:
    - Must be >= 0
    - Snapshot at import time (may not reflect current count)

comment_count: Integer
  type: Integer
  nullable: false
  default: 0
  indexed: true
  description: "Number of comments/replies"
  constraints:
    - Must be >= 0
    - Top-level comments only (nested replies in metadata)

share_count: Integer
  type: Integer
  nullable: false
  default: 0
  indexed: true
  description: "Number of shares/retweets/reposts"
  platform_names:
    - Instagram: "shares to stories"
    - Facebook: "shares"
    - Twitter: "retweets"
    - LinkedIn: "shares"
  constraints: "Must be >= 0"

view_count: Integer
  type: Integer
  nullable: true
  indexed: true
  description: "Number of views (video posts, stories)"
  applicable: "Videos, Reels, Stories, TikTok"
  constraints: "Must be >= 0 if provided"

engagement_rate: Decimal(5,4)
  type: Decimal
  precision: 5
  scale: 4
  nullable: true
  description: "Calculated engagement rate (0.0 to 1.0)"
  formula: "(likes + comments + shares) / followers_at_time"
  computed: true
  usage: "Analytics and post performance comparison"
```

### Visibility and Status

```yaml
visibility: Enum
  type: String
  max_length: 20
  nullable: false
  default: "public"
  indexed: true
  description: "Post visibility/privacy setting on platform"
  allowed_values:
    - "public": Visible to everyone
    - "followers": Visible to followers only
    - "friends": Visible to friends only (Facebook)
    - "private": Private/hidden post
    - "unlisted": Not shown in feeds but accessible via link
  sources: "Platform privacy settings at post time"

is_archived: Boolean
  type: Boolean
  nullable: false
  default: false
  description: "Whether post was archived on platform"
  applicable: "Instagram archive feature"

is_pinned: Boolean
  type: Boolean
  nullable: false
  default: false
  description: "Whether post was pinned to profile"
  applicable: "Twitter pinned tweets, Instagram pinned posts"
```

### Platform-Specific

```yaml
hashtags: JSONB
  type: JSONB
  nullable: false
  default: []
  description: "Array of hashtag strings extracted from content"
  structure: ["hashtag1", "hashtag2"]
  examples:
    - ["sunset", "travel", "photography"]
    - ["tech", "ai", "innovation"]
  searchable: true
  indexed: "GIN index for containment queries"
  extraction: "Parsed from text_content"

mentions: JSONB
  type: JSONB
  nullable: false
  default: []
  description: "Array of mentioned user handles"
  structure: ["@username1", "@username2"]
  examples:
    - ["@friend", "@company"]
  searchable: true
  purpose: "Track social connections and collaborations"

filter_name: String(100)
  type: String
  max_length: 100
  nullable: true
  description: "Photo/video filter applied"
  applicable: "Instagram, TikTok"
  examples:
    - "Clarendon"
    - "Valencia"
    - "No Filter"

is_sponsored: Boolean
  type: Boolean
  nullable: false
  default: false
  description: "Whether post was sponsored/branded content"
  sources: "Platform sponsored post indicator"
```

### Relationships

```yaml
account_id: UUID
  type: UUID
  nullable: true
  indexed: true
  description: "Foreign key to SocialAccount that published this post"
  references: "SocialAccount.id"
  cascade: "ON DELETE SET NULL"
  purpose: "Link post to specific social media account"

integration_id: UUID
  type: UUID
  nullable: true
  indexed: true
  description: "Foreign key to Integration that imported this post"
  references: "Integration.id"
  cascade: "ON DELETE SET NULL"

reply_to_post_id: UUID
  type: UUID
  nullable: true
  indexed: true
  description: "Foreign key to post this is replying to"
  references: "SocialPost.id"
  cascade: "ON DELETE SET NULL"
  applicable: "Twitter replies, comment threads"
  creates: "Parent-child relationship between posts"

repost_of_post_id: UUID
  type: UUID
  nullable: true
  indexed: true
  description: "Foreign key to original post if this is a repost/retweet"
  references: "SocialPost.id"
  cascade: "ON DELETE SET NULL"
  applicable: "Twitter retweets, Facebook shares"
```

---

## Metadata Schema

The `metadata` JSONB field stores platform-specific data and rich engagement details:

```json
{
  "platform_data": {
    "instagram": {
      "media_type": "IMAGE",
      "is_carousel": true,
      "carousel_count": 5,
      "filter": "Clarendon",
      "is_partner_post": false,
      "comments_disabled": false,
      "tagged_users": [
        {"username": "friend1", "user_id": "123"},
        {"username": "friend2", "user_id": "456"}
      ]
    },
    "twitter": {
      "tweet_id": "1234567890123456789",
      "in_reply_to_status_id": "9876543210",
      "retweet_count": 42,
      "quote_count": 15,
      "is_quote_status": false,
      "possibly_sensitive": false,
      "lang": "en"
    },
    "linkedin": {
      "urn": "urn:li:activity:1234567890",
      "article_url": "https://linkedin.com/pulse/...",
      "impressions": 5420,
      "clicks": 234
    }
  },
  "engagement_details": {
    "top_comments": [
      {
        "user": "username1",
        "text": "Amazing photo!",
        "timestamp": "2024-02-09T15:30:00Z",
        "likes": 12
      }
    ],
    "reactions_breakdown": {
      "like": 245,
      "love": 87,
      "wow": 23,
      "haha": 5
    },
    "engagement_timeline": [
      {"hour": 1, "likes": 50, "comments": 3},
      {"hour": 2, "likes": 120, "comments": 8}
    ]
  },
  "media_ids": [
    "media-uuid-1",
    "media-uuid-2",
    "media-uuid-3"
  ],
  "audience": {
    "followers_at_time": 1250,
    "reach": 3400,
    "impressions": 5600,
    "countries": ["US", "UK", "CA"],
    "age_ranges": {"18-24": 0.3, "25-34": 0.45, "35-44": 0.25}
  },
  "edit_history": [
    {
      "edited_at": "2024-02-09T16:00:00Z",
      "previous_text": "Original caption text",
      "change_type": "caption_edit"
    }
  ]
}
```

---

## Relationships to Other Object Types

### Ownership

```yaml
owned_by: User
  description: "User who owns this post (usually the author)"
  cardinality: "N:1 (many posts, one owner)"
  implementation: "user_id foreign key"
  cascade: "ON DELETE CASCADE"

published_by: SocialAccount
  description: "Social media account that published this post"
  cardinality: "N:1 (many posts, one account)"
  implementation: "account_id foreign key"
  cascade: "ON DELETE SET NULL"

imported_by: Integration
  description: "Integration that imported this post"
  cardinality: "N:1 (many posts, one integration)"
  implementation: "integration_id foreign key"
  cascade: "ON DELETE SET NULL"
```

### Media Attachments

```yaml
contains_media: Media
  description: "Media items attached to this post"
  cardinality: "M:N (many posts, many media)"
  link_type: "post_media"
  implementation: "Join table with ordering"
  examples:
    - Instagram carousel: 5 photos
    - Tweet with video
    - Facebook post with multiple photos

cover_media: Media
  description: "Primary/cover media for post thumbnail"
  cardinality: "N:1 (many posts, one cover)"
  implementation: "First media in post or explicit cover selection"
```

### Social Graph

```yaml
mentions: User
  description: "Users mentioned/tagged in post"
  cardinality: "M:N (many posts, many users)"
  link_type: "post_mentions"
  extraction: "Parsed from text_content and platform tag data"

reply_to: SocialPost
  description: "Original post this is replying to"
  cardinality: "N:1 (many replies, one parent)"
  implementation: "reply_to_post_id foreign key"
  creates: "Comment thread hierarchy"

repost_of: SocialPost
  description: "Original post if this is a repost/share"
  cardinality: "N:1 (many reposts, one original)"
  implementation: "repost_of_post_id foreign key"
```

---

## API Endpoints

### Post Import

```http
POST /api/v1/social/posts/import
  Description: Import posts from platform (called by integration sync)
  Headers:
    Authorization: Bearer {access_token}
  Request Body:
    {
      "platform": "instagram",
      "integration_id": "integration-uuid",
      "account_id": "account-uuid",
      "posts": [
        {
          "platform_id": "2847593720193",
          "post_type": "photo",
          "text_content": "Beautiful sunset! #sunset #beach",
          "posted_at": "2024-02-09T18:30:00Z",
          "permalink": "https://instagram.com/p/ABC123/",
          "like_count": 324,
          "comment_count": 18,
          "media_ids": ["media-uuid-1"]
        }
      ]
    }
  Response: 201 Created
    {
      "imported_count": 1,
      "skipped_count": 0,
      "posts": [{created post objects}]
    }
  Behavior:
    - Deduplicate by (user_id, platform, platform_id)
    - Link to existing Media objects
    - Extract hashtags and mentions
```

### Post Retrieval

```http
GET /api/v1/social/posts/{id}
  Description: Get post details
  Headers:
    Authorization: Bearer {access_token}
  Response: 200 OK
    {complete post object with media and engagement}
  Privacy:
    - Only owner can access
    - Returns 404 if not found or unauthorized

GET /api/v1/social/posts/{id}/media
  Description: Get media attached to post
  Headers:
    Authorization: Bearer {access_token}
  Response: 200 OK
    {
      "media": [{media objects}],
      "count": 5
    }

GET /api/v1/social/posts/{id}/comments
  Description: Get comments on post (from metadata)
  Headers:
    Authorization: Bearer {access_token}
  Query Parameters:
    limit: 50
    offset: 0
  Response: 200 OK
    {
      "comments": [{comment objects from metadata}],
      "total": 18
    }
```

### Timeline and Search

```http
GET /api/v1/social/posts
  Description: Get user's social media timeline (all platforms)
  Headers:
    Authorization: Bearer {access_token}
  Query Parameters:
    platform: instagram|facebook|twitter (filter by platform)
    post_type: photo|video|text|link
    account_id: {account-uuid} (filter by specific account)
    date_from: 2024-01-01
    date_to: 2024-12-31
    has_media: true|false
    min_likes: 100 (minimum like count)
    hashtag: {hashtag} (posts with specific hashtag)
    mention: @username (posts mentioning user)
    search: "query text" (full-text search)
    limit: 50 (default: 50, max: 200)
    offset: 0
    sort: posted_at|like_count|comment_count (default: posted_at)
    order: asc|desc (default: desc)
  Response: 200 OK
    {
      "posts": [{post objects}],
      "total": 1543,
      "limit": 50,
      "offset": 0
    }

GET /api/v1/social/posts/timeline
  Description: Unified timeline view (all platforms chronologically)
  Headers:
    Authorization: Bearer {access_token}
  Query Parameters:
    year: 2024 (filter by year)
    month: 2 (filter by month)
    limit: 50
  Response: 200 OK
    {
      "timeline": [
        {
          "date": "2024-02-09",
          "posts": [{post objects}],
          "count": 3
        }
      ]
    }
```

### Analytics

```http
GET /api/v1/social/posts/analytics
  Description: Get posting and engagement analytics
  Headers:
    Authorization: Bearer {access_token}
  Query Parameters:
    platform: instagram|all
    date_from: 2024-01-01
    date_to: 2024-12-31
  Response: 200 OK
    {
      "total_posts": 347,
      "total_likes": 15678,
      "total_comments": 892,
      "avg_engagement_rate": 0.0456,
      "top_posts": [{post objects}],
      "posting_frequency": {
        "daily_avg": 1.2,
        "by_day_of_week": {...},
        "by_hour": {...}
      },
      "top_hashtags": [
        {"hashtag": "sunset", "count": 45},
        {"hashtag": "travel", "count": 32}
      ],
      "platform_breakdown": {
        "instagram": 245,
        "twitter": 102
      }
    }
```

### Post Management

```http
PATCH /api/v1/social/posts/{id}
  Description: Update post metadata (local only, not synced to platform)
  Headers:
    Authorization: Bearer {access_token}
  Request Body:
    {
      "text_content": "Updated caption",
      "hashtags": ["new", "tags"]
    }
  Response: 200 OK
    {updated post object}
  Note: "Updates Hypernet copy only, does not modify platform post"

DELETE /api/v1/social/posts/{id}
  Description: Soft delete post
  Headers:
    Authorization: Bearer {access_token}
  Response: 204 No Content
  Behavior:
    - Sets deleted_at timestamp
    - Post preserved indefinitely
    - Media not deleted (may be used elsewhere)
```

---

## Database Schema (SQLAlchemy Model Reference)

```python
from sqlalchemy import (
    Column, String, Integer, Decimal, Enum as SQLEnum,
    DateTime, Boolean, ForeignKey, Index, CheckConstraint, Text
)
from sqlalchemy.dialects.postgresql import UUID, JSONB
from sqlalchemy.orm import relationship
from app.models.base import BaseObject

class SocialPost(BaseObject):
    """
    Social media post from any platform

    Inherits from BaseObject: id, user_id, created_at, updated_at, deleted_at, metadata
    """

    __tablename__ = "social_posts"

    # Post Identity (Required)
    platform = Column(
        String(50),
        nullable=False,
        index=True,
        doc="Social media platform"
    )
    platform_id = Column(
        String(200),
        nullable=False,
        index=True,
        doc="Unique post ID from platform"
    )
    post_type = Column(
        SQLEnum('photo', 'video', 'text', 'link', 'story', 'reel', 'live', 'article',
                name='post_type_enum'),
        nullable=False,
        index=True,
        doc="Type of post"
    )

    # Temporal (Required)
    posted_at = Column(
        DateTime(timezone=True),
        nullable=False,
        index=True,
        doc="Original publication timestamp"
    )

    # Content (Optional)
    text_content = Column(
        Text,
        nullable=True,
        doc="Post caption or body text"
    )
    title = Column(
        String(500),
        nullable=True,
        index=True,
        doc="Post title (articles, videos)"
    )
    link_url = Column(
        String(2000),
        nullable=True,
        doc="External link shared in post"
    )
    permalink = Column(
        String(1000),
        nullable=True,
        index=True,
        doc="Permanent URL to original post"
    )

    # Location (Optional)
    location_name = Column(
        String(500),
        nullable=True,
        index=True,
        doc="Location tag from platform"
    )
    latitude = Column(
        Numeric(10, 8),
        nullable=True,
        index=True,
        doc="GPS latitude"
    )
    longitude = Column(
        Numeric(11, 8),
        nullable=True,
        index=True,
        doc="GPS longitude"
    )

    # Engagement Metrics (Optional)
    like_count = Column(
        Integer,
        nullable=False,
        default=0,
        index=True,
        doc="Number of likes/reactions"
    )
    comment_count = Column(
        Integer,
        nullable=False,
        default=0,
        index=True,
        doc="Number of comments"
    )
    share_count = Column(
        Integer,
        nullable=False,
        default=0,
        index=True,
        doc="Number of shares/retweets"
    )
    view_count = Column(
        Integer,
        nullable=True,
        index=True,
        doc="Number of views (videos/stories)"
    )
    engagement_rate = Column(
        Numeric(5, 4),
        nullable=True,
        doc="Calculated engagement rate"
    )

    # Visibility and Status (Optional)
    visibility = Column(
        SQLEnum('public', 'followers', 'friends', 'private', 'unlisted',
                name='post_visibility_enum'),
        nullable=False,
        default='public',
        index=True,
        doc="Post visibility setting"
    )
    is_archived = Column(
        Boolean,
        nullable=False,
        default=False,
        doc="Whether post was archived"
    )
    is_pinned = Column(
        Boolean,
        nullable=False,
        default=False,
        doc="Whether post was pinned"
    )

    # Platform-Specific (Optional)
    hashtags = Column(
        JSONB,
        nullable=False,
        default=[],
        doc="Array of hashtag strings"
    )
    mentions = Column(
        JSONB,
        nullable=False,
        default=[],
        doc="Array of mentioned usernames"
    )
    filter_name = Column(
        String(100),
        nullable=True,
        doc="Photo/video filter applied"
    )
    is_sponsored = Column(
        Boolean,
        nullable=False,
        default=False,
        doc="Whether post was sponsored content"
    )

    # Relationships (Optional)
    account_id = Column(
        UUID(as_uuid=True),
        ForeignKey('social_accounts.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        doc="Social account that published this"
    )
    integration_id = Column(
        UUID(as_uuid=True),
        ForeignKey('integrations.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        doc="Integration that imported this"
    )
    reply_to_post_id = Column(
        UUID(as_uuid=True),
        ForeignKey('social_posts.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        doc="Post this is replying to"
    )
    repost_of_post_id = Column(
        UUID(as_uuid=True),
        ForeignKey('social_posts.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        doc="Original post if repost"
    )

    # Relationships
    owner = relationship("User", foreign_keys=[BaseObject.user_id])
    account = relationship("SocialAccount", foreign_keys=[account_id])
    integration = relationship("Integration", foreign_keys=[integration_id])

    media = relationship(
        "Media",
        secondary="post_media",
        back_populates="posts"
    )

    reply_to_post = relationship(
        "SocialPost",
        remote_side="SocialPost.id",
        foreign_keys=[reply_to_post_id]
    )
    repost_of_post = relationship(
        "SocialPost",
        remote_side="SocialPost.id",
        foreign_keys=[repost_of_post_id]
    )

    # Table Constraints
    __table_args__ = (
        # Composite unique constraint (prevent duplicate imports)
        Index('idx_social_posts_unique',
              'user_id', 'platform', 'platform_id',
              unique=True),

        # Engagement counts must be non-negative
        CheckConstraint('like_count >= 0', name='check_like_count'),
        CheckConstraint('comment_count >= 0', name='check_comment_count'),
        CheckConstraint('share_count >= 0', name='check_share_count'),
        CheckConstraint('view_count IS NULL OR view_count >= 0',
                        name='check_view_count'),

        # Latitude/longitude ranges
        CheckConstraint(
            'latitude IS NULL OR (latitude >= -90 AND latitude <= 90)',
            name='check_latitude_range'
        ),
        CheckConstraint(
            'longitude IS NULL OR (longitude >= -180 AND longitude <= 180)',
            name='check_longitude_range'
        ),

        # Composite indexes
        Index('idx_social_posts_platform', 'platform', 'posted_at'),
        Index('idx_social_posts_posted_at', 'posted_at'),
        Index('idx_social_posts_engagement', 'like_count', 'comment_count'),
        Index('idx_social_posts_account', 'account_id', 'posted_at'),

        # GIN indexes for arrays
        Index('idx_social_posts_hashtags', 'hashtags', postgresql_using='gin'),
        Index('idx_social_posts_mentions', 'mentions', postgresql_using='gin'),

        # Full-text search index
        # Index for text_content (implementation-specific)
    )

    def __repr__(self):
        return f"<SocialPost(id={self.id}, platform={self.platform}, type={self.post_type})>"

    @property
    def total_engagement(self):
        """Calculate total engagement"""
        return self.like_count + self.comment_count + self.share_count

    @property
    def has_location(self):
        return self.latitude is not None and self.longitude is not None
```

---

## Privacy and Security Considerations

### Access Control

1. **Ownership Enforcement**
   - Posts only accessible by owner
   - No public sharing (posts remain private archives)
   - Platform privacy settings preserved in visibility field

2. **Platform Connection**
   - Permalink may expose platform username
   - User can choose to strip permalinks on import
   - Original post may be deleted from platform

### Data Protection

1. **Location Privacy**
   - GPS coordinates stripped if user preference set
   - Location names preserved for context
   - User can bulk-remove location data

2. **Content Preservation**
   - Complete archive even if platform account deleted
   - Comments and engagement preserved
   - Cannot be modified by platform algorithm changes

3. **GDPR Compliance**
   - User can export all posts and media
   - User can delete posts (soft delete)
   - Platform identifiers preserved for provenance

---

## Validation Rules

### On Import

```yaml
platform:
  - Must be valid platform identifier
  - Required

platform_id:
  - Required
  - Must be unique per (user_id, platform, platform_id)

posted_at:
  - Required
  - Must be valid timestamp
  - Cannot be in future

engagement_counts:
  - Must be >= 0
  - Default to 0 if not provided
```

### On Update

```yaml
immutable_fields:
  - id, user_id
  - platform, platform_id
  - posted_at
  - created_at

mutable_fields:
  - text_content (local edit only)
  - hashtags, mentions (manual correction)
  - engagement counts (manual update)
```

---

## Use Cases and Examples

### Example 1: Instagram Photo Post

```json
{
  "id": "post-550e8400-e29b-41d4-a716-446655440000",
  "user_id": "user-uuid",
  "platform": "instagram",
  "platform_id": "2847593720193",
  "post_type": "photo",
  "posted_at": "2024-02-09T18:30:00Z",
  "text_content": "Beautiful sunset at the beach! Perfect end to an amazing day. #sunset #beach #california #photography",
  "permalink": "https://www.instagram.com/p/ABC123/",
  "location_name": "Santa Monica Beach, CA",
  "latitude": 34.0195,
  "longitude": -118.4912,
  "like_count": 324,
  "comment_count": 18,
  "share_count": 12,
  "visibility": "public",
  "hashtags": ["sunset", "beach", "california", "photography"],
  "mentions": [],
  "filter_name": "Clarendon",
  "account_id": "social-account-uuid",
  "integration_id": "integration-uuid",
  "metadata": {
    "platform_data": {
      "instagram": {
        "media_type": "IMAGE",
        "filter": "Clarendon"
      }
    },
    "media_ids": ["media-uuid-1"]
  },
  "created_at": "2024-02-10T08:00:00Z",
  "updated_at": "2024-02-10T08:00:00Z"
}
```

### Example 2: Twitter Thread Reply

```json
{
  "id": "post-660e8400-e29b-41d4-a716-446655440001",
  "user_id": "user-uuid",
  "platform": "twitter",
  "platform_id": "1234567890123456789",
  "post_type": "text",
  "posted_at": "2024-02-09T14:22:00Z",
  "text_content": "@friend Totally agree! This is exactly what we discussed last week. The implications are huge for the industry.",
  "permalink": "https://twitter.com/user/status/1234567890123456789",
  "like_count": 15,
  "comment_count": 3,
  "share_count": 2,
  "visibility": "public",
  "hashtags": [],
  "mentions": ["@friend"],
  "account_id": "social-account-uuid",
  "reply_to_post_id": "parent-post-uuid",
  "metadata": {
    "platform_data": {
      "twitter": {
        "in_reply_to_status_id": "9876543210",
        "lang": "en"
      }
    }
  }
}
```

### Example 3: LinkedIn Article

```json
{
  "id": "post-770e8400-e29b-41d4-a716-446655440002",
  "user_id": "user-uuid",
  "platform": "linkedin",
  "platform_id": "activity-6789",
  "post_type": "article",
  "posted_at": "2024-02-08T09:00:00Z",
  "title": "The Future of Personal Data Ownership",
  "text_content": "In this article, I explore why personal data ownership will be the defining challenge of the next decade...",
  "permalink": "https://www.linkedin.com/posts/activity-6789",
  "like_count": 187,
  "comment_count": 42,
  "share_count": 56,
  "view_count": 5420,
  "visibility": "public",
  "hashtags": ["data", "privacy", "technology"],
  "account_id": "social-account-uuid",
  "metadata": {
    "platform_data": {
      "linkedin": {
        "impressions": 5420,
        "clicks": 234
      }
    },
    "audience": {
      "followers_at_time": 2340
    }
  }
}
```

---

## Lifecycle States

### 1. Imported

```yaml
state: "imported"
behavior:
  - Freshly imported from platform
  - Media linked
  - Hashtags extracted
transitions:
  - archive -> Archived
  - delete -> Deleted
```

### 2. Active

```yaml
state: "active"
behavior:
  - Searchable in timeline
  - Included in analytics
  - Media accessible
transitions:
  - delete -> Deleted
```

### 3. Deleted

```yaml
state: "deleted"
deleted_at: not null
behavior:
  - Hidden from timeline
  - Preserved indefinitely
  - Can be restored
transitions:
  - restore -> Active
```

---

## Notes for Implementers

### Performance Optimization

1. **Timeline Queries**
   - Index on (user_id, posted_at)
   - Paginate with cursor-based pagination
   - Cache timeline pages (1 minute TTL)

2. **Search**
   - Full-text search on text_content
   - GIN indexes for hashtags and mentions arrays
   - Consider Elasticsearch for advanced search

3. **Analytics**
   - Pre-compute aggregations
   - Cache analytics results (1 hour TTL)
   - Use materialized views for complex queries

---

**Status:** Active - Core Social Type
**Version:** 1.0
**Authority:** 0.0.3 - Social Types
**Created:** 2026-02-09
**Owner:** Hypernet Core (0.*)
