{
  "address": "0.1.1.4.5.3",
  "type_address": null,
  "data": {
    "name": "auth.py",
    "type": "file",
    "extension": ".py",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\routes\\auth.py",
    "size": 4100,
    "content": "\"\"\"\nAuthentication Routes\n\nEndpoints for user registration, login, token refresh, and logout.\n\"\"\"\n\nfrom fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom pydantic import BaseModel, EmailStr, Field\nfrom datetime import datetime\n\nfrom app.core.database import get_db\nfrom app.core.security import hash_password, verify_password, create_access_token, create_refresh_token\nfrom app.models.user import User\n\nrouter = APIRouter()\n\n\n# Request/Response Models\nclass RegisterRequest(BaseModel):\n    \"\"\"User registration request\"\"\"\n    email: EmailStr\n    password: str = Field(min_length=12, description=\"Minimum 12 characters\")\n    display_name: str | None = Field(None, max_length=100)\n\n\nclass LoginRequest(BaseModel):\n    \"\"\"User login request\"\"\"\n    email: EmailStr\n    password: str\n\n\nclass TokenResponse(BaseModel):\n    \"\"\"Token response\"\"\"\n    access_token: str\n    refresh_token: str\n    token_type: str = \"Bearer\"\n    expires_in: int\n\n\nclass UserResponse(BaseModel):\n    \"\"\"User information response\"\"\"\n    id: str\n    email: str\n    display_name: str | None\n    email_verified: bool\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\n\n@router.post(\"/register\", response_model=dict, status_code=status.HTTP_201_CREATED)\nasync def register(request: RegisterRequest, db: Session = Depends(get_db)):\n    \"\"\"\n    Register a new user account\n\n    - **email**: Valid email address (will be verified later)\n    - **password**: Minimum 12 characters (add complexity requirements later)\n    - **display_name**: Optional display name\n\n    Returns user information and authentication tokens.\n    \"\"\"\n    # Check if email already exists\n    existing_user = db.query(User).filter(User.email == request.email).first()\n    if existing_user:\n        raise HTTPException(\n            status_code=status.HTTP_409_CONFLICT,\n            detail=\"Email already registered\"\n        )\n\n    # Create new user\n    user = User(\n        email=request.email,\n        password_hash=hash_password(request.password),\n        display_name=request.display_name,\n    )\n\n    db.add(user)\n    db.commit()\n    db.refresh(user)\n\n    # Generate tokens\n    access_token = create_access_token(data={\"sub\": str(user.id)})\n    refresh_token = create_refresh_token(data={\"sub\": str(user.id)})\n\n    return {\n        \"user\": UserResponse.model_validate(user),\n        \"access_token\": access_token,\n        \"refresh_token\": refresh_token,\n        \"token_type\": \"Bearer\",\n        \"expires_in\": 900,  # 15 minutes\n    }\n\n\n@router.post(\"/login\", response_model=dict)\nasync def login(request: LoginRequest, db: Session = Depends(get_db)):\n    \"\"\"\n    Authenticate user and get tokens\n\n    - **email**: User's email address\n    - **password**: User's password\n\n    Returns authentication tokens on success.\n    \"\"\"\n    # Find user\n    user = db.query(User).filter(User.email == request.email).first()\n    if not user or not verify_password(request.password, user.password_hash):\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Incorrect email or password\"\n        )\n\n    # Check if account is active\n    if not user.is_active:\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Account is disabled\"\n        )\n\n    # Update last login\n    user.last_login_at = datetime.utcnow()\n    db.commit()\n\n    # Generate tokens\n    access_token = create_access_token(data={\"sub\": str(user.id)})\n    refresh_token = create_refresh_token(data={\"sub\": str(user.id)})\n\n    return {\n        \"user\": UserResponse.model_validate(user),\n        \"access_token\": access_token,\n        \"refresh_token\": refresh_token,\n        \"token_type\": \"Bearer\",\n        \"expires_in\": 900,\n    }\n\n\n@router.get(\"/test\", include_in_schema=False)\nasync def test_auth():\n    \"\"\"Test endpoint to verify auth routes are working\"\"\"\n    return {\"message\": \"Auth routes working!\"}\n"
  },
  "created_at": "2026-02-15T11:53:48.499130+00:00",
  "updated_at": "2026-02-15T11:53:48.499130+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:auth.py"
}