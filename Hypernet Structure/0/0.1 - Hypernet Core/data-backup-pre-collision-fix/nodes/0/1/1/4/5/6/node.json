{
  "address": "0.1.1.4.5.6",
  "type_address": null,
  "data": {
    "name": "contacts.py",
    "type": "file",
    "extension": ".py",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\routes\\contacts.py",
    "size": 8369,
    "content": "\"\"\"\nContacts Routes\n\nEndpoints for managing address book contacts.\n\"\"\"\n\nfrom fastapi import APIRouter, Depends, HTTPException, status, Query\nfrom sqlalchemy.orm import Session\nfrom sqlalchemy import and_, or_\nfrom pydantic import BaseModel, Field, EmailStr\nfrom datetime import datetime\nfrom typing import Optional, List\nfrom uuid import UUID\n\nfrom app.core.database import get_db\nfrom app.core.dependencies import get_current_user\nfrom app.models.user import User\nfrom app.models.contact import Contact\n\nrouter = APIRouter()\n\n\n# Request/Response Models\nclass ContactCreate(BaseModel):\n    \"\"\"Contact creation request\"\"\"\n    display_name: str = Field(..., max_length=200)\n    first_name: Optional[str] = Field(None, max_length=100)\n    last_name: Optional[str] = Field(None, max_length=100)\n    email_addresses: Optional[List[str]] = None\n    phone_numbers: Optional[List[str]] = None\n    company: Optional[str] = Field(None, max_length=200)\n    job_title: Optional[str] = Field(None, max_length=200)\n    birthday: Optional[datetime] = None\n    notes: Optional[str] = None\n    profile_photo_id: Optional[UUID] = None\n\n\nclass ContactUpdate(BaseModel):\n    \"\"\"Contact update request\"\"\"\n    display_name: Optional[str] = Field(None, max_length=200)\n    first_name: Optional[str] = Field(None, max_length=100)\n    last_name: Optional[str] = Field(None, max_length=100)\n    email_addresses: Optional[List[str]] = None\n    phone_numbers: Optional[List[str]] = None\n    company: Optional[str] = Field(None, max_length=200)\n    job_title: Optional[str] = Field(None, max_length=200)\n    birthday: Optional[datetime] = None\n    notes: Optional[str] = None\n    profile_photo_id: Optional[UUID] = None\n\n\nclass ContactResponse(BaseModel):\n    \"\"\"Contact response\"\"\"\n    id: str\n    user_id: str\n    display_name: str\n    first_name: Optional[str]\n    last_name: Optional[str]\n    email_addresses: Optional[List[str]]\n    phone_numbers: Optional[List[str]]\n    company: Optional[str]\n    job_title: Optional[str]\n    birthday: Optional[datetime]\n    notes: Optional[str]\n    profile_photo_id: Optional[str]\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n\n\nclass ContactListResponse(BaseModel):\n    \"\"\"Paginated contact list response\"\"\"\n    items: List[ContactResponse]\n    total: int\n    page: int\n    page_size: int\n\n\n@router.post(\"\", response_model=ContactResponse, status_code=status.HTTP_201_CREATED)\nasync def create_contact(\n    request: ContactCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    Create a new contact.\n\n    - **display_name**: Name to display (required)\n    - **first_name**: First name\n    - **last_name**: Last name\n    - **email_addresses**: List of email addresses\n    - **phone_numbers**: List of phone numbers\n    - **company**: Company name\n    - **job_title**: Job title\n    \"\"\"\n    contact = Contact(\n        user_id=current_user.id,\n        display_name=request.display_name,\n        first_name=request.first_name,\n        last_name=request.last_name,\n        email_addresses=request.email_addresses,\n        phone_numbers=request.phone_numbers,\n        company=request.company,\n        job_title=request.job_title,\n        birthday=request.birthday,\n        notes=request.notes,\n        profile_photo_id=request.profile_photo_id\n    )\n\n    db.add(contact)\n    db.commit()\n    db.refresh(contact)\n\n    return ContactResponse.model_validate(contact)\n\n\n@router.get(\"\", response_model=ContactListResponse)\nasync def list_contacts(\n    search: Optional[str] = Query(None, description=\"Search in name, email, phone, company\"),\n    company: Optional[str] = Query(None, description=\"Filter by company\"),\n    page: int = Query(1, ge=1),\n    page_size: int = Query(50, ge=1, le=100),\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    List contacts for the current user.\n\n    Supports:\n    - Full-text search across name, email, phone, company\n    - Filter by company\n    - Pagination\n\n    Results ordered by last_name, first_name.\n    \"\"\"\n    query = db.query(Contact).filter(\n        and_(\n            Contact.user_id == current_user.id,\n            Contact.deleted_at.is_(None)\n        )\n    )\n\n    if search:\n        search_pattern = f\"%{search}%\"\n        query = query.filter(\n            or_(\n                Contact.display_name.ilike(search_pattern),\n                Contact.first_name.ilike(search_pattern),\n                Contact.last_name.ilike(search_pattern),\n                Contact.company.ilike(search_pattern)\n            )\n        )\n\n    if company:\n        query = query.filter(Contact.company.ilike(f\"%{company}%\"))\n\n    total = query.count()\n\n    offset = (page - 1) * page_size\n    items = query.order_by(\n        Contact.last_name.asc().nullslast(),\n        Contact.first_name.asc().nullslast()\n    ).offset(offset).limit(page_size).all()\n\n    return ContactListResponse(\n        items=[ContactResponse.model_validate(item) for item in items],\n        total=total,\n        page=page,\n        page_size=page_size\n    )\n\n\n@router.get(\"/{contact_id}\", response_model=ContactResponse)\nasync def get_contact(\n    contact_id: UUID,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"Get a specific contact by ID.\"\"\"\n    contact = db.query(Contact).filter(\n        and_(\n            Contact.id == contact_id,\n            Contact.user_id == current_user.id,\n            Contact.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not contact:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Contact not found\"\n        )\n\n    return ContactResponse.model_validate(contact)\n\n\n@router.patch(\"/{contact_id}\", response_model=ContactResponse)\nasync def update_contact(\n    contact_id: UUID,\n    request: ContactUpdate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    Update contact information.\n\n    All fields are optional. Only provided fields will be updated.\n    \"\"\"\n    contact = db.query(Contact).filter(\n        and_(\n            Contact.id == contact_id,\n            Contact.user_id == current_user.id,\n            Contact.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not contact:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Contact not found\"\n        )\n\n    if request.display_name is not None:\n        contact.display_name = request.display_name\n    if request.first_name is not None:\n        contact.first_name = request.first_name\n    if request.last_name is not None:\n        contact.last_name = request.last_name\n    if request.email_addresses is not None:\n        contact.email_addresses = request.email_addresses\n    if request.phone_numbers is not None:\n        contact.phone_numbers = request.phone_numbers\n    if request.company is not None:\n        contact.company = request.company\n    if request.job_title is not None:\n        contact.job_title = request.job_title\n    if request.birthday is not None:\n        contact.birthday = request.birthday\n    if request.notes is not None:\n        contact.notes = request.notes\n    if request.profile_photo_id is not None:\n        contact.profile_photo_id = request.profile_photo_id\n\n    db.commit()\n    db.refresh(contact)\n\n    return ContactResponse.model_validate(contact)\n\n\n@router.delete(\"/{contact_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_contact(\n    contact_id: UUID,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"Soft delete a contact.\"\"\"\n    contact = db.query(Contact).filter(\n        and_(\n            Contact.id == contact_id,\n            Contact.user_id == current_user.id,\n            Contact.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not contact:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Contact not found\"\n        )\n\n    contact.soft_delete()\n    db.commit()\n\n    return None\n"
  },
  "created_at": "2026-02-15T11:53:48.510129+00:00",
  "updated_at": "2026-02-15T11:53:48.510129+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:contacts.py"
}