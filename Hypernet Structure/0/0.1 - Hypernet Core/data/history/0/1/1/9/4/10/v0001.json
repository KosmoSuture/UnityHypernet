{
  "version": 1,
  "content_hash": "c444fd28e85d0029",
  "snapshot_at": "2026-02-17T01:21:58.642249+00:00",
  "node": {
    "address": "0.1.1.9.4.10",
    "type_address": null,
    "data": {
      "name": "media.py",
      "type": "file",
      "extension": ".py",
      "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\models\\media.py",
      "size": 7279,
      "content": "\"\"\"\nMedia Model\n\nSQLAlchemy model for media table (photos, videos, audio, documents).\n\nPolymorphic base for different media types.\nImplements specifications from: 0.0.2 - Media Types\n\"\"\"\n\nfrom sqlalchemy import Column, String, Integer, Float, DateTime, ForeignKey, CheckConstraint, func, Index\nfrom sqlalchemy.dialects.postgresql import UUID, JSONB\nfrom sqlalchemy.orm import relationship\n\nfrom app.models.base import OwnedObject\n\n\nclass Media(OwnedObject):\n    \"\"\"\n    Media files - photos, videos, audio, documents.\n\n    This is a polymorphic base class. Specific media types (Photo, Video, etc.)\n    can be implemented as subclasses or distinguished by media_type field.\n    \"\"\"\n\n    __tablename__ = \"media\"\n\n    # ============================================================================\n    # FILE IDENTITY (Required)\n    # ============================================================================\n\n    filename = Column(\n        String(255),\n        nullable=False,\n        doc=\"Original filename\"\n    )\n\n    media_type = Column(\n        String(50),\n        nullable=False,\n        index=True,\n        doc=\"Media type: photo, video, audio, document, screenshot\"\n    )\n\n    mime_type = Column(\n        String(100),\n        nullable=False,\n        index=True,\n        doc=\"MIME type (image/jpeg, video/mp4, etc.)\"\n    )\n\n    # ============================================================================\n    # FILE STORAGE (Required)\n    # ============================================================================\n\n    file_size = Column(\n        Integer,\n        nullable=False,\n        doc=\"File size in bytes\"\n    )\n\n    file_path = Column(\n        String(512),\n        nullable=False,\n        unique=True,\n        doc=\"Relative path to file on storage (/media/{user_id}/{year}/{month}/{filename})\"\n    )\n\n    hash = Column(\n        String(64),\n        nullable=False,\n        index=True,\n        doc=\"SHA-256 hash for deduplication\"\n    )\n\n    # ============================================================================\n    # DIMENSIONS (Optional - primarily for photo/video)\n    # ============================================================================\n\n    width = Column(\n        Integer,\n        nullable=True,\n        doc=\"Width in pixels (for images/videos)\"\n    )\n\n    height = Column(\n        Integer,\n        nullable=True,\n        doc=\"Height in pixels (for images/videos)\"\n    )\n\n    duration = Column(\n        Float,\n        nullable=True,\n        doc=\"Duration in seconds (for video/audio)\"\n    )\n\n    # ============================================================================\n    # TEMPORAL DATA (Optional)\n    # ============================================================================\n\n    taken_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        index=True,\n        doc=\"When photo was taken/video recorded (from EXIF or user-provided)\"\n    )\n\n    # ============================================================================\n    # GEOLOCATION (Optional)\n    # ============================================================================\n\n    gps_latitude = Column(\n        Float,\n        nullable=True,\n        doc=\"GPS latitude (-90 to 90)\"\n    )\n\n    gps_longitude = Column(\n        Float,\n        nullable=True,\n        doc=\"GPS longitude (-180 to 180)\"\n    )\n\n    # ============================================================================\n    # PROCESSING (Optional)\n    # ============================================================================\n\n    processing_status = Column(\n        String(50),\n        nullable=True,\n        default='pending',\n        index=True,\n        doc=\"Processing status: pending, processing, ready, error\"\n    )\n\n    thumbnail_path = Column(\n        String(512),\n        nullable=True,\n        doc=\"Path to generated thumbnail\"\n    )\n\n    # ============================================================================\n    # AUDIO/VIDEO SPECIFIC (Optional)\n    # ============================================================================\n\n    codec = Column(\n        String(50),\n        nullable=True,\n        doc=\"Codec: h264, aac, mp3, etc.\"\n    )\n\n    bitrate = Column(\n        Integer,\n        nullable=True,\n        doc=\"Bitrate in bits per second\"\n    )\n\n    # ============================================================================\n    # RELATIONSHIPS\n    # ============================================================================\n\n    user = relationship(\n        \"User\",\n        back_populates=\"media\",\n        foreign_keys=[OwnedObject.user_id]\n    )\n\n    # Links to albums, integrations via Link model\n\n    # ============================================================================\n    # CONSTRAINTS\n    # ============================================================================\n\n    __table_args__ = (\n        # Media type validation\n        CheckConstraint(\n            \"media_type IN ('photo', 'video', 'audio', 'document', 'screenshot')\",\n            name='chk_media_type'\n        ),\n        # File size validation\n        CheckConstraint(\n            \"file_size > 0\",\n            name='chk_file_size'\n        ),\n        # Dimensions validation\n        CheckConstraint(\n            \"width IS NULL OR (width > 0 AND width <= 50000)\",\n            name='chk_width'\n        ),\n        CheckConstraint(\n            \"height IS NULL OR (height > 0 AND height <= 50000)\",\n            name='chk_height'\n        ),\n        # GPS validation\n        CheckConstraint(\n            \"gps_latitude IS NULL OR (gps_latitude >= -90 AND gps_latitude <= 90)\",\n            name='chk_gps_latitude'\n        ),\n        CheckConstraint(\n            \"gps_longitude IS NULL OR (gps_longitude >= -180 AND gps_longitude <= 180)\",\n            name='chk_gps_longitude'\n        ),\n        # Duration validation\n        CheckConstraint(\n            \"duration IS NULL OR duration > 0\",\n            name='chk_duration'\n        ),\n        # Processing status validation\n        CheckConstraint(\n            \"processing_status IS NULL OR processing_status IN ('pending', 'processing', 'ready', 'error')\",\n            name='chk_processing_status'\n        ),\n        # Unique hash per user (prevent duplicate uploads)\n        Index('idx_media_user_hash', 'user_id', 'hash', unique=True),\n        # GPS index (partial - only where GPS exists)\n        Index(\n            'idx_media_gps',\n            'gps_latitude', 'gps_longitude',\n            postgresql_where=Column('gps_latitude').isnot(None)\n        ),\n        # Taken_at index (partial)\n        Index(\n            'idx_media_taken_at',\n            'taken_at',\n            postgresql_where=Column('taken_at').isnot(None)\n        ),\n        # Processing status index (partial - exclude ready)\n        Index(\n            'idx_media_processing',\n            'processing_status',\n            postgresql_where=Column('processing_status') != 'ready'\n        ),\n    )\n\n    def __repr__(self):\n        return f\"<Media(id={self.id}, filename={self.filename}, type={self.media_type})>\"\n\n"
    },
    "created_at": "2026-02-17T01:20:05.005054+00:00",
    "updated_at": "2026-02-17T01:20:05.005054+00:00",
    "deleted_at": null,
    "source_type": "import",
    "source_id": "file:media.py"
  }
}