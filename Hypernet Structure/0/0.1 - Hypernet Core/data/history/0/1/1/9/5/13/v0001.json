{
  "version": 1,
  "content_hash": "ed2e01e097b2ce54",
  "snapshot_at": "2026-02-17T01:21:59.021189+00:00",
  "node": {
    "address": "0.1.1.9.5.13",
    "type_address": null,
    "data": {
      "name": "social_posts.py",
      "type": "file",
      "extension": ".py",
      "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\routes\\social_posts.py",
      "size": 8077,
      "content": "\"\"\"\nSocial Post Routes\n\nEndpoints for managing social media posts from Instagram, Twitter, etc.\n\"\"\"\n\nfrom fastapi import APIRouter, Depends, HTTPException, status, Query\nfrom sqlalchemy.orm import Session\nfrom sqlalchemy import and_\nfrom pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional, List\nfrom uuid import UUID\n\nfrom app.core.database import get_db\nfrom app.core.dependencies import get_current_user\nfrom app.models.user import User\nfrom app.models.social_post import SocialPost\n\nrouter = APIRouter()\n\n\n# Request/Response Models\nclass SocialPostCreate(BaseModel):\n    \"\"\"Social post creation request\"\"\"\n    platform: str = Field(..., description=\"instagram, twitter, facebook, tiktok, linkedin\")\n    post_type: str = Field(..., description=\"text, photo, video, story, reel, carousel\")\n    content: str = Field(default='')\n    posted_at: datetime\n    platform_post_id: Optional[str] = Field(None, max_length=255)\n    platform_url: Optional[str] = Field(None, max_length=500)\n    likes_count: Optional[int] = Field(None, ge=0)\n    comments_count: Optional[int] = Field(None, ge=0)\n    shares_count: Optional[int] = Field(None, ge=0)\n    views_count: Optional[int] = Field(None, ge=0)\n    visibility: Optional[str] = Field(None, description=\"public, private, friends, followers\")\n    location: Optional[str] = Field(None, max_length=200)\n\n\nclass SocialPostUpdate(BaseModel):\n    \"\"\"Social post update request\"\"\"\n    content: Optional[str] = None\n    likes_count: Optional[int] = Field(None, ge=0)\n    comments_count: Optional[int] = Field(None, ge=0)\n    shares_count: Optional[int] = Field(None, ge=0)\n    views_count: Optional[int] = Field(None, ge=0)\n    is_pinned: Optional[bool] = None\n\n\nclass SocialPostResponse(BaseModel):\n    \"\"\"Social post response\"\"\"\n    id: str\n    user_id: str\n    platform: str\n    post_type: str\n    content: str\n    posted_at: datetime\n    platform_post_id: Optional[str]\n    platform_url: Optional[str]\n    likes_count: Optional[int]\n    comments_count: Optional[int]\n    shares_count: Optional[int]\n    views_count: Optional[int]\n    visibility: Optional[str]\n    is_pinned: bool\n    location: Optional[str]\n    created_at: datetime\n\n    class Config:\n        from_attributes = True\n\n\nclass SocialPostListResponse(BaseModel):\n    \"\"\"Paginated social post list response\"\"\"\n    items: List[SocialPostResponse]\n    total: int\n    page: int\n    page_size: int\n\n\n@router.post(\"\", response_model=SocialPostResponse, status_code=status.HTTP_201_CREATED)\nasync def create_social_post(\n    request: SocialPostCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    Create a new social post record.\n\n    Typically used when importing posts from social media platforms.\n\n    - **platform**: instagram, twitter, facebook, tiktok, linkedin\n    - **post_type**: text, photo, video, story, reel, carousel\n    - **content**: Post text content\n    - **posted_at**: When the post was published on the platform\n    \"\"\"\n    post = SocialPost(\n        user_id=current_user.id,\n        platform=request.platform,\n        post_type=request.post_type,\n        content=request.content,\n        posted_at=request.posted_at,\n        platform_post_id=request.platform_post_id,\n        platform_url=request.platform_url,\n        likes_count=request.likes_count,\n        comments_count=request.comments_count,\n        shares_count=request.shares_count,\n        views_count=request.views_count,\n        visibility=request.visibility,\n        location=request.location\n    )\n\n    db.add(post)\n    db.commit()\n    db.refresh(post)\n\n    return SocialPostResponse.model_validate(post)\n\n\n@router.get(\"\", response_model=SocialPostListResponse)\nasync def list_social_posts(\n    platform: Optional[str] = Query(None, description=\"Filter by platform\"),\n    post_type: Optional[str] = Query(None, description=\"Filter by post type\"),\n    is_pinned: Optional[bool] = Query(None, description=\"Filter pinned posts\"),\n    page: int = Query(1, ge=1),\n    page_size: int = Query(50, ge=1, le=100),\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    List social posts for the current user.\n\n    Supports filtering by platform, post type, and pinned status.\n    Results are ordered by posted_at descending (newest first).\n    \"\"\"\n    query = db.query(SocialPost).filter(\n        and_(\n            SocialPost.user_id == current_user.id,\n            SocialPost.deleted_at.is_(None)\n        )\n    )\n\n    if platform:\n        query = query.filter(SocialPost.platform == platform)\n\n    if post_type:\n        query = query.filter(SocialPost.post_type == post_type)\n\n    if is_pinned is not None:\n        query = query.filter(SocialPost.is_pinned == is_pinned)\n\n    total = query.count()\n\n    offset = (page - 1) * page_size\n    items = query.order_by(SocialPost.posted_at.desc()).offset(offset).limit(page_size).all()\n\n    return SocialPostListResponse(\n        items=[SocialPostResponse.model_validate(item) for item in items],\n        total=total,\n        page=page,\n        page_size=page_size\n    )\n\n\n@router.get(\"/{post_id}\", response_model=SocialPostResponse)\nasync def get_social_post(\n    post_id: UUID,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"Get a specific social post by ID.\"\"\"\n    post = db.query(SocialPost).filter(\n        and_(\n            SocialPost.id == post_id,\n            SocialPost.user_id == current_user.id,\n            SocialPost.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not post:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Social post not found\"\n        )\n\n    return SocialPostResponse.model_validate(post)\n\n\n@router.patch(\"/{post_id}\", response_model=SocialPostResponse)\nasync def update_social_post(\n    post_id: UUID,\n    request: SocialPostUpdate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    Update social post metadata.\n\n    Primarily used to update engagement metrics (likes, comments, shares, views)\n    when syncing from the platform.\n    \"\"\"\n    post = db.query(SocialPost).filter(\n        and_(\n            SocialPost.id == post_id,\n            SocialPost.user_id == current_user.id,\n            SocialPost.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not post:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Social post not found\"\n        )\n\n    if request.content is not None:\n        post.content = request.content\n    if request.likes_count is not None:\n        post.likes_count = request.likes_count\n    if request.comments_count is not None:\n        post.comments_count = request.comments_count\n    if request.shares_count is not None:\n        post.shares_count = request.shares_count\n    if request.views_count is not None:\n        post.views_count = request.views_count\n    if request.is_pinned is not None:\n        post.is_pinned = request.is_pinned\n\n    db.commit()\n    db.refresh(post)\n\n    return SocialPostResponse.model_validate(post)\n\n\n@router.delete(\"/{post_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_social_post(\n    post_id: UUID,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"Soft delete a social post.\"\"\"\n    post = db.query(SocialPost).filter(\n        and_(\n            SocialPost.id == post_id,\n            SocialPost.user_id == current_user.id,\n            SocialPost.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not post:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Social post not found\"\n        )\n\n    post.soft_delete()\n    db.commit()\n\n    return None\n"
    },
    "created_at": "2026-02-17T01:20:05.075571+00:00",
    "updated_at": "2026-02-17T01:20:05.075571+00:00",
    "deleted_at": null,
    "source_type": "import",
    "source_id": "file:social_posts.py"
  }
}