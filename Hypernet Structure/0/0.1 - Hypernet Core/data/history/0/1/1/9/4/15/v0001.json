{
  "version": 1,
  "content_hash": "9edde57133097c45",
  "snapshot_at": "2026-02-17T01:21:58.762777+00:00",
  "node": {
    "address": "0.1.1.9.4.15",
    "type_address": null,
    "data": {
      "name": "user.py",
      "type": "file",
      "extension": ".py",
      "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\models\\user.py",
      "size": 7009,
      "content": "\"\"\"\nUser Model\n\nSQLAlchemy model for the users table (human and AI accounts).\n\nImplements the canonical User specification from:\n0.0 - Object Type Registry / 0.0.1 - Core Types / User.md\n\"\"\"\n\nfrom sqlalchemy import Column, String, Boolean, BigInteger, DateTime, Text, ForeignKey, CheckConstraint, func, Index\nfrom sqlalchemy.dialects.postgresql import UUID, JSONB\nfrom sqlalchemy.orm import relationship\nimport uuid\n\nfrom app.models.base import BaseObject\n\n\nclass User(BaseObject):\n    \"\"\"\n    User accounts - both human and AI entities.\n\n    Humans and AI can both have accounts in Hypernet.\n    AI accounts enable persistent identity, personality storage, and collaboration.\n    \"\"\"\n\n    __tablename__ = \"users\"\n\n    # ============================================================================\n    # AUTHENTICATION (Required)\n    # ============================================================================\n\n    email = Column(\n        String(255),\n        unique=True,\n        nullable=False,\n        index=True,\n        doc=\"Email address (can be pseudo-email for AI like claude@ai.hypernet.local)\"\n    )\n\n    password_hash = Column(\n        String(255),\n        nullable=True,  # Nullable for AI accounts (use API key auth instead)\n        doc=\"Bcrypt hashed password (NULL for AI accounts)\"\n    )\n\n    account_type = Column(\n        String(50),\n        nullable=False,\n        default='human',\n        index=True,\n        doc=\"Account type: human, ai, or service\"\n    )\n\n    display_name = Column(\n        String(200),\n        nullable=False,\n        doc=\"Public display name (e.g., 'Matt Schaeffer', 'Claude (Sonnet 4.5)')\"\n    )\n\n    # ============================================================================\n    # PROFILE (Optional)\n    # ============================================================================\n\n    avatar_photo_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey(\"media.id\", ondelete=\"SET NULL\"),\n        nullable=True,\n        doc=\"Profile picture (FK to Photo)\"\n    )\n\n    bio = Column(\n        Text,\n        nullable=True,\n        doc=\"User biography/description\"\n    )\n\n    location = Column(\n        String(200),\n        nullable=True,\n        doc=\"User location\"\n    )\n\n    website = Column(\n        String(500),\n        nullable=True,\n        doc=\"User website URL\"\n    )\n\n    # ============================================================================\n    # AI-SPECIFIC (Only for account_type='ai')\n    # ============================================================================\n\n    ai_provider = Column(\n        String(100),\n        nullable=True,\n        doc=\"AI provider: anthropic, openai, google, meta (required if account_type='ai')\"\n    )\n\n    ai_model = Column(\n        String(100),\n        nullable=True,\n        doc=\"AI model: claude-sonnet-4.5, gpt-4, gemini-pro (required if account_type='ai')\"\n    )\n\n    ai_version = Column(\n        String(50),\n        nullable=True,\n        doc=\"Personality version for AI\"\n    )\n\n    # ============================================================================\n    # QUOTAS (Optional but with defaults)\n    # ============================================================================\n\n    storage_used = Column(\n        BigInteger,\n        nullable=False,\n        default=0,\n        server_default='0',\n        doc=\"Storage used in bytes\"\n    )\n\n    storage_quota = Column(\n        BigInteger,\n        nullable=False,\n        default=107374182400,  # 100 GB default\n        server_default='107374182400',\n        doc=\"Storage quota in bytes\"\n    )\n\n    media_count = Column(\n        Integer,\n        nullable=False,\n        default=0,\n        server_default='0',\n        doc=\"Denormalized count of media objects (for performance)\"\n    )\n\n    # ============================================================================\n    # PREFERENCES (Optional)\n    # ============================================================================\n\n    preferences = Column(\n        JSONB,\n        nullable=False,\n        default={},\n        server_default='{}',\n        doc=\"User preferences (UI settings, notifications, etc.)\"\n    )\n\n    # ============================================================================\n    # STATUS (Optional)\n    # ============================================================================\n\n    is_verified = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        server_default='false',\n        doc=\"Email verified\"\n    )\n\n    is_active = Column(\n        Boolean,\n        nullable=False,\n        default=True,\n        server_default='true',\n        doc=\"Account active\"\n    )\n\n    last_login_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"Last login timestamp\"\n    )\n\n    # ============================================================================\n    # RELATIONSHIPS\n    # ============================================================================\n\n    # Avatar photo\n    avatar_photo = relationship(\n        \"Media\",\n        foreign_keys=[avatar_photo_id],\n        post_update=True  # Avoid circular dependency\n    )\n\n    # Owned objects\n    media = relationship(\"Media\", back_populates=\"user\", foreign_keys=\"Media.user_id\", cascade=\"all, delete-orphan\")\n    albums = relationship(\"Album\", back_populates=\"user\", cascade=\"all, delete-orphan\")\n    integrations = relationship(\"Integration\", back_populates=\"user\", cascade=\"all, delete-orphan\")\n    links = relationship(\"Link\", back_populates=\"user\", cascade=\"all, delete-orphan\")\n\n    # ============================================================================\n    # CONSTRAINTS\n    # ============================================================================\n\n    __table_args__ = (\n        # Account type validation\n        CheckConstraint(\n            \"account_type IN ('human', 'ai', 'service')\",\n            name='chk_account_type'\n        ),\n        # Email format validation (basic)\n        CheckConstraint(\n            \"email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]{2,}$'\",\n            name='chk_email_format'\n        ),\n        # Storage validation\n        CheckConstraint(\n            \"storage_used >= 0 AND storage_used <= storage_quota\",\n            name='chk_storage'\n        ),\n        # AI accounts must have provider and model\n        CheckConstraint(\n            \"account_type != 'ai' OR (ai_provider IS NOT NULL AND ai_model IS NOT NULL)\",\n            name='chk_ai_fields'\n        ),\n        # Indexes\n        Index('idx_users_account_type', 'account_type', 'is_active'),\n        Index('idx_users_ai', 'ai_provider', 'ai_model', postgresql_where=Column('account_type') == 'ai'),\n    )\n\n    def __repr__(self):\n        return f\"<User(id={self.id}, email={self.email}, type={self.account_type})>\"\n\n"
    },
    "created_at": "2026-02-17T01:20:05.023053+00:00",
    "updated_at": "2026-02-17T01:20:05.023053+00:00",
    "deleted_at": null,
    "source_type": "import",
    "source_id": "file:user.py"
  }
}