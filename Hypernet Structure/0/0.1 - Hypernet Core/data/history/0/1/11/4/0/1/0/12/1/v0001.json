{
  "version": 1,
  "content_hash": "3f1a995ed29f3ea2",
  "snapshot_at": "2026-02-17T01:22:19.955062+00:00",
  "node": {
    "address": "0.1.11.4.0.1.0.12.1",
    "type_address": null,
    "data": {
      "name": "1",
      "type": "folder",
      "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\data\\nodes\\0\\1\\0\\12\\1",
      "content_preview": "{\n  \"address\": \"0.1.0.12.1\",\n  \"type_address\": null,\n  \"data\": {\n    \"name\": \"01-Database-Schema.md\",\n    \"type\": \"file\",\n    \"extension\": \".md\",\n    \"path\": \"C:\\\\Hypernet\\\\Hypernet Structure\\\\0\\\\0.1 - Hypernet Core\\\\0.1.0 - Planning & Documentation\\\\Database-Design\\\\01-Database-Schema.md\",\n    \"size\": 18778,\n    \"content\": \"# Hypernet Core - Database Schema\\n\\n**Version:** 0.1.0\\n**Database:** PostgreSQL 15+\\n**ORM:** SQLAlchemy 2.0+\\n**Migrations:** Alembic\\n**Last Updated:** 2026-02-03\\n\\n---\\n\\n## Overview\\n\\nThis document defines the PostgreSQL database schema for Hypernet Core 0.1, implementing the object model and link model specifications.\\n\\n### Design Principles\\n\\n1. **Normalized** - Minimize redundancy, maintain data integrity\\n2. **Performant** - Indexes on frequently queried fields\\n3. **Extensible** - JSONB metadata for flexibility\\n4. **Secure** - Row-level security, encrypted sensitive fields\\n5. **Auditable** - Timestamps and soft deletes on all tables\\n\\n---\\n\\n## Tables\\n\\n### 1. users\\n\\nUser accounts and authentication.\\n\\n```sql\\nCREATE TABLE users (\\n    -- Identity\\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\\n\\n    -- Authentication\\n    email VARCHAR(255) NOT NULL UNIQUE,\\n    password_hash VARCHAR(255) NOT NULL,\\n    email_verified BOOLEAN NOT NULL DEFAULT FALSE,\\n\\n    -- Profile\\n    display_name VARCHAR(100),\\n    avatar_url VARCHAR(1024),\\n\\n    -- Account Status\\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\\n    is_admin BOOLEAN NOT NULL DEFAULT FALSE,\\n\\n    -- Timestamps\\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    last_login_at TIMESTAMP WITH TIME ZONE,\\n    deleted_at TIMESTAMP WITH TIME ZONE,\\n\\n    -- Storage Quotas\\n    storage_used BIGINT NOT NULL DEFAULT 0,\\n    storage_quota BIGINT NOT NULL DEFAULT 10737418240, -- 10 GB\\n\\n    -- Extensibility\\n    metadata JSONB NOT NULL DEFAULT '{}'::jsonb\\n);\\n\\n-- Indexes\\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_users_created_at ON users(created_at);\\n\\n-- Trigger for updated_at\\nCREATE OR REPLACE FUNCTION update_updated_at_column()\\nRETURNS TRIGGER AS $$\\nBEGIN\\n    NEW.updated_at = NOW();\\n    RETURN NEW;\\nEND;\\n$$ LANGUAGE plpgsql;\\n\\nCREATE TRIGGER users_updated_at BEFORE UPDATE ON users\\n    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\\n```\\n\\n---\\n\\n### 2. media\\n\\nPhotos, videos, and other media files.\\n\\n```sql\\nCREATE TABLE media (\\n    -- Identity\\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\\n\\n    -- Ownership\\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\\n\\n    -- Basic Info\\n    filename VARCHAR(255) NOT NULL,\\n    media_type VARCHAR(50) NOT NULL, -- 'photo', 'video', 'document', 'other'\\n    mime_type VARCHAR(100) NOT NULL,\\n\\n    -- File Information\\n    size BIGINT NOT NULL,\\n    width INTEGER,\\n    height INTEGER,\\n    duration DOUBLE PRECISION, -- seconds (for videos)\\n\\n    -- Storage\\n    file_path VARCHAR(1024) NOT NULL,\\n    thumbnail_path VARCHAR(1024),\\n    hash VARCHAR(64) NOT NULL, -- SHA-256\\n\\n    -- Dates and Location\\n    taken_at TIMESTAMP WITH TIME ZONE,\\n    latitude DOUBLE PRECISION,\\n    longitude DOUBLE PRECISION,\\n\\n    -- Source Tracking\\n    source_type VARCHAR(50), -- 'upload', 'integration', 'import'\\n    source_id VARCHAR(255),\\n\\n    -- Processing Status\\n    processing_status VARCHAR(50) NOT NULL DEFAULT 'pending', -- 'pending', 'processing', 'complete', 'failed'\\n    thumbnail_generated BOOLEAN NOT NULL DEFAULT FALSE,\\n    metadata_extracted BOOLEAN NOT NULL DEFAULT FALSE,\\n\\n    -- Timestamps\\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    deleted_at TIMESTAMP WITH TIME ZONE,\\n\\n    -- Extensibility\\n    metadata JSONB NOT NULL DEFAULT '{}'::jsonb,\\n\\n    -- Constraints\\n    CONSTRAINT chk_media_type CHECK (media_type IN ('photo', 'video', 'document', 'other')),\\n    CONSTRAINT chk_processing_status CHECK (processing_status IN ('pending', 'processing', 'complete', 'failed')),\\n    CONSTRAINT chk_latitude CHECK (latitude IS NULL OR (latitude >= -90 AND latitude <= 90)),\\n    CONSTRAINT chk_longitude CHECK (longitude IS NULL OR (longitude >= -180 AND longitude <= 180))\\n);\\n\\n-- Indexes\\nCREATE INDEX idx_media_user_id ON media(user_id) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_media_hash ON media(hash);\\nCREATE INDEX idx_media_taken_at ON media(taken_at) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_media_media_type ON media(media_type) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_media_source ON media(user_id, source_type, source_id) WHERE deleted_at IS NULL;\\n\\n-- GIN index for metadata (allows querying inside JSONB)\\nCREATE INDEX idx_media_metadata ON media USING GIN(metadata);\\n\\n-- Trigger for updated_at\\nCREATE TRIGGER media_updated_at BEFORE UPDATE ON media\\n    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\\n```\\n\\n---\\n\\n### 3. albums\\n\\nCollections of media.\\n\\n```sql\\nCREATE TABLE albums (\\n    -- Identity\\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\\n\\n    -- Ownership\\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\\n\\n    -- Basic Info\\n    name VARCHAR(200) NOT NULL,\\n    description TEXT,\\n\\n    -- Display\\n    cover_media_id UUID REFERENCES media(id) ON DELETE SET NULL,\\n    sort_order VARCHAR(50) NOT NULL DEFAULT 'date_desc', -- 'date_asc', 'date_desc', 'manual'\\n\\n    -- Counts (denormalized for performance)\\n    media_count INTEGER NOT NULL DEFAULT 0,\\n\\n    -- Privacy (future use)\\n    visibility VARCHAR(50) NOT NULL DEFAULT 'private', -- 'private', 'unlisted', 'public'\\n\\n    -- Timestamps\\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    deleted_at TIMESTAMP WITH TIME ZONE,\\n\\n    -- Source Tracking\\n    source_type VARCHAR(50),\\n    source_id VARCHAR(255),\\n\\n    -- Extensibility\\n    metadata JSONB NOT NULL DEFAULT '{}'::jsonb,\\n\\n    -- Constraints\\n    CONSTRAINT chk_sort_order CHECK (sort_order IN ('date_asc', 'date_desc', 'manual')),\\n    CONSTRAINT chk_visibility CHECK (visibility IN ('private', 'unlisted', 'public')),\\n    CONSTRAINT chk_media_count CHECK (media_count >= 0)\\n);\\n\\n-- Indexes\\nCREATE INDEX idx_albums_user_id ON albums(user_id) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_albums_name ON albums(user_id, name) WHERE deleted_at IS NULL;\\n\\n-- Trigger for updated_at\\nCREATE TRIGGER albums_updated_at BEFORE UPDATE ON albums\\n    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\\n```\\n\\n---\\n\\n### 4. integrations\\n\\nConnected external services.\\n\\n```sql\\nCREATE TABLE integrations (\\n    -- Identity\\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\\n\\n    -- Ownership\\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\\n\\n    -- Integration Details\\n    integration_type VARCHAR(50) NOT NULL, -- 'instagram', 'google_photos', 'facebook', etc.\\n    integration_name VARCHAR(200) NOT NULL,\\n\\n    -- Status\\n    status VARCHAR(50) NOT NULL DEFAULT 'pending', -- 'connected', 'disconnected', 'error', 'pending'\\n    is_enabled BOOLEAN NOT NULL DEFAULT TRUE,\\n\\n    -- OAuth2 (encrypted in separate table - see integration_secrets)\\n    token_expires_at TIMESTAMP WITH TIME ZONE,\\n\\n    -- Sync State\\n    last_sync_at TIMESTAMP WITH TIME ZONE,\\n    last_sync_status VARCHAR(50), -- 'success', 'partial', 'failed'\\n    sync_cursor TEXT, -- Pagination cursor for incremental sync\\n\\n    -- Statistics\\n    items_synced INTEGER NOT NULL DEFAULT 0,\\n\\n    -- Timestamps\\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    deleted_at TIMESTAMP WITH TIME ZONE,\\n\\n    -- Source Tracking\\n    source_type VARCHAR(50),\\n    source_id VARCHAR(255),\\n\\n    -- Extensibility\\n    metadata JSONB NOT NULL DEFAULT '{}'::jsonb,\\n\\n    -- Constraints\\n    CONSTRAINT chk_integration_status CHECK (status IN ('connected', 'disconnected', 'error', 'pending')),\\n    CONSTRAINT chk_sync_status CHECK (last_sync_status IS NULL OR last_sync_status IN ('success', 'partial', 'failed')),\\n    CONSTRAINT chk_items_synced CHECK (items_synced >= 0)\\n);\\n\\n-- Indexes\\nCREATE INDEX idx_integrations_user_id ON integrations(user_id) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_integrations_type ON integrations(user_id, integration_type) WHERE deleted_at IS NULL;\\nCREATE INDEX idx_integrations_status ON integrations(status) WHERE deleted_at IS NULL;\\n\\n-- Trigger for updated_at\\nCREATE TRIGGER integrations_updated_at BEFORE UPDATE ON integrations\\n    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\\n```\\n\\n---\\n\\n### 5. integration_secrets\\n\\nOAuth tokens and secrets (encrypted at rest).\\n\\n**Note:** Stored separately for additional security. Can be encrypted at database level using pgcrypto.\\n\\n```sql\\nCREATE TABLE integration_secrets (\\n    -- Identity\\n    integration_id UUID PRIMARY KEY REFERENCES integrations(id) ON DELETE CASCADE,\\n\\n    -- OAuth2 Tokens (should be encrypted)\\n    access_token TEXT,\\n    refresh_token TEXT,\\n\\n    -- Timestamps\\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()\\n);\\n\\n-- No indexes needed (always queried by integration_id primary key)\\n\\n-- Trigger for updated_at\\nCREATE TRIGGER integration_secrets_updated_at BEFORE UPDATE ON integration_secrets\\n    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();\\n```\\n\\n---\\n\\n### 6. links\\n\\nRelationships between objects (first-class links).\\n\\n```sql\\nCREATE TABLE links (\\n    -- Identity\\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\\n\\n    -- Ownership\\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\\n\\n    -- Link Endpoints\\n    from_object_id UUID NOT NULL,\\n    from_object_type VARCHAR(50) NOT NULL,\\n    to_object\n... [truncated]",
      "content_file": "node.json"
    },
    "created_at": "2026-02-17T01:20:10.295775+00:00",
    "updated_at": "2026-02-17T01:20:10.295775+00:00",
    "deleted_at": null,
    "source_type": "import",
    "source_id": "folder:1"
  }
}