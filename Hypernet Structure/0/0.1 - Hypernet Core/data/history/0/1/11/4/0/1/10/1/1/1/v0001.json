{
  "version": 1,
  "content_hash": "642b8593fc20da72",
  "snapshot_at": "2026-02-17T01:22:23.771646+00:00",
  "node": {
    "address": "0.1.11.4.0.1.10.1.1.1",
    "type_address": null,
    "data": {
      "name": "node.json",
      "type": "file",
      "extension": ".json",
      "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\data\\nodes\\0\\1\\10\\1\\1\\node.json",
      "size": 9731,
      "content": "{\n  \"address\": \"0.1.10.1.1\",\n  \"type_address\": null,\n  \"data\": {\n    \"name\": \"audit.py\",\n    \"type\": \"file\",\n    \"extension\": \".py\",\n    \"path\": \"C:\\\\Hypernet\\\\Hypernet Structure\\\\0\\\\0.1 - Hypernet Core\\\\app\\\\routes\\\\audit.py\",\n    \"size\": 9155,\n    \"content\": \"\\\"\\\"\\\"\\nAudit API Routes\\n\\nProvides read-only access to audit logs for security and compliance.\\nAudit logs track all user actions, API calls, and system events.\\n\\\"\\\"\\\"\\n\\nfrom fastapi import APIRouter, Depends, HTTPException, Query, status\\nfrom sqlalchemy.orm import Session\\nfrom sqlalchemy import and_, or_\\nfrom typing import Optional, List, Dict, Any\\nfrom datetime import datetime, date\\nfrom uuid import UUID\\nfrom pydantic import BaseModel, Field\\n\\nfrom app.core.database import get_db\\nfrom app.core.dependencies import get_current_user\\nfrom app.models.user import User\\nfrom app.models.audit import Audit\\n\\n\\nrouter = APIRouter()\\n\\n\\n# Pydantic Models for Response (No Create/Update - audit logs are system-generated)\\nclass AuditResponse(BaseModel):\\n    id: UUID\\n    user_id: UUID\\n    action: str\\n    resource_type: Optional[str]\\n    resource_id: Optional[UUID]\\n    ip_address: Optional[str]\\n    user_agent: Optional[str]\\n    request_method: Optional[str]\\n    request_path: Optional[str]\\n    status_code: Optional[int]\\n    changes: Dict[str, Any]\\n    metadata: Dict[str, Any]\\n    timestamp: datetime\\n\\n    class Config:\\n        from_attributes = True\\n\\n\\nclass AuditListResponse(BaseModel):\\n    items: List[AuditResponse]\\n    total: int\\n    page: int\\n    page_size: int\\n    pages: int\\n\\n\\nclass AuditSummary(BaseModel):\\n    \\\"\\\"\\\"Summary of audit events.\\\"\\\"\\\"\\n    action: str\\n    count: int\\n    first_seen: datetime\\n    last_seen: datetime\\n\\n\\n# Endpoints\\n@router.get(\\\"\\\", response_model=AuditListResponse)\\nasync def list_audit_logs(\\n    action: Optional[str] = Query(None, description=\\\"Filter by action (e.g., create, update, delete, login)\\\"),\\n    resource_type: Optional[str] = Query(None, description=\\\"Filter by resource type (e.g., media, document, task)\\\"),\\n    resource_id: Optional[UUID] = Query(None, description=\\\"Filter by specific resource ID\\\"),\\n    start_date: Optional[date] = Query(None, description=\\\"Start date (YYYY-MM-DD)\\\"),\\n    end_date: Optional[date] = Query(None, description=\\\"End date (YYYY-MM-DD)\\\"),\\n    ip_address: Optional[str] = Query(None, description=\\\"Filter by IP address\\\"),\\n    page: int = Query(1, ge=1, description=\\\"Page number\\\"),\\n    page_size: int = Query(50, ge=1, le=100, description=\\\"Items per page\\\"),\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"\\n    List audit logs for the current user.\\n    Audit logs are read-only and cannot be modified or deleted.\\n    \\\"\\\"\\\"\\n    query = db.query(Audit).filter(Audit.user_id == current_user.id)\\n\\n    if action:\\n        query = query.filter(Audit.action == action)\\n\\n    if resource_type:\\n        query = query.filter(Audit.resource_type == resource_type)\\n\\n    if resource_id:\\n        query = query.filter(Audit.resource_id == resource_id)\\n\\n    if start_date:\\n        query = query.filter(Audit.timestamp >= datetime.combine(start_date, datetime.min.time()))\\n\\n    if end_date:\\n        query = query.filter(Audit.timestamp <= datetime.combine(end_date, datetime.max.time()))\\n\\n    if ip_address:\\n        query = query.filter(Audit.ip_address == ip_address)\\n\\n    total = query.count()\\n\\n    # Order by timestamp descending (most recent first)\\n    query = query.order_by(Audit.timestamp.desc())\\n\\n    offset = (page - 1) * page_size\\n    items = query.offset(offset).limit(page_size).all()\\n\\n    pages = (total + page_size - 1) // page_size\\n\\n    return AuditListResponse(\\n        items=items,\\n        total=total,\\n        page=page,\\n        page_size=page_size,\\n        pages=pages\\n    )\\n\\n\\n@router.get(\\\"/summary\\\", response_model=List[AuditSummary])\\nasync def get_audit_summary(\\n    start_date: Optional[date] = Query(None, description=\\\"Start date (YYYY-MM-DD)\\\"),\\n    end_date: Optional[date] = Query(None, description=\\\"End date (YYYY-MM-DD)\\\"),\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get summary of audit events grouped by action.\\\"\\\"\\\"\\n    from sqlalchemy import func\\n\\n    query = db.query(\\n        Audit.action,\\n        func.count(Audit.id).label('count'),\\n        func.min(Audit.timestamp).label('first_seen'),\\n        func.max(Audit.timestamp).label('last_seen')\\n    ).filter(Audit.user_id == current_user.id)\\n\\n    if start_date:\\n        query = query.filter(Audit.timestamp >= datetime.combine(start_date, datetime.min.time()))\\n\\n    if end_date:\\n        query = query.filter(Audit.timestamp <= datetime.combine(end_date, datetime.max.time()))\\n\\n    results = query.group_by(Audit.action).order_by(func.count(Audit.id).desc()).all()\\n\\n    return [\\n        AuditSummary(\\n            action=row.action,\\n            count=row.count,\\n            first_seen=row.first_seen,\\n            last_seen=row.last_seen\\n        )\\n        for row in results\\n    ]\\n\\n\\n@router.get(\\\"/actions\\\", response_model=List[str])\\nasync def list_actions(\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get all unique action types from user's audit logs.\\\"\\\"\\\"\\n    actions = db.query(Audit.action).filter(\\n        Audit.user_id == current_user.id\\n    ).distinct().order_by(Audit.action).all()\\n\\n    return [action[0] for action in actions if action[0]]\\n\\n\\n@router.get(\\\"/resource-types\\\", response_model=List[str])\\nasync def list_resource_types(\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get all unique resource types from user's audit logs.\\\"\\\"\\\"\\n    resource_types = db.query(Audit.resource_type).filter(\\n        and_(\\n            Audit.user_id == current_user.id,\\n            Audit.resource_type.isnot(None)\\n        )\\n    ).distinct().order_by(Audit.resource_type).all()\\n\\n    return [rt[0] for rt in resource_types if rt[0]]\\n\\n\\n@router.get(\\\"/ip-addresses\\\", response_model=List[str])\\nasync def list_ip_addresses(\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"\\n    Get all unique IP addresses from user's audit logs.\\n    Useful for security monitoring and detecting unusual access patterns.\\n    \\\"\\\"\\\"\\n    ips = db.query(Audit.ip_address).filter(\\n        and_(\\n            Audit.user_id == current_user.id,\\n            Audit.ip_address.isnot(None)\\n        )\\n    ).distinct().all()\\n\\n    return [ip[0] for ip in ips if ip[0]]\\n\\n\\n@router.get(\\\"/recent\\\", response_model=AuditListResponse)\\nasync def get_recent_activity(\\n    hours: int = Query(24, ge=1, le=168, description=\\\"Number of hours to look back (max 7 days)\\\"),\\n    limit: int = Query(50, ge=1, le=100, description=\\\"Maximum results\\\"),\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get recent audit activity for the user.\\\"\\\"\\\"\\n    from datetime import timedelta\\n\\n    cutoff_time = datetime.utcnow() - timedelta(hours=hours)\\n\\n    query = db.query(Audit).filter(\\n        and_(\\n            Audit.user_id == current_user.id,\\n            Audit.timestamp >= cutoff_time\\n        )\\n    ).order_by(Audit.timestamp.desc()).limit(limit)\\n\\n    items = query.all()\\n    total = db.query(Audit).filter(\\n        and_(\\n            Audit.user_id == current_user.id,\\n            Audit.timestamp >= cutoff_time\\n        )\\n    ).count()\\n\\n    return AuditListResponse(\\n        items=items,\\n        total=total,\\n        page=1,\\n        page_size=limit,\\n        pages=1\\n    )\\n\\n\\n@router.get(\\\"/{audit_id}\\\", response_model=AuditResponse)\\nasync def get_audit_log(\\n    audit_id: UUID,\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get a specific audit log entry by ID.\\\"\\\"\\\"\\n    audit_log = db.query(Audit).filter(\\n        and_(\\n            Audit.id == audit_id,\\n            Audit.user_id == current_user.id\\n        )\\n    ).first()\\n\\n    if not audit_log:\\n        raise HTTPException(\\n            status_code=status.HTTP_404_NOT_FOUND,\\n            detail=\\\"Audit log not found\\\"\\n        )\\n\\n    return audit_log\\n\\n\\n@router.get(\\\"/resource/{resource_type}/{resource_id}\\\", response_model=AuditListResponse)\\nasync def get_resource_history(\\n    resource_type: str,\\n    resource_id: UUID,\\n    page: int = Query(1, ge=1, description=\\\"Page number\\\"),\\n    page_size: int = Query(50, ge=1, le=100, description=\\\"Items per page\\\"),\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"\\n    Get audit history for a specific resource.\\n    Shows all actions taken on a particular resource.\\n    \\\"\\\"\\\"\\n    query = db.query(Audit).filter(\\n        and_(\\n            Audit.user_id == current_user.id,\\n            Audit.resource_type == resource_type,\\n            Audit.resource_id == resource_id\\n        )\\n    )\\n\\n    total = query.count()\\n\\n    query = query.order_by(Audit.timestamp.desc())\\n\\n    offset = (page - 1) * page_size\\n    items = query.offset(offset).limit(page_size).all()\\n\\n    pages = (total + page_size - 1) // page_size\\n\\n    return AuditListResponse(\\n        items=items,\\n        total=total,\\n        page=page,\\n        page_size=page_size,\\n        pages=pages\\n    )\\n\"\n  },\n  \"created_at\": \"2026-02-17T01:20:05.371610+00:00\",\n  \"updated_at\": \"2026-02-17T01:20:05.371610+00:00\",\n  \"deleted_at\": null,\n  \"source_type\": \"import\",\n  \"source_id\": \"file:audit.py\"\n}"
    },
    "created_at": "2026-02-17T01:20:13.102888+00:00",
    "updated_at": "2026-02-17T01:20:13.102888+00:00",
    "deleted_at": null,
    "source_type": "import",
    "source_id": "file:node.json"
  }
}