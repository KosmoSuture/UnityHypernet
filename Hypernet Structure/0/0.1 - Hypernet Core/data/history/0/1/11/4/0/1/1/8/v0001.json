{
  "version": 1,
  "content_hash": "2aa9dbbb270a0a99",
  "snapshot_at": "2026-02-17T01:22:23.305521+00:00",
  "node": {
    "address": "0.1.11.4.0.1.1.8",
    "type_address": null,
    "data": {
      "name": "8",
      "type": "folder",
      "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\data\\nodes\\0\\1\\1\\8",
      "content_preview": "{\n  \"address\": \"0.1.1.8\",\n  \"type_address\": null,\n  \"data\": {\n    \"name\": \"api.py\",\n    \"type\": \"file\",\n    \"extension\": \".py\",\n    \"path\": \"C:\\\\Hypernet\\\\Hypernet Structure\\\\0\\\\0.1 - Hypernet Core\\\\0.1.1 - Core System\\\\api.py\",\n    \"size\": 21248,\n    \"content\": \"\\\"\\\"\\\"\\nHypernet MVP API\\nFastAPI backend for VR demo\\nEndpoints: Photos, Search, Timeline, AI Query, People, Links\\n\\\"\\\"\\\"\\n\\nfrom fastapi import FastAPI, HTTPException, Query, Depends\\nfrom fastapi.middleware.cors import CORSMiddleware\\nfrom fastapi.responses import FileResponse\\nfrom typing import Optional, List\\nfrom datetime import datetime, timedelta\\nimport sqlite3\\nfrom pathlib import Path\\nimport json\\nimport os\\n\\nfrom mvp_models import (\\n    Photo, Person, Event, Link, SearchRequest, SearchResult,\\n    TimelineRequest, AIQueryRequest, AIQueryResponse,\\n    ObjectType, PhotoWithLinks\\n)\\n\\n# ============================================================================\\n# APP INITIALIZATION\\n# ============================================================================\\n\\napp = FastAPI(\\n    title=\\\"Hypernet API\\\",\\n    description=\\\"Personal data operating system API\\\",\\n    version=\\\"0.1.0\\\"\\n)\\n\\n# CORS for development (VR app running locally)\\napp.add_middleware(\\n    CORSMiddleware,\\n    allow_origins=[\\\"*\\\"],  # In production, restrict this\\n    allow_credentials=True,\\n    allow_methods=[\\\"*\\\"],\\n    allow_headers=[\\\"*\\\"],\\n)\\n\\n# Database path\\nDB_PATH = \\\"hypernet.db\\\"\\n\\n\\n# ============================================================================\\n# DATABASE CONNECTION\\n# ============================================================================\\n\\ndef get_db():\\n    \\\"\\\"\\\"Get database connection\\\"\\\"\\\"\\n    conn = sqlite3.connect(DB_PATH)\\n    conn.row_factory = sqlite3.Row\\n    try:\\n        yield conn\\n    finally:\\n        conn.close()\\n\\n\\n# ============================================================================\\n# UTILITY FUNCTIONS\\n# ============================================================================\\n\\ndef row_to_dict(row) -> dict:\\n    \\\"\\\"\\\"Convert SQLite row to dictionary\\\"\\\"\\\"\\n    return dict(row) if row else None\\n\\n\\ndef rows_to_list(rows) -> list:\\n    \\\"\\\"\\\"Convert SQLite rows to list of dictionaries\\\"\\\"\\\"\\n    return [dict(row) for row in rows]\\n\\n\\n# ============================================================================\\n# HEALTH CHECK\\n# ============================================================================\\n\\n@app.get(\\\"/\\\")\\ndef root():\\n    \\\"\\\"\\\"Health check endpoint\\\"\\\"\\\"\\n    return {\\n        \\\"status\\\": \\\"healthy\\\",\\n        \\\"service\\\": \\\"Hypernet API\\\",\\n        \\\"version\\\": \\\"0.1.0\\\",\\n        \\\"endpoints\\\": {\\n            \\\"photos\\\": \\\"/photos\\\",\\n            \\\"search\\\": \\\"/search\\\",\\n            \\\"timeline\\\": \\\"/timeline\\\",\\n            \\\"ai\\\": \\\"/ai/query\\\",\\n            \\\"people\\\": \\\"/people\\\",\\n            \\\"links\\\": \\\"/links/{address}\\\"\\n        }\\n    }\\n\\n\\n@app.get(\\\"/health\\\")\\ndef health_check(conn: sqlite3.Connection = Depends(get_db)):\\n    \\\"\\\"\\\"Detailed health check with database stats\\\"\\\"\\\"\\n    cursor = conn.cursor()\\n\\n    # Get counts\\n    cursor.execute(\\\"SELECT COUNT(*) as count FROM objects\\\")\\n    total_objects = cursor.fetchone()['count']\\n\\n    cursor.execute(\\\"SELECT COUNT(*) as count FROM photos\\\")\\n    total_photos = cursor.fetchone()['count']\\n\\n    cursor.execute(\\\"SELECT COUNT(*) as count FROM links\\\")\\n    total_links = cursor.fetchone()['count']\\n\\n    return {\\n        \\\"status\\\": \\\"healthy\\\",\\n        \\\"database\\\": \\\"connected\\\",\\n        \\\"stats\\\": {\\n            \\\"total_objects\\\": total_objects,\\n            \\\"total_photos\\\": total_photos,\\n            \\\"total_links\\\": total_links\\n        }\\n    }\\n\\n\\n# ============================================================================\\n# PHOTO ENDPOINTS\\n# ============================================================================\\n\\n@app.get(\\\"/photos\\\")\\ndef get_photos(\\n    owner: str = Query(\\\"1.1\\\", description=\\\"Owner Hypernet Address\\\"),\\n    limit: int = Query(50, le=1000, description=\\\"Max results\\\"),\\n    offset: int = Query(0, ge=0, description=\\\"Pagination offset\\\"),\\n    start_date: Optional[str] = None,\\n    end_date: Optional[str] = None,\\n    conn: sqlite3.Connection = Depends(get_db)\\n):\\n    \\\"\\\"\\\"Get photos for an owner with optional date filtering\\\"\\\"\\\"\\n\\n    cursor = conn.cursor()\\n\\n    query = \\\"\\\"\\\"\\n        SELECT\\n            o.hypernet_address,\\n            o.title,\\n            o.description,\\n            o.file_path,\\n            o.created_at,\\n            o.original_date,\\n            p.width,\\n            p.height,\\n            p.taken_at,\\n            p.latitude,\\n            p.longitude,\\n            p.location_name,\\n            p.camera_make,\\n            p.camera_model,\\n            p.thumbnail_large,\\n            p.ai_caption,\\n            p.ai_tags\\n        FROM objects o\\n        JOIN photos p ON o.id = p.object_id\\n        WHERE o.owner_address = ?\\n          AND o.status = 'active'\\n    \\\"\\\"\\\"\\n\\n    params = [owner]\\n\\n    if start_date:\\n        query += \\\" AND p.taken_at >= ?\\\"\\n        params.append(start_date)\\n\\n    if end_date:\\n        query += \\\" AND p.taken_at <= ?\\\"\\n        params.append(end_date)\\n\\n    query += \\\" ORDER BY p.taken_at DESC LIMIT ? OFFSET ?\\\"\\n    params.extend([limit, offset])\\n\\n    cursor.execute(query, params)\\n    photos = rows_to_list(cursor.fetchall())\\n\\n    # Parse JSON fields\\n    for photo in photos:\\n        if photo.get('ai_tags'):\\n            photo['ai_tags'] = json.loads(photo['ai_tags'])\\n\\n    return {\\n        \\\"count\\\": len(photos),\\n        \\\"photos\\\": photos,\\n        \\\"pagination\\\": {\\n            \\\"limit\\\": limit,\\n            \\\"offset\\\": offset,\\n            \\\"next_offset\\\": offset + limit if len(photos) == limit else None\\n        }\\n    }\\n\\n\\n@app.get(\\\"/photos/{address}\\\")\\ndef get_photo(\\n    address: str,\\n    conn: sqlite3.Connection = Depends(get_db)\\n):\\n    \\\"\\\"\\\"Get a single photo with full details and links\\\"\\\"\\\"\\n\\n    cursor = conn.cursor()\\n\\n    # Get photo\\n    cursor.execute(\\\"\\\"\\\"\\n        SELECT\\n            o.*,\\n            p.width, p.height, p.orientation,\\n            p.camera_make, p.camera_model, p.lens_model,\\n            p.iso, p.aperture, p.shutter_speed, p.focal_length, p.flash,\\n            p.latitude, p.longitude, p.altitude, p.location_name,\\n            p.taken_at, p.thumbnail_small, p.thumbnail_medium, p.thumbnail_large,\\n            p.ai_caption, p.ai_tags, p.ai_detected_faces\\n        FROM objects o\\n        JOIN photos p ON o.id = p.object_id\\n        WHERE o.hypernet_address = ?\\n    \\\"\\\"\\\", (address,))\\n\\n    photo = row_to_dict(cursor.fetchone())\\n\\n    if not photo:\\n        raise HTTPException(status_code=404, detail=\\\"Photo not found\\\")\\n\\n    # Parse JSON fields\\n    if photo.get('metadata'):\\n        photo['metadata'] = json.loads(photo['metadata'])\\n    if photo.get('ai_tags'):\\n        photo['ai_tags'] = json.loads(photo['ai_tags'])\\n    if photo.get('ai_detected_faces'):\\n        photo['ai_detected_faces'] = json.loads(photo['ai_detected_faces'])\\n\\n    # Get people in photo\\n    cursor.execute(\\\"\\\"\\\"\\n        SELECT p.*, o.title\\n        FROM links l\\n        JOIN people p ON l.target_address = p.hypernet_address\\n        JOIN objects o ON p.object_id = o.id\\n        WHERE l.source_address = ?\\n          AND l.link_type = 'depicts'\\n          AND l.status = 'active'\\n    \\\"\\\"\\\", (address,))\\n\\n    people = rows_to_list(cursor.fetchall())\\n\\n    # Get location\\n    cursor.execute(\\\"\\\"\\\"\\n        SELECT loc.*, o.title\\n        FROM links l\\n        JOIN locations loc ON l.target_address = loc.hypernet_address\\n        JOIN objects o ON loc.object_id = o.id\\n        WHERE l.source_address = ?\\n          AND l.link_type = 'located_at'\\n          AND l.status = 'active'\\n    \\\"\\\"\\\", (address,))\\n\\n    location = row_to_dict(cursor.fetchone())\\n\\n    # Get events\\n    cursor.execute(\\\"\\\"\\\"\\n        SELECT e.*, o.title\\n        FROM links l\\n        JOIN events e ON l.target_address = e.hypernet_address\\n        JOIN objects o ON e.object_id = o.id\\n        WHERE l.source_address = ?\\n          AND l.link_type = 'related_to'\\n          AND l.status = 'active'\\n    \\\"\\\"\\\", (address,))\\n\\n    events = rows_to_list(cursor.fetchall())\\n\\n    return {\\n        \\\"photo\\\": photo,\\n        \\\"people\\\": people,\\n        \\\"location\\\": location,\\n        \\\"events\\\": events\\n    }\\n\\n\\n@app.get(\\\"/photos/{address}/file\\\")\\ndef get_photo_file(\\n    address: str,\\n    size: str = Query(\\\"original\\\", regex=\\\"^(original|large|medium|small)$\\\"),\\n    conn: sqlite3.Connection = Depends(get_db)\\n):\\n    \\\"\\\"\\\"Serve photo file (for VR to display)\\\"\\\"\\\"\\n\\n    cursor = conn.cursor()\\n\\n    if size == \\\"original\\\":\\n        cursor.execute(\\\"SELECT file_path FROM objects WHERE hypernet_address = ?\\\", (address,))\\n    else:\\n        cursor.execute(f\\\"SELECT thumbnail_{size} as file_path FROM photos WHERE hypernet_address = ?\\\", (address,))\\n\\n    result = cursor.fetchone()\\n\\n    if not result or not result['file_path']:\\n        raise HTTPException(status_code=404, detail=\\\"Photo file not found\\\")\\n\\n    file_path = result['file_path']\\n\\n    if not os.path.exists(file_path):\\n        raise HTTPException(status_code=404, detail=\\\"Photo file not found on disk\\\")\\n\\n    return FileResponse(file_path)\\n\\n\\n# ============================================================================\\n# SEARCH ENDPOINTS\\n# ============================================================================\\n\\n@app.post(\\\"/search\\\")\\ndef search(\\n    request: SearchRequest,\\n    conn: sqlite3.Connection = Depends(get_db)\\n):\\n    \\\"\\\"\\\"Full-text search across all objects\\\"\\\"\\\"\\n\\n    cursor = conn.cursor()\\n\\n    # Build query\\n    query = \\\"\\\"\\\"\\n        SELECT\\n            o.hypernet_address,\\n            o.object_type,\\n            o.title,\\n            o.description,\\n            o.original_date,\\n \n... [truncated]",
      "content_file": "node.json"
    },
    "created_at": "2026-02-17T01:20:12.724170+00:00",
    "updated_at": "2026-02-17T01:20:12.724170+00:00",
    "deleted_at": null,
    "source_type": "import",
    "source_id": "folder:8"
  }
}