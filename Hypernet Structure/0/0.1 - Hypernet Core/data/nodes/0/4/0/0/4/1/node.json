{
  "address": "0.4.0.0.4.1",
  "type_address": null,
  "data": {
    "name": "0.0.4.1-EMAIL.md",
    "type": "file",
    "extension": ".md",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.4 - Object Type Registry\\0.0.4 - Communication Types\\0.0.4.1-EMAIL.md",
    "size": 35589,
    "content": "# EMAIL - Email Messages with Threading Object Type\n\n**Type ID:** `hypernet.communication.email`\n**Version:** 1.0\n**Category:** 0.0.4 - Communication Types\n**Parent:** BaseObject\n**Status:** Active - Core Communication Type\n**Created:** 2026-02-09\n**Last Updated:** 2026-02-09\n\n---\n\n## Object Type Metadata\n\n```yaml\ntype_name: \"Email\"\ntype_id: \"hypernet.communication.email\"\nversion: \"1.0\"\nparent_type: \"BaseObject\"\ncategory: \"0.0.4 - Communication Types\"\nabstract: false\ninstantiable: true\n```\n\n---\n\n## Purpose and Description\n\n### What is Email?\n\nThe Email object type represents email messages imported from any email provider (Gmail, Outlook, iCloud, etc.) or sent/received through Hypernet. Emails are first-class objects with full support for threading, attachments, recipients, and rich metadata. This enables unified email management across all accounts and providers.\n\n### Revolutionary Design Philosophy\n\nHypernet treats email as structured communication data, not locked-in proprietary formats:\n- **Provider Agnostic** - Emails from Gmail, Outlook, Yahoo, or any IMAP/POP3 provider use the same schema\n- **Thread-Aware** - Native support for conversation threading with parent-child relationships\n- **Attachment Management** - Attachments become Media objects, enabling deduplication and organization\n- **Full-Text Searchable** - Search across all email accounts simultaneously\n- **Privacy Preserved** - End-to-end encryption for sensitive emails\n- **AI Enhanced** - Smart categorization, sentiment analysis, action item extraction\n\n### Core Functions\n\n1. **Email Storage** - Store complete email messages with headers, body, and metadata\n2. **Thread Management** - Organize emails into conversations with proper threading\n3. **Attachment Handling** - Extract and store attachments as Media objects\n4. **Contact Extraction** - Automatically create Contact objects from recipients\n5. **Search and Filter** - Full-text search, advanced filters, smart categorization\n6. **Sync Management** - Bidirectional sync with email providers (IMAP/SMTP)\n7. **Action Items** - AI-powered detection of tasks, events, and follow-ups\n\n### When to Use\n\n- Importing email archives from Gmail, Outlook, Apple Mail, etc.\n- Sending and receiving emails through Hypernet\n- Managing multiple email accounts in one unified interface\n- Searching across all email history\n- Extracting attachments for unified media management\n- Tracking conversations and threads\n- AI-powered email organization and prioritization\n\n---\n\n## Inherited Fields from BaseObject\n\n```yaml\nid: UUID\n  - Globally unique email identifier\n  - Generated on import or creation\n  - Immutable\n\ncreated_at: DateTime\n  - Import timestamp (when added to Hypernet)\n  - May differ from sent_at (original send time)\n  - Immutable\n\nupdated_at: DateTime\n  - Last modification timestamp\n  - Updated when email is moved, labeled, or metadata changes\n\ndeleted_at: DateTime (nullable)\n  - Soft delete timestamp\n  - Null for active emails\n  - Emails in trash for 30 days before hard delete\n\nuser_id: UUID\n  - Foreign key to User who owns this email\n  - Required - all emails must have an owner\n  - Determines which account's mailbox this belongs to\n\nmetadata: JSONB\n  - Extensible metadata storage\n  - See Metadata Schema section below\n  - Stores provider-specific data, headers, flags\n```\n\n---\n\n## Required Fields\n\n### Message Identification\n\n```yaml\nmessage_id: String(500)\n  type: String\n  max_length: 500\n  nullable: false\n  indexed: true\n  unique: true (per user)\n  description: \"RFC 5322 Message-ID from email headers\"\n  format: \"<unique-id@domain.com>\"\n  examples:\n    - \"<CAGFj3YmZ9x@mail.gmail.com>\"\n    - \"<abc123.def456@outlook.com>\"\n  purpose: \"Deduplication, thread matching, sync reconciliation\"\n  constraints:\n    - Must be globally unique per user\n    - Used to prevent duplicate imports\n    - Required for IMAP/SMTP compliance\n\nsubject: String(1000)\n  type: String\n  max_length: 1000\n  nullable: false\n  indexed: true\n  description: \"Email subject line\"\n  examples:\n    - \"Re: Q4 Budget Review\"\n    - \"Vacation Photos\"\n    - \"Meeting Tomorrow at 2pm\"\n  searchable: true\n  constraints:\n    - Empty string allowed (for emails without subject)\n    - Truncated if exceeds max_length\n    - Preserved exactly as received\n\nsent_at: DateTime\n  type: DateTime\n  nullable: false\n  indexed: true\n  timezone: true\n  description: \"When the email was sent (from Date header)\"\n  sources:\n    - Email Date header (RFC 5322)\n    - SMTP envelope timestamp\n  usage: \"Primary field for chronological ordering\"\n  constraints:\n    - Must be valid timestamp\n    - Can be in past or future\n    - Used for thread sorting\n```\n\n### Message Content\n\n```yaml\nbody_text: Text\n  type: Text\n  nullable: true\n  description: \"Plain text version of email body\"\n  extraction:\n    - From text/plain MIME part\n    - Converted from HTML if text not available\n  searchable: true\n  constraints:\n    - Can be empty for HTML-only emails\n    - UTF-8 encoded\n    - Line breaks preserved\n\nbody_html: Text\n  type: Text\n  nullable: true\n  description: \"HTML version of email body\"\n  extraction:\n    - From text/html MIME part\n    - Sanitized for security (XSS prevention)\n  usage: \"Rich email rendering in UI\"\n  constraints:\n    - Can be empty for text-only emails\n    - HTML sanitized before storage\n    - External images tracked separately\n\nhas_attachments: Boolean\n  type: Boolean\n  nullable: false\n  default: false\n  indexed: true\n  description: \"Whether email has file attachments\"\n  derivation: \"Set to true if attachment_count > 0\"\n  usage: \"Quick filtering for emails with attachments\"\n```\n\n### Sender and Recipients\n\n```yaml\nfrom_address: String(500)\n  type: String\n  max_length: 500\n  nullable: false\n  indexed: true\n  description: \"Sender's email address\"\n  format: \"email@domain.com or 'Name <email@domain.com>'\"\n  examples:\n    - \"john.doe@example.com\"\n    - \"Jane Smith <jane@company.com>\"\n  searchable: true\n  constraints:\n    - Must be valid email format\n    - Display name optional\n    - Used for sender filtering\n\nfrom_name: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  description: \"Sender's display name\"\n  examples:\n    - \"John Doe\"\n    - \"Marketing Team\"\n  extraction: \"Parsed from From header display name\"\n  searchable: true\n\nto_addresses: JSONB\n  type: JSONB\n  nullable: false\n  default: []\n  indexed: true (GIN)\n  description: \"Array of recipient email addresses (To: header)\"\n  structure: [\"email1@domain.com\", \"email2@domain.com\"]\n  examples:\n    - [\"alice@example.com\", \"bob@example.com\"]\n  searchable: true\n  constraints:\n    - Each address must be valid email format\n    - Array can be empty (for draft emails)\n\ncc_addresses: JSONB\n  type: JSONB\n  nullable: false\n  default: []\n  indexed: true (GIN)\n  description: \"Array of CC recipient email addresses\"\n  structure: [\"email1@domain.com\", \"email2@domain.com\"]\n  usage: \"Carbon copy recipients\"\n\nbcc_addresses: JSONB\n  type: JSONB\n  nullable: false\n  default: []\n  description: \"Array of BCC recipient email addresses\"\n  structure: [\"email1@domain.com\", \"email2@domain.com\"]\n  usage: \"Blind carbon copy recipients (only visible to sender)\"\n  privacy: \"Not visible in received emails\"\n```\n\n---\n\n## Optional Fields\n\n### Threading and Conversation\n\n```yaml\nthread_id: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  indexed: true\n  description: \"Conversation thread identifier\"\n  sources:\n    - Gmail X-GM-THRID header\n    - References/In-Reply-To headers\n    - Subject-based matching\n  purpose: \"Group related emails into conversations\"\n  usage: \"Display emails in threaded view\"\n\nin_reply_to: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  indexed: true\n  description: \"Message-ID of email this is replying to\"\n  format: \"<message-id@domain.com>\"\n  purpose: \"Build parent-child email relationships\"\n  usage: \"Thread reconstruction\"\n\nreferences: JSONB\n  type: JSONB\n  nullable: true\n  description: \"Array of Message-IDs this email references\"\n  structure: [\"<msg1@domain.com>\", \"<msg2@domain.com>\"]\n  purpose: \"Complete thread ancestry tracking\"\n  sources: \"References header (RFC 5322)\"\n\nparent_email_id: UUID\n  type: UUID\n  nullable: true\n  indexed: true\n  description: \"Foreign key to parent Email object\"\n  references: \"Email.id\"\n  cascade: \"ON DELETE SET NULL\"\n  purpose: \"Direct parent-child relationship in thread\"\n  usage: \"Display conversation hierarchy\"\n```\n\n### Email Classification\n\n```yaml\nfolder: String(200)\n  type: String\n  max_length: 200\n  nullable: true\n  indexed: true\n  description: \"Mailbox folder where email is stored\"\n  examples:\n    - \"INBOX\"\n    - \"Sent\"\n    - \"Archive\"\n    - \"Work/Projects\"\n    - \"[Gmail]/All Mail\"\n  sources:\n    - IMAP folder path\n    - User organization\n  usage: \"Folder-based filtering and organization\"\n\nlabels: JSONB\n  type: JSONB\n  nullable: false\n  default: []\n  indexed: true (GIN)\n  description: \"Array of label/tag strings\"\n  structure: [\"label1\", \"label2\", \"label3\"]\n  examples:\n    - [\"work\", \"urgent\", \"client-abc\"]\n    - [\"personal\", \"family\"]\n  searchable: true\n  sources:\n    - Gmail labels\n    - User-applied tags\n    - AI categorization\n\nis_read: Boolean\n  type: Boolean\n  nullable: false\n  default: false\n  indexed: true\n  description: \"Whether email has been read\"\n  usage: \"Unread count, filtering\"\n  sync: \"Synced with IMAP \\Seen flag\"\n\nis_starred: Boolean\n  type: Boolean\n  nullable: false\n  default: false\n  indexed: true\n  description: \"Whether email is starred/flagged\"\n  usage: \"Important email filtering\"\n  sync: \"Synced with IMAP \\Flagged\"\n\nis_important: Boolean\n  type: Boolean\n  nullable: false\n  default: false\n  indexed: true\n  description: \"Whether email is marked as important\"\n  sources:\n    - Gmail importance markers\n    - User manual marking\n    - AI priority detection\n\npriority: Enum\n  type: String\n  max_length: 20\n  nullable: true\n  indexed: true\n  description: \"Email priority level\"\n  allowed_values:\n    - \"high\": Urgent, requires immediate attention\n    - \"normal\": Standard priority\n    - \"low\": Can be addressed later\n  sources:\n    - X-Priority header\n    - Importance header\n    - User setting\n```\n\n### Attachment Information\n\n```yaml\nattachment_count: Integer\n  type: Integer\n  nullable: false\n  default: 0\n  description: \"Number of file attachments\"\n  constraints:\n    - Must be >= 0\n    - Auto-calculated from attachments relationship\n  usage: \"Quick attachment presence check\"\n\ntotal_attachment_size: BigInteger\n  type: BigInteger\n  nullable: false\n  default: 0\n  description: \"Total size of all attachments in bytes\"\n  unit: \"bytes\"\n  constraints:\n    - Must be >= 0\n    - Sum of all attachment file sizes\n  usage: \"Storage tracking, quota management\"\n```\n\n### Source and Sync Information\n\n```yaml\naccount_email: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  indexed: true\n  description: \"Email account this message belongs to\"\n  examples:\n    - \"user@gmail.com\"\n    - \"john.doe@company.com\"\n  purpose: \"Multi-account email management\"\n  usage: \"Filter by account, display account badge\"\n\nprovider: String(100)\n  type: String\n  max_length: 100\n  nullable: true\n  indexed: true\n  description: \"Email provider/service\"\n  allowed_values:\n    - \"gmail\": Google Gmail\n    - \"outlook\": Microsoft Outlook/Office 365\n    - \"icloud\": Apple iCloud Mail\n    - \"yahoo\": Yahoo Mail\n    - \"imap\": Generic IMAP server\n    - \"exchange\": Microsoft Exchange\n  purpose: \"Provider-specific features and sync\"\n\nintegration_id: UUID\n  type: UUID\n  nullable: true\n  indexed: true\n  description: \"Foreign key to Integration that synced this email\"\n  references: \"Integration.id\"\n  cascade: \"ON DELETE SET NULL\"\n  purpose: \"Track which integration manages this email\"\n\nimap_uid: BigInteger\n  type: BigInteger\n  nullable: true\n  indexed: true\n  description: \"IMAP UID for this message on server\"\n  purpose: \"IMAP sync reconciliation\"\n  constraints:\n    - Unique per folder per account\n    - Used for efficient sync\n\nsmtp_message_id: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  description: \"SMTP envelope Message-ID (may differ from header)\"\n  purpose: \"Delivery tracking, bounce handling\"\n```\n\n### Delivery and Receipt\n\n```yaml\nreceived_at: DateTime\n  type: DateTime\n  nullable: true\n  indexed: true\n  timezone: true\n  description: \"When email was received by server\"\n  sources: \"Received header timestamp\"\n  usage: \"Distinguish send time from receive time\"\n\ndelivered_at: DateTime\n  type: DateTime\n  nullable: true\n  timezone: true\n  description: \"When email was delivered to recipient (for sent emails)\"\n  sources: \"SMTP delivery receipt\"\n  usage: \"Track email delivery status\"\n\nread_at: DateTime\n  type: DateTime\n  nullable: true\n  timezone: true\n  description: \"When email was first marked as read\"\n  usage: \"Read receipt, response time analysis\"\n  privacy: \"Not shared unless user enables read receipts\"\n\nbounce_status: String(50)\n  type: String\n  max_length: 50\n  nullable: true\n  description: \"Bounce/delivery failure status\"\n  allowed_values:\n    - \"delivered\": Successfully delivered\n    - \"bounced\": Hard bounce (permanent failure)\n    - \"soft_bounce\": Temporary failure\n    - \"spam\": Marked as spam\n  sources: \"SMTP bounce messages, delivery receipts\"\n```\n\n---\n\n## Metadata Schema\n\nThe `metadata` JSONB field stores extensible email-specific and provider data:\n\n```json\n{\n  \"headers\": {\n    \"received\": [\n      \"from mail-server.example.com by mx.gmail.com\",\n      \"from client.example.com by mail-server.example.com\"\n    ],\n    \"x-mailer\": \"Apple Mail (2.3654.60.0.1)\",\n    \"x-original-sender\": \"original@example.com\",\n    \"list-unsubscribe\": \"<mailto:unsubscribe@newsletter.com>\",\n    \"authentication_results\": \"spf=pass smtp.mailfrom=example.com\"\n  },\n  \"provider\": {\n    \"gmail\": {\n      \"thread_id\": \"16f8a1b2c3d4e5f6\",\n      \"message_id\": \"16f8a1b2c3d4e5f7\",\n      \"labels\": [\"INBOX\", \"CATEGORY_PROMOTIONS\", \"UNREAD\"],\n      \"snippet\": \"Email preview text...\",\n      \"history_id\": \"123456\"\n    },\n    \"outlook\": {\n      \"conversation_id\": \"AAQkAGY3...\",\n      \"internet_message_id\": \"<abc@outlook.com>\",\n      \"categories\": [\"Work\", \"Important\"],\n      \"flag_status\": \"flagged\"\n    }\n  },\n  \"ai_analysis\": {\n    \"category\": \"newsletter\",\n    \"sentiment\": \"neutral\",\n    \"language\": \"en\",\n    \"confidence\": 0.95,\n    \"action_items\": [\n      {\n        \"action\": \"Review Q4 budget\",\n        \"due_date\": \"2024-02-15\",\n        \"confidence\": 0.87\n      }\n    ],\n    \"entities\": [\n      {\"type\": \"person\", \"name\": \"John Smith\", \"confidence\": 0.92},\n      {\"type\": \"organization\", \"name\": \"Acme Corp\", \"confidence\": 0.89},\n      {\"type\": \"date\", \"value\": \"2024-02-15\", \"confidence\": 0.95}\n    ],\n    \"summary\": \"Meeting request for Q4 budget review on Feb 15th\",\n    \"key_points\": [\n      \"Budget review meeting scheduled\",\n      \"Attendance required from all department heads\",\n      \"Preparation materials attached\"\n    ],\n    \"is_newsletter\": true,\n    \"is_promotional\": false,\n    \"is_transactional\": false,\n    \"spam_score\": 0.02\n  },\n  \"security\": {\n    \"spf_pass\": true,\n    \"dkim_pass\": true,\n    \"dmarc_pass\": true,\n    \"is_encrypted\": false,\n    \"is_signed\": false,\n    \"virus_scan\": \"clean\",\n    \"phishing_score\": 0.01\n  },\n  \"tracking\": {\n    \"has_tracking_pixels\": false,\n    \"has_tracking_links\": true,\n    \"tracking_domains\": [\"track.newsletter.com\"]\n  },\n  \"rendering\": {\n    \"stripped_html\": false,\n    \"external_images_allowed\": false,\n    \"css_sanitized\": true\n  }\n}\n```\n\n---\n\n## Relationships to Other Object Types\n\n### Ownership and Integration\n\n```yaml\nowned_by: User\n  description: \"User who owns this email\"\n  cardinality: \"N:1 (many emails, one owner)\"\n  implementation: \"user_id foreign key\"\n  cascade: \"ON DELETE CASCADE\"\n\nsynced_by: Integration\n  description: \"Integration that synced this email\"\n  cardinality: \"N:1 (many emails, one integration)\"\n  implementation: \"integration_id foreign key\"\n  cascade: \"ON DELETE SET NULL\"\n```\n\n### Threading\n\n```yaml\nparent_email: Email\n  description: \"Email this is replying to\"\n  cardinality: \"N:1 (many replies, one parent)\"\n  implementation: \"parent_email_id foreign key\"\n  cascade: \"ON DELETE SET NULL\"\n  usage: \"Build conversation threads\"\n\nchild_emails: Email\n  description: \"Emails that are replies to this one\"\n  cardinality: \"1:N (one parent, many replies)\"\n  implementation: \"Reverse relationship\"\n  usage: \"Display conversation thread\"\n\nthread_emails: Email\n  description: \"All emails in same conversation thread\"\n  cardinality: \"M:N (many emails, many threads)\"\n  implementation: \"thread_id grouping\"\n  usage: \"Display full conversation\"\n```\n\n### Attachments\n\n```yaml\nattachments: Media\n  description: \"File attachments extracted from email\"\n  cardinality: \"1:N (one email, many attachments)\"\n  link_type: \"email_attachment\"\n  implementation: \"Join table with ordering and filename\"\n  examples:\n    - Email has PDF report, Excel spreadsheet, photo\n  processing:\n    - Attachments extracted and stored as Media objects\n    - Original email preserves attachment metadata\n    - Attachments can be deduplicated across emails\n```\n\n### Contacts\n\n```yaml\nfrom_contact: Contact\n  description: \"Contact object for sender\"\n  cardinality: \"N:1 (many emails, one contact)\"\n  link_type: \"email_from\"\n  implementation: \"Auto-created from from_address\"\n  usage: \"Contact management, sender filtering\"\n\nto_contacts: Contact\n  description: \"Contact objects for recipients\"\n  cardinality: \"M:N (many emails, many contacts)\"\n  link_type: \"email_to\"\n  implementation: \"Auto-created from to_addresses\"\n  usage: \"Recipient tracking, conversation history\"\n```\n\n### Extracted Entities\n\n```yaml\nmentioned_people: Contact\n  description: \"People mentioned in email body\"\n  cardinality: \"M:N (many emails, many people)\"\n  link_type: \"mentioned_in\"\n  sources: \"AI entity extraction\"\n\nreferenced_events: CalendarEvent\n  description: \"Calendar events referenced in email\"\n  cardinality: \"M:N (many emails, many events)\"\n  link_type: \"references\"\n  sources: \"AI event extraction, calendar invites\"\n\ngenerated_tasks: Task\n  description: \"Tasks created from email action items\"\n  cardinality: \"1:N (one email, many tasks)\"\n  link_type: \"derived_from\"\n  sources: \"AI action item extraction, user creation\"\n```\n\n---\n\n## API Endpoints\n\n### Email Retrieval\n\n```http\nGET /api/v1/emails/{id}\n  Description: Get single email by ID\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    {complete email object with attachments, thread info}\n  Privacy:\n    - Only owner can access\n    - Returns 404 if not found or unauthorized\n\nGET /api/v1/emails\n  Description: List user's emails with filtering\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    account: user@gmail.com - Filter by email account\n    folder: INBOX - Filter by folder\n    label: work - Filter by label\n    is_read: true|false - Filter by read status\n    is_starred: true|false - Filter starred only\n    has_attachments: true|false - Filter by attachments\n    from: sender@example.com - Filter by sender\n    to: recipient@example.com - Filter by recipient\n    thread_id: {thread-id} - Get all emails in thread\n    date_from: 2024-01-01\n    date_to: 2024-12-31\n    search: \"query\" - Full-text search\n    limit: 50 (default: 50, max: 200)\n    offset: 0\n    sort: sent_at|received_at|subject (default: sent_at)\n    order: asc|desc (default: desc)\n  Response: 200 OK\n    {\n      \"emails\": [{email objects}],\n      \"total\": 15234,\n      \"unread_count\": 234,\n      \"limit\": 50,\n      \"offset\": 0\n    }\n\nGET /api/v1/emails/{id}/thread\n  Description: Get complete conversation thread for email\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    {\n      \"thread_id\": \"thread-uuid\",\n      \"emails\": [{email objects in chronological order}],\n      \"participants\": [\"email1@example.com\", \"email2@example.com\"],\n      \"subject\": \"Thread subject\",\n      \"total_messages\": 7,\n      \"unread_count\": 2\n    }\n\nGET /api/v1/emails/{id}/raw\n  Description: Get raw RFC 5322 email source\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    Content-Type: message/rfc822\n    {raw email with headers and body}\n```\n\n### Email Management\n\n```http\nPATCH /api/v1/emails/{id}\n  Description: Update email metadata\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"is_read\": true,\n      \"is_starred\": false,\n      \"folder\": \"Archive\",\n      \"labels\": [\"work\", \"important\"]\n    }\n  Response: 200 OK\n    {updated email object}\n  Sync:\n    - Changes synced back to provider (IMAP)\n    - Read status updates \\Seen flag\n    - Starred updates \\Flagged\n\nPOST /api/v1/emails/{id}/move\n  Description: Move email to different folder\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"destination_folder\": \"Archive\"\n    }\n  Response: 200 OK\n    {updated email object}\n  Sync: IMAP MOVE command\n\nDELETE /api/v1/emails/{id}\n  Description: Move email to trash (soft delete)\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 204 No Content\n  Behavior:\n    - Sets deleted_at timestamp\n    - Moves to Trash folder\n    - Synced with provider\n    - Hard deleted after 30 days\n\nPOST /api/v1/emails/{id}/restore\n  Description: Restore email from trash\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    {restored email object}\n```\n\n### Email Sending\n\n```http\nPOST /api/v1/emails/send\n  Description: Send new email\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"account_email\": \"user@gmail.com\",\n      \"to\": [\"recipient@example.com\"],\n      \"cc\": [],\n      \"bcc\": [],\n      \"subject\": \"Email subject\",\n      \"body_text\": \"Plain text body\",\n      \"body_html\": \"<p>HTML body</p>\",\n      \"attachments\": [\"media-uuid-1\", \"media-uuid-2\"],\n      \"in_reply_to\": \"message-id\" (optional)\n    }\n  Response: 201 Created\n    {\n      \"id\": \"email-uuid\",\n      \"message_id\": \"<generated-message-id>\",\n      \"status\": \"sent\",\n      \"sent_at\": \"2026-02-09T15:00:00Z\"\n    }\n  Processing:\n    - Email sent via SMTP\n    - Stored in Sent folder\n    - Synced with provider\n    - Attachments uploaded if needed\n\nPOST /api/v1/emails/{id}/reply\n  Description: Reply to an email\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"body_text\": \"Reply text\",\n      \"body_html\": \"<p>Reply HTML</p>\",\n      \"reply_all\": false,\n      \"attachments\": []\n    }\n  Response: 201 Created\n    {new email object}\n  Behavior:\n    - Sets In-Reply-To header\n    - Adds Re: prefix to subject\n    - Includes original recipients if reply_all=true\n    - Creates parent-child relationship\n\nPOST /api/v1/emails/{id}/forward\n  Description: Forward an email\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"to\": [\"forward-to@example.com\"],\n      \"body_text\": \"Forward message\",\n      \"include_attachments\": true\n    }\n  Response: 201 Created\n    {new email object}\n  Behavior:\n    - Adds Fwd: prefix to subject\n    - Includes original message in body\n    - Copies attachments if requested\n```\n\n### Bulk Operations\n\n```http\nPOST /api/v1/emails/bulk-update\n  Description: Update multiple emails\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"email_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"],\n      \"updates\": {\n        \"is_read\": true,\n        \"labels\": [\"archived\"]\n      }\n    }\n  Response: 200 OK\n    {\n      \"updated_count\": 3\n    }\n\nPOST /api/v1/emails/bulk-move\n  Description: Move multiple emails to folder\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"email_ids\": [\"uuid1\", \"uuid2\"],\n      \"destination_folder\": \"Archive\"\n    }\n  Response: 200 OK\n    {\n      \"moved_count\": 2\n    }\n\nDELETE /api/v1/emails/bulk-delete\n  Description: Delete multiple emails\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"email_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n    }\n  Response: 200 OK\n    {\n      \"deleted_count\": 3\n    }\n```\n\n### Sync Operations\n\n```http\nPOST /api/v1/emails/sync\n  Description: Trigger email sync for account\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"account_email\": \"user@gmail.com\",\n      \"full_sync\": false\n    }\n  Response: 202 Accepted\n    {\n      \"sync_job_id\": \"job-uuid\",\n      \"status\": \"queued\"\n    }\n\nGET /api/v1/emails/sync/status\n  Description: Get sync status for account\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    account_email: user@gmail.com\n  Response: 200 OK\n    {\n      \"status\": \"syncing|completed|failed\",\n      \"last_sync_at\": \"2026-02-09T15:00:00Z\",\n      \"new_emails\": 23,\n      \"updated_emails\": 5,\n      \"errors\": []\n    }\n```\n\n---\n\n## Database Schema (SQLAlchemy Model Reference)\n\n```python\nfrom sqlalchemy import (\n    Column, String, Text, Boolean, Integer, BigInteger,\n    DateTime, ForeignKey, Index, CheckConstraint, Enum as SQLEnum\n)\nfrom sqlalchemy.dialects.postgresql import UUID, JSONB\nfrom sqlalchemy.orm import relationship\nfrom app.models.base import BaseObject\n\nclass Email(BaseObject):\n    \"\"\"\n    Email message object with threading and attachments\n\n    Inherits from BaseObject: id, user_id, created_at, updated_at, deleted_at, metadata\n    \"\"\"\n\n    __tablename__ = \"emails\"\n\n    # Message Identification (Required)\n    message_id = Column(\n        String(500),\n        nullable=False,\n        index=True,\n        doc=\"RFC 5322 Message-ID\"\n    )\n    subject = Column(\n        String(1000),\n        nullable=False,\n        index=True,\n        doc=\"Email subject line\"\n    )\n    sent_at = Column(\n        DateTime(timezone=True),\n        nullable=False,\n        index=True,\n        doc=\"When email was sent\"\n    )\n\n    # Message Content (Required)\n    body_text = Column(\n        Text,\n        nullable=True,\n        doc=\"Plain text email body\"\n    )\n    body_html = Column(\n        Text,\n        nullable=True,\n        doc=\"HTML email body\"\n    )\n    has_attachments = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        index=True,\n        doc=\"Whether email has attachments\"\n    )\n\n    # Sender and Recipients (Required)\n    from_address = Column(\n        String(500),\n        nullable=False,\n        index=True,\n        doc=\"Sender email address\"\n    )\n    from_name = Column(\n        String(500),\n        nullable=True,\n        doc=\"Sender display name\"\n    )\n    to_addresses = Column(\n        JSONB,\n        nullable=False,\n        default=[],\n        doc=\"Array of To: recipients\"\n    )\n    cc_addresses = Column(\n        JSONB,\n        nullable=False,\n        default=[],\n        doc=\"Array of CC recipients\"\n    )\n    bcc_addresses = Column(\n        JSONB,\n        nullable=False,\n        default=[],\n        doc=\"Array of BCC recipients\"\n    )\n\n    # Threading (Optional)\n    thread_id = Column(\n        String(500),\n        nullable=True,\n        index=True,\n        doc=\"Conversation thread ID\"\n    )\n    in_reply_to = Column(\n        String(500),\n        nullable=True,\n        index=True,\n        doc=\"Message-ID of email being replied to\"\n    )\n    references = Column(\n        JSONB,\n        nullable=True,\n        doc=\"Array of referenced Message-IDs\"\n    )\n    parent_email_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('emails.id', ondelete='SET NULL'),\n        nullable=True,\n        index=True,\n        doc=\"Parent email in thread\"\n    )\n\n    # Classification (Optional)\n    folder = Column(\n        String(200),\n        nullable=True,\n        index=True,\n        doc=\"Mailbox folder\"\n    )\n    labels = Column(\n        JSONB,\n        nullable=False,\n        default=[],\n        doc=\"Array of labels/tags\"\n    )\n    is_read = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        index=True,\n        doc=\"Read status\"\n    )\n    is_starred = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        index=True,\n        doc=\"Starred/flagged status\"\n    )\n    is_important = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        index=True,\n        doc=\"Important status\"\n    )\n    priority = Column(\n        SQLEnum('high', 'normal', 'low', name='email_priority_enum'),\n        nullable=True,\n        index=True,\n        doc=\"Email priority\"\n    )\n\n    # Attachments (Optional)\n    attachment_count = Column(\n        Integer,\n        nullable=False,\n        default=0,\n        doc=\"Number of attachments\"\n    )\n    total_attachment_size = Column(\n        BigInteger,\n        nullable=False,\n        default=0,\n        doc=\"Total attachment size in bytes\"\n    )\n\n    # Source and Sync (Optional)\n    account_email = Column(\n        String(500),\n        nullable=True,\n        index=True,\n        doc=\"Email account this belongs to\"\n    )\n    provider = Column(\n        String(100),\n        nullable=True,\n        index=True,\n        doc=\"Email provider\"\n    )\n    integration_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('integrations.id', ondelete='SET NULL'),\n        nullable=True,\n        index=True,\n        doc=\"Integration that synced this email\"\n    )\n    imap_uid = Column(\n        BigInteger,\n        nullable=True,\n        index=True,\n        doc=\"IMAP UID on server\"\n    )\n    smtp_message_id = Column(\n        String(500),\n        nullable=True,\n        doc=\"SMTP envelope Message-ID\"\n    )\n\n    # Delivery (Optional)\n    received_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        index=True,\n        doc=\"When received by server\"\n    )\n    delivered_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"When delivered to recipient\"\n    )\n    read_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"When first marked as read\"\n    )\n    bounce_status = Column(\n        String(50),\n        nullable=True,\n        doc=\"Delivery/bounce status\"\n    )\n\n    # Relationships\n    owner = relationship(\"User\", foreign_keys=[BaseObject.user_id])\n    integration = relationship(\"Integration\", foreign_keys=[integration_id])\n    parent_email = relationship(\n        \"Email\",\n        remote_side=\"Email.id\",\n        foreign_keys=[parent_email_id]\n    )\n    attachments = relationship(\n        \"Media\",\n        secondary=\"email_attachments\",\n        back_populates=\"emails\"\n    )\n\n    # Table Constraints\n    __table_args__ = (\n        # Message ID must be unique per user\n        Index('idx_email_user_message_id', 'user_id', 'message_id', unique=True),\n\n        # Attachment counts must be non-negative\n        CheckConstraint(\n            'attachment_count >= 0',\n            name='check_attachment_count_positive'\n        ),\n        CheckConstraint(\n            'total_attachment_size >= 0',\n            name='check_attachment_size_positive'\n        ),\n\n        # Composite indexes for common queries\n        Index('idx_email_account_folder', 'account_email', 'folder'),\n        Index('idx_email_thread', 'thread_id'),\n        Index('idx_email_sent_at', 'sent_at'),\n        Index('idx_email_from', 'from_address'),\n\n        # GIN indexes for array fields\n        Index('idx_email_to_addresses', 'to_addresses', postgresql_using='gin'),\n        Index('idx_email_labels', 'labels', postgresql_using='gin'),\n\n        # Filtered indexes for performance\n        Index('idx_email_unread', 'user_id', 'is_read', postgresql_where='is_read = false'),\n        Index('idx_email_starred', 'user_id', 'is_starred', postgresql_where='is_starred = true'),\n    )\n\n    def __repr__(self):\n        return f\"<Email(id={self.id}, subject='{self.subject[:50]}...', from={self.from_address})>\"\n\n    @property\n    def is_reply(self):\n        return self.in_reply_to is not None or self.parent_email_id is not None\n\n    @property\n    def all_recipients(self):\n        \"\"\"Get all recipients (To + CC + BCC)\"\"\"\n        return list(set(self.to_addresses + self.cc_addresses + self.bcc_addresses))\n```\n\n---\n\n## Privacy and Security Considerations\n\n### Access Control\n\n1. **Ownership Enforcement**\n   - Emails only accessible by owner\n   - Multi-account support with proper isolation\n   - No cross-user email access\n\n2. **Encryption**\n   - Email bodies encrypted at rest\n   - TLS for all IMAP/SMTP connections\n   - Support for PGP/S/MIME encrypted emails\n\n3. **Authentication**\n   - OAuth 2.0 for Gmail, Outlook, etc.\n   - App-specific passwords for IMAP/SMTP\n   - No storage of primary account passwords\n\n### Data Protection\n\n1. **GDPR Compliance**\n   - User can export all emails and metadata\n   - User can delete all emails permanently\n   - Right to be forgotten (delete all data)\n\n2. **Privacy Features**\n   - Option to disable tracking pixels\n   - Warning for tracking links\n   - Automatic phishing detection\n   - Spam filtering\n\n---\n\n## Validation Rules\n\n### On Creation/Import\n\n```yaml\nmessage_id:\n  - Must be unique per user\n  - Must be valid RFC 5322 format\n  - Required for import (generated for sent emails)\n\nemail_addresses:\n  - All addresses must be valid email format\n  - At least one To: recipient for sent emails\n  - From address required\n\ncontent:\n  - At least one of body_text or body_html required\n  - HTML sanitized for security\n  - Subject can be empty\n```\n\n---\n\n## Use Cases and Examples\n\n### Example 1: Gmail Import\n\n```json\n{\n  \"id\": \"email-uuid-001\",\n  \"user_id\": \"user-uuid\",\n  \"message_id\": \"<CAGFj3YmZ9x@mail.gmail.com>\",\n  \"subject\": \"Re: Q4 Budget Review Meeting\",\n  \"sent_at\": \"2024-02-09T14:30:00Z\",\n  \"from_address\": \"john.doe@company.com\",\n  \"from_name\": \"John Doe\",\n  \"to_addresses\": [\"team@company.com\"],\n  \"cc_addresses\": [\"manager@company.com\"],\n  \"bcc_addresses\": [],\n  \"body_text\": \"Thanks for scheduling this. I'll prepare the slides.\",\n  \"body_html\": \"<p>Thanks for scheduling this. I'll prepare the slides.</p>\",\n  \"has_attachments\": true,\n  \"attachment_count\": 2,\n  \"thread_id\": \"16f8a1b2c3d4e5f6\",\n  \"in_reply_to\": \"<previous-message-id@mail.gmail.com>\",\n  \"folder\": \"INBOX\",\n  \"labels\": [\"work\", \"important\"],\n  \"is_read\": true,\n  \"is_starred\": false,\n  \"account_email\": \"user@gmail.com\",\n  \"provider\": \"gmail\",\n  \"created_at\": \"2026-02-09T15:00:00Z\"\n}\n```\n\n---\n\n**Status:** Active - Core Communication Type\n**Version:** 1.0\n**Authority:** 0.0.4 - Communication Types\n**Created:** 2026-02-09\n**Owner:** Hypernet Core (0.*)\n"
  },
  "created_at": "2026-02-17T01:23:29.232749+00:00",
  "updated_at": "2026-02-17T01:23:29.232749+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:0.0.4.1-EMAIL.md"
}