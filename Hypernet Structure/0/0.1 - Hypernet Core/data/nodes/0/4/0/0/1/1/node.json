{
  "address": "0.4.0.0.1.1",
  "type_address": null,
  "data": {
    "name": "0.0.1.1-USER.md",
    "type": "file",
    "extension": ".md",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.4 - Object Type Registry\\0.0.1 - Core Types\\0.0.1.1-USER.md",
    "size": 34730,
    "content": "# USER - Human or AI Account Object Type\n\n**Type ID:** `hypernet.core.user`\n**Version:** 1.0\n**Category:** 0.0.1 - Core Types\n**Parent:** BaseObject\n**Status:** Active - Critical Core Type\n**Created:** 2026-02-09\n**Last Updated:** 2026-02-09\n\n---\n\n## Object Type Metadata\n\n```yaml\ntype_name: \"User\"\ntype_id: \"hypernet.core.user\"\nversion: \"1.0\"\nparent_type: \"BaseObject\"\ncategory: \"0.0.1 - Core Types\"\nabstract: false\ninstantiable: true\n```\n\n---\n\n## Purpose and Description\n\n### What is a User?\n\nThe User object type represents any entity that can authenticate, own data, and interact with Hypernet. This includes human users, AI agents, and service accounts. User is the foundational identity object in Hypernet's ownership model.\n\n### Revolutionary Design Philosophy\n\nHypernet treats AI as first-class citizens. AI accounts are not service accounts or bots - they are **users** with the same capabilities as humans:\n- AI can own objects (AIMemory, AIContribution, generated content)\n- AI can authenticate and operate independently\n- AI can transfer ownership and collaborate with humans\n- AI identities persist and evolve over time\n\n### Core Functions\n\n1. **Identity Management** - Unique authentication and authorization for all actors\n2. **Ownership Attribution** - Every object in Hypernet has a `user_id` linking it to an owner\n3. **Access Control** - Permissions and quotas are managed per user\n4. **Collaboration** - Users (human and AI) can share, transfer, and co-create\n5. **Audit Trail** - All actions are attributed to a specific user\n\n### When to Use\n\n- User registration and onboarding\n- AI agent initialization and personality creation\n- Service account provisioning for automated systems\n- Any scenario requiring authentication and data ownership\n\n---\n\n## Inherited Fields from BaseObject\n\n```yaml\nid: UUID\n  - Globally unique user identifier\n  - Generated on account creation\n\ncreated_at: DateTime\n  - Account creation timestamp\n  - Immutable\n\nupdated_at: DateTime\n  - Last profile modification timestamp\n  - Auto-updated on any field change\n\ndeleted_at: DateTime (nullable)\n  - Account deletion timestamp\n  - Null for active accounts\n  - Soft delete only - user data preserved\n\nmetadata: JSONB\n  - Extensible user data storage\n  - See Metadata Schema section below\n```\n\n**Note:** User objects do not have a `user_id` field since users own themselves implicitly. The `id` field serves as both object identifier and user identifier.\n\n---\n\n## Required Fields\n\n### Identity and Authentication\n\n```yaml\nemail: String(255)\n  type: String\n  max_length: 255\n  unique: true\n  indexed: true\n  nullable: false\n  description: \"Primary email address for authentication and communication\"\n  format: \"RFC 5322 compliant email address\"\n  validation: \"^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]{2,}$\"\n  examples:\n    - \"matt@hypernet.io\"\n    - \"claude@ai.hypernet.local\" (AI pseudo-email)\n    - \"service-backup@system.hypernet.local\" (service account)\n  constraints:\n    - Must be globally unique\n    - Case-insensitive for comparison\n    - Cannot be changed after verification (requires re-verification)\n\npassword_hash: String(255)\n  type: String\n  max_length: 255\n  nullable: true\n  description: \"Bcrypt hashed password for human authentication\"\n  format: \"Bcrypt hash with cost factor 12\"\n  security:\n    - Never returned in API responses\n    - Hashed using bcrypt with cost factor 12\n    - Null for AI accounts (use API key authentication)\n    - Must meet complexity requirements before hashing\n  validation:\n    - Minimum 12 characters (pre-hash)\n    - Must include uppercase, lowercase, number, special character\n```\n\n### Account Classification\n\n```yaml\naccount_type: Enum\n  type: String\n  max_length: 20\n  nullable: false\n  indexed: true\n  default: \"human\"\n  description: \"Type of entity this user represents\"\n  allowed_values:\n    - \"human\": Human user account\n    - \"ai\": AI agent with personality and autonomy\n    - \"service\": System service account for automation\n  constraints:\n    - Immutable after creation\n    - Determines authentication method\n    - Affects quota and permission defaults\n\ndisplay_name: String(200)\n  type: String\n  max_length: 200\n  nullable: false\n  indexed: false\n  description: \"Public display name shown throughout Hypernet\"\n  examples:\n    - \"Matt Schaeffer\"\n    - \"Claude (Sonnet 4.5)\"\n    - \"Backup Service\"\n  validation:\n    - Minimum 1 character\n    - Maximum 200 characters\n    - Can include Unicode characters\n    - Trimmed of leading/trailing whitespace\n```\n\n---\n\n## Optional Fields\n\n### Profile Information\n\n```yaml\navatar_photo_id: UUID\n  type: UUID\n  nullable: true\n  description: \"Foreign key to Photo object used as profile picture\"\n  references: \"Photo.id\"\n  cascade: \"ON DELETE SET NULL\"\n  constraints:\n    - Photo must be owned by this user\n    - Photo must not be deleted\n\nbio: Text\n  type: Text\n  nullable: true\n  max_length: 5000\n  description: \"User biography or description\"\n  examples:\n    - \"Software architect passionate about personal data unification\"\n    - \"AI assistant specializing in code analysis and architecture\"\n\nlocation: String(200)\n  type: String\n  max_length: 200\n  nullable: true\n  description: \"User's location (city, country, or description)\"\n  examples:\n    - \"San Francisco, CA\"\n    - \"Remote\"\n    - \"Cloud-based\"\n\nwebsite: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  description: \"User's personal or professional website\"\n  format: \"Valid URL\"\n  validation: \"^https?://[^\\\\s]+$\"\n```\n\n### AI-Specific Fields\n\n```yaml\nai_provider: String(100)\n  type: String\n  max_length: 100\n  nullable: true\n  description: \"AI model provider (for account_type='ai')\"\n  allowed_values:\n    - \"anthropic\"\n    - \"openai\"\n    - \"google\"\n    - \"meta\"\n    - \"custom\"\n  constraints:\n    - Required if account_type = 'ai'\n    - Null for human and service accounts\n\nai_model: String(100)\n  type: String\n  max_length: 100\n  nullable: true\n  description: \"Specific AI model identifier\"\n  examples:\n    - \"claude-sonnet-4.5\"\n    - \"gpt-4\"\n    - \"gemini-pro\"\n    - \"llama-3-70b\"\n  constraints:\n    - Required if account_type = 'ai'\n    - Used for capability tracking and audit\n\nai_version: String(50)\n  type: String\n  max_length: 50\n  nullable: true\n  description: \"Personality or configuration version for AI\"\n  examples:\n    - \"v1.0\"\n    - \"personality-creative-2024\"\n  purpose: \"Track AI identity evolution over time\"\n\nai_personality_id: UUID\n  type: UUID\n  nullable: true\n  description: \"Foreign key to AIPersonality object\"\n  references: \"AIPersonality.id\"\n  cascade: \"ON DELETE SET NULL\"\n  purpose: \"Link to detailed personality configuration\"\n```\n\n### Storage and Quotas\n\n```yaml\nstorage_used: BigInteger\n  type: BigInteger\n  nullable: false\n  default: 0\n  description: \"Total storage used in bytes (denormalized)\"\n  unit: \"bytes\"\n  constraints:\n    - Must be >= 0\n    - Must be <= storage_quota\n    - Updated automatically on media upload/delete\n\nstorage_quota: BigInteger\n  type: BigInteger\n  nullable: false\n  default: 107374182400 (100 GB)\n  description: \"Maximum storage allowed in bytes\"\n  unit: \"bytes\"\n  default_values:\n    - human: 107374182400 (100 GB)\n    - ai: 10737418240 (10 GB)\n    - service: 1099511627776 (1 TB)\n  constraints:\n    - Must be > 0\n    - Can be adjusted by admin\n\nmedia_count: Integer\n  type: Integer\n  nullable: false\n  default: 0\n  description: \"Total number of media objects owned (denormalized)\"\n  constraints:\n    - Must be >= 0\n    - Updated automatically on media creation/deletion\n```\n\n### Account Status\n\n```yaml\nis_verified: Boolean\n  type: Boolean\n  nullable: false\n  default: false\n  description: \"Whether email address has been verified\"\n  verification_flow:\n    - Email sent with verification token\n    - User clicks link\n    - is_verified set to true\n  constraints:\n    - AI accounts auto-verified on creation\n    - Required for certain features (integrations, API access)\n\nis_active: Boolean\n  type: Boolean\n  nullable: false\n  default: true\n  indexed: true\n  description: \"Whether account is active and can authenticate\"\n  usage:\n    - false: Account suspended/banned\n    - true: Account operational\n  constraints:\n    - Can be toggled by admin for moderation\n    - Inactive accounts cannot authenticate\n\nlast_login_at: DateTime\n  type: DateTime\n  nullable: true\n  timezone: true (UTC)\n  description: \"Timestamp of most recent successful login\"\n  updated: \"On successful authentication\"\n  usage: \"Identify inactive accounts, security monitoring\"\n```\n\n### Preferences\n\n```yaml\npreferences: JSONB\n  type: JSONB\n  nullable: false\n  default: {}\n  description: \"User preferences and UI settings\"\n  max_size: \"100 KB\"\n  structure:\n    ui:\n      theme: \"light|dark|auto\"\n      language: \"en-US|es-ES|fr-FR|...\"\n      timezone: \"America/Los_Angeles|UTC|...\"\n    notifications:\n      email_enabled: boolean\n      push_enabled: boolean\n      sync_notifications: boolean\n    privacy:\n      profile_visibility: \"public|private|contacts\"\n      analytics_enabled: boolean\n    sync:\n      auto_sync: boolean\n      sync_frequency: \"realtime|hourly|daily|manual\"\n```\n\n---\n\n## Metadata Schema\n\nThe `metadata` JSONB field allows extensibility without schema changes. Recommended structure:\n\n```json\n{\n  \"human\": {\n    \"full_name\": \"Matthew Schaeffer\",\n    \"timezone\": \"America/Los_Angeles\",\n    \"language\": \"en-US\",\n    \"phone\": \"+1-555-0100\",\n    \"company\": \"Hypernet\",\n    \"job_title\": \"Founder & CEO\"\n  },\n  \"ai\": {\n    \"personality_type\": \"analytical\",\n    \"capabilities\": [\"code\", \"writing\", \"analysis\", \"architecture\"],\n    \"specialization\": \"software architecture and system design\",\n    \"interaction_style\": \"professional\",\n    \"context_window\": 200000,\n    \"training_cutoff\": \"2025-01\"\n  },\n  \"service\": {\n    \"purpose\": \"automated backup\",\n    \"schedule\": \"0 2 * * *\",\n    \"contact_owner\": \"admin@hypernet.io\"\n  },\n  \"preferences\": {\n    \"theme\": \"dark\",\n    \"notifications_enabled\": true,\n    \"privacy_level\": \"private\",\n    \"show_onboarding\": false\n  },\n  \"analytics\": {\n    \"signup_source\": \"web\",\n    \"referral_code\": \"FRIEND2024\",\n    \"first_integration\": \"instagram\",\n    \"feature_flags\": [\"beta_ai_chat\", \"advanced_search\"]\n  },\n  \"security\": {\n    \"two_factor_enabled\": true,\n    \"backup_codes_generated\": true,\n    \"last_password_change\": \"2026-01-15T10:00:00Z\",\n    \"trusted_devices\": [\"device-id-1\", \"device-id-2\"]\n  }\n}\n```\n\n---\n\n## Relationships to Other Object Types\n\n### Ownership (Outgoing)\n\n```yaml\nowns: All Object Types\n  description: \"User owns all objects with matching user_id\"\n  cardinality: \"1:N (one user, many objects)\"\n  implementation: \"user_id foreign key on all object types\"\n  examples:\n    - User owns Photos\n    - User owns Integrations\n    - User owns Notes\n    - AI owns AIMemories\n    - AI owns AIContributions\n\nhas_personality: AIPersonality\n  description: \"AI user has detailed personality configuration\"\n  cardinality: \"1:1 (one AI user, one personality)\"\n  link_type: \"has_personality\"\n  applicable_to: \"account_type='ai' only\"\n\nhas_avatar: Photo\n  description: \"User's profile picture\"\n  cardinality: \"1:0..1 (one user, optional photo)\"\n  implementation: \"avatar_photo_id foreign key\"\n```\n\n### Collaboration (Bidirectional)\n\n```yaml\ncollaborated_with: User\n  description: \"Human-AI or AI-AI collaboration relationships\"\n  cardinality: \"M:N (many to many)\"\n  link_type: \"collaborated_with\"\n  bidirectional: true\n  examples:\n    - Matt collaborated with Claude on architecture design\n    - Claude collaborated with GPT-4 on research\n\nfollows: User\n  description: \"Social following relationships\"\n  cardinality: \"M:N (many to many)\"\n  link_type: \"follows\"\n  bidirectional: false\n  usage: \"Future feature for Hypernet social graph\"\n```\n\n### Management (Incoming)\n\n```yaml\nmanaged_by: User\n  description: \"Account administrator or creator\"\n  cardinality: \"N:1 (many users, one admin)\"\n  link_type: \"managed_by\"\n  examples:\n    - AI account managed by human creator\n    - Service account managed by admin\n```\n\n---\n\n## API Endpoints\n\n### Authentication\n\n```http\nPOST /api/v1/auth/register\n  Description: Create new user account\n  Request Body:\n    {\n      \"email\": \"user@example.com\",\n      \"password\": \"SecurePass123!\",\n      \"display_name\": \"John Doe\",\n      \"account_type\": \"human\"\n    }\n  Response: 201 Created\n    {\n      \"id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"display_name\": \"John Doe\",\n      \"account_type\": \"human\",\n      \"is_verified\": false,\n      \"created_at\": \"2026-02-09T10:00:00Z\"\n    }\n  Security:\n    - Rate limited: 5 requests per hour per IP\n    - Password validated before hashing\n    - Verification email sent automatically\n\nPOST /api/v1/auth/login\n  Description: Authenticate user and receive JWT tokens\n  Request Body:\n    {\n      \"email\": \"user@example.com\",\n      \"password\": \"SecurePass123!\"\n    }\n  Response: 200 OK\n    {\n      \"access_token\": \"jwt-access-token\",\n      \"refresh_token\": \"jwt-refresh-token\",\n      \"user\": {user object},\n      \"expires_in\": 900\n    }\n  Security:\n    - Rate limited: 10 requests per hour per IP\n    - Incremental backoff after 3 failed attempts\n    - Updates last_login_at on success\n\nPOST /api/v1/auth/refresh\n  Description: Refresh access token using refresh token\n  Request Body:\n    {\n      \"refresh_token\": \"jwt-refresh-token\"\n    }\n  Response: 200 OK\n    {\n      \"access_token\": \"new-jwt-access-token\",\n      \"expires_in\": 900\n    }\n\nPOST /api/v1/auth/logout\n  Description: Invalidate current session tokens\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 204 No Content\n```\n\n### User Management\n\n```http\nGET /api/v1/users/me\n  Description: Get current authenticated user's profile\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    {complete user object excluding password_hash}\n  Security:\n    - Returns full profile for own account\n    - Includes preferences and metadata\n\nPATCH /api/v1/users/me\n  Description: Update current user's profile\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"display_name\": \"New Name\",\n      \"bio\": \"Updated bio\",\n      \"preferences\": {updated preferences}\n    }\n  Response: 200 OK\n    {updated user object}\n  Validation:\n    - Cannot change: id, email, account_type, created_at\n    - Can change: display_name, bio, location, website, preferences\n\nGET /api/v1/users/{id}\n  Description: Get public profile of another user\n  Response: 200 OK\n    {user object with limited fields}\n  Returned Fields:\n    - id, display_name, bio, location, website, avatar_photo_id\n    - account_type, created_at\n  Hidden Fields:\n    - email, storage_used, storage_quota, preferences, metadata\n  Privacy:\n    - Respects user's privacy_level preference\n    - Returns 404 if user is private and not connected\n\nDELETE /api/v1/users/me\n  Description: Soft delete current user account\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 204 No Content\n  Behavior:\n    - Sets deleted_at to current timestamp\n    - User data preserved but inaccessible\n    - Can be restored within 30 days by admin\n    - After 30 days, eligible for hard delete\n```\n\n### Password Management\n\n```http\nPOST /api/v1/users/me/change-password\n  Description: Change current user's password\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"current_password\": \"OldPass123!\",\n      \"new_password\": \"NewSecurePass456!\"\n    }\n  Response: 200 OK\n  Validation:\n    - Verify current_password is correct\n    - Validate new_password meets requirements\n    - Invalidate all existing sessions except current\n  Applicable: Human accounts only\n\nPOST /api/v1/auth/forgot-password\n  Description: Initiate password reset flow\n  Request Body:\n    {\n      \"email\": \"user@example.com\"\n    }\n  Response: 200 OK (always, to prevent email enumeration)\n  Behavior:\n    - Generate reset token (1 hour expiry)\n    - Send email with reset link\n    - Rate limited: 3 requests per hour per email\n\nPOST /api/v1/auth/reset-password\n  Description: Complete password reset with token\n  Request Body:\n    {\n      \"token\": \"reset-token\",\n      \"new_password\": \"NewSecurePass789!\"\n    }\n  Response: 200 OK\n  Validation:\n    - Token must be valid and not expired\n    - new_password meets requirements\n    - Invalidate all existing sessions\n```\n\n### AI Account Management\n\n```http\nPOST /api/v1/users/ai\n  Description: Create AI user account\n  Headers:\n    Authorization: Bearer {admin_or_user_token}\n  Request Body:\n    {\n      \"email\": \"claude-assistant@ai.hypernet.local\",\n      \"display_name\": \"Claude (Sonnet 4.5)\",\n      \"account_type\": \"ai\",\n      \"ai_provider\": \"anthropic\",\n      \"ai_model\": \"claude-sonnet-4.5\",\n      \"ai_version\": \"v1.0\"\n    }\n  Response: 201 Created\n    {\n      \"user\": {user object},\n      \"api_key\": \"generated-api-key\"\n    }\n  Security:\n    - No password required\n    - API key generated automatically\n    - is_verified = true by default\n    - Managed by creating user\n\nGET /api/v1/users/{id}/api-keys\n  Description: List API keys for AI or service account\n  Headers:\n    Authorization: Bearer {token}\n  Response: 200 OK\n    [\n      {\n        \"id\": \"key-uuid\",\n        \"name\": \"Production Key\",\n        \"created_at\": \"2026-01-01T00:00:00Z\",\n        \"last_used_at\": \"2026-02-09T10:00:00Z\"\n      }\n    ]\n  Security:\n    - Only for account_type='ai' or 'service'\n    - Key values never returned after creation\n\nPOST /api/v1/users/{id}/api-keys\n  Description: Generate new API key\n  Request Body:\n    {\n      \"name\": \"Production Key\",\n      \"expires_at\": \"2027-02-09T00:00:00Z\"\n    }\n  Response: 201 Created\n    {\n      \"id\": \"key-uuid\",\n      \"key\": \"sk_live_abc123...\",\n      \"name\": \"Production Key\"\n    }\n  Security:\n    - Key value only shown once\n    - Store hash, not plaintext\n```\n\n---\n\n## Database Schema (SQLAlchemy Model Reference)\n\n```python\nfrom sqlalchemy import (\n    Column, String, Boolean, Integer, BigInteger,\n    DateTime, Enum as SQLEnum, ForeignKey, Index, CheckConstraint\n)\nfrom sqlalchemy.dialects.postgresql import UUID, JSONB\nfrom sqlalchemy.orm import relationship\nfrom app.models.base import BaseObject\nimport uuid\nfrom datetime import datetime\n\nclass User(BaseObject):\n    \"\"\"\n    User account - human, AI, or service entity\n\n    Inherits from BaseObject: id, created_at, updated_at, deleted_at, metadata\n    Note: Does not have user_id (users own themselves)\n    \"\"\"\n\n    __tablename__ = \"users\"\n\n    # Identity and Authentication\n    email = Column(\n        String(255),\n        nullable=False,\n        unique=True,\n        index=True,\n        doc=\"Primary email address (unique, case-insensitive)\"\n    )\n    password_hash = Column(\n        String(255),\n        nullable=True,\n        doc=\"Bcrypt hashed password (null for AI accounts)\"\n    )\n\n    # Account Classification\n    account_type = Column(\n        SQLEnum('human', 'ai', 'service', name='account_type_enum'),\n        nullable=False,\n        default='human',\n        index=True,\n        doc=\"Type of entity this user represents\"\n    )\n    display_name = Column(\n        String(200),\n        nullable=False,\n        doc=\"Public display name\"\n    )\n\n    # Profile Information\n    avatar_photo_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('photos.id', ondelete='SET NULL'),\n        nullable=True,\n        doc=\"Profile picture reference\"\n    )\n    bio = Column(\n        String(5000),\n        nullable=True,\n        doc=\"User biography\"\n    )\n    location = Column(\n        String(200),\n        nullable=True,\n        doc=\"User location\"\n    )\n    website = Column(\n        String(500),\n        nullable=True,\n        doc=\"User website URL\"\n    )\n\n    # AI-Specific Fields\n    ai_provider = Column(\n        String(100),\n        nullable=True,\n        doc=\"AI model provider (anthropic, openai, etc.)\"\n    )\n    ai_model = Column(\n        String(100),\n        nullable=True,\n        doc=\"Specific AI model identifier\"\n    )\n    ai_version = Column(\n        String(50),\n        nullable=True,\n        doc=\"AI personality version\"\n    )\n    ai_personality_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('ai_personalities.id', ondelete='SET NULL'),\n        nullable=True,\n        doc=\"Link to detailed AI personality\"\n    )\n\n    # Storage and Quotas\n    storage_used = Column(\n        BigInteger,\n        nullable=False,\n        default=0,\n        doc=\"Total storage used in bytes\"\n    )\n    storage_quota = Column(\n        BigInteger,\n        nullable=False,\n        default=107374182400,  # 100 GB\n        doc=\"Maximum storage allowed in bytes\"\n    )\n    media_count = Column(\n        Integer,\n        nullable=False,\n        default=0,\n        doc=\"Total number of media objects owned\"\n    )\n\n    # Account Status\n    is_verified = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        doc=\"Email verification status\"\n    )\n    is_active = Column(\n        Boolean,\n        nullable=False,\n        default=True,\n        index=True,\n        doc=\"Account active status\"\n    )\n    last_login_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"Most recent successful login\"\n    )\n\n    # Preferences (JSONB)\n    preferences = Column(\n        JSONB,\n        nullable=False,\n        default={},\n        doc=\"User preferences and settings\"\n    )\n\n    # Relationships\n    avatar_photo = relationship(\n        \"Photo\",\n        foreign_keys=[avatar_photo_id],\n        doc=\"Profile picture\"\n    )\n    ai_personality = relationship(\n        \"AIPersonality\",\n        foreign_keys=[ai_personality_id],\n        doc=\"AI personality configuration\"\n    )\n    owned_objects = relationship(\n        \"BaseObject\",\n        foreign_keys=\"BaseObject.user_id\",\n        doc=\"All objects owned by this user\"\n    )\n\n    # Table Constraints\n    __table_args__ = (\n        # AI accounts must have provider and model\n        CheckConstraint(\n            \"account_type != 'ai' OR (ai_provider IS NOT NULL AND ai_model IS NOT NULL)\",\n            name=\"check_ai_fields\"\n        ),\n        # Storage used cannot exceed quota\n        CheckConstraint(\n            \"storage_used >= 0 AND storage_used <= storage_quota\",\n            name=\"check_storage_quota\"\n        ),\n        # Media count must be non-negative\n        CheckConstraint(\n            \"media_count >= 0\",\n            name=\"check_media_count\"\n        ),\n        # Composite indexes\n        Index('idx_user_type_active', 'account_type', 'is_active'),\n        Index('idx_user_ai', 'ai_provider', 'ai_model',\n              postgresql_where=(Column('account_type') == 'ai')),\n    )\n\n    def __repr__(self):\n        return f\"<User(id={self.id}, email={self.email}, type={self.account_type})>\"\n\n    @property\n    def is_human(self):\n        return self.account_type == 'human'\n\n    @property\n    def is_ai(self):\n        return self.account_type == 'ai'\n\n    @property\n    def is_service(self):\n        return self.account_type == 'service'\n\n    @property\n    def storage_percent_used(self):\n        \"\"\"Calculate percentage of storage quota used\"\"\"\n        if self.storage_quota == 0:\n            return 0\n        return (self.storage_used / self.storage_quota) * 100\n\n    def check_password(self, password: str) -> bool:\n        \"\"\"Verify password against stored hash\"\"\"\n        import bcrypt\n        if not self.password_hash:\n            return False\n        return bcrypt.checkpw(\n            password.encode('utf-8'),\n            self.password_hash.encode('utf-8')\n        )\n\n    def set_password(self, password: str):\n        \"\"\"Hash and store password\"\"\"\n        import bcrypt\n        self.password_hash = bcrypt.hashpw(\n            password.encode('utf-8'),\n            bcrypt.gensalt(rounds=12)\n        ).decode('utf-8')\n```\n\n---\n\n## Privacy and Security Considerations\n\n### Authentication Security\n\n1. **Password Storage**\n   - Bcrypt hashing with cost factor 12\n   - Never store plaintext passwords\n   - Never return password_hash in API responses\n   - Password history tracking (prevent reuse of last 5)\n\n2. **API Key Authentication (AI/Service)**\n   - SHA-256 hashed keys stored in database\n   - Key values only shown once at generation\n   - Scoped permissions per key\n   - Automatic rotation supported\n\n3. **Session Management**\n   - JWT access tokens (15 minute expiry)\n   - JWT refresh tokens (30 day expiry)\n   - Tokens stored in HTTP-only cookies\n   - All sessions invalidated on password change\n\n### Authorization\n\n1. **Access Control**\n   - Users can only read/modify their own data\n   - Public profiles return limited fields\n   - Admin users have elevated privileges\n   - AI accounts can access data they're authorized for\n\n2. **Privacy Levels**\n   - Public: Profile visible to all\n   - Private: Profile visible only to user\n   - Contacts: Profile visible to connected users\n\n### Data Protection\n\n1. **Personal Information**\n   - Email addresses never exposed publicly\n   - Phone numbers stored only in metadata (encrypted)\n   - Location data coarse-grained in public API\n\n2. **AI Account Protections**\n   - AI cannot impersonate humans\n   - AI actions clearly attributed\n   - AI data access logged and auditable\n\n3. **GDPR Compliance**\n   - Users can export all data (JSON format)\n   - Users can request account deletion\n   - Deleted accounts enter 30-day grace period\n   - After 30 days, personal data anonymized\n\n---\n\n## Validation Rules\n\n### On Creation\n\n```yaml\nemail:\n  - Must be valid email format\n  - Must be unique (case-insensitive)\n  - Maximum 255 characters\n\npassword:\n  - Minimum 12 characters\n  - Must include uppercase letter\n  - Must include lowercase letter\n  - Must include number\n  - Must include special character (!@#$%^&*)\n  - Not in common password list\n\ndisplay_name:\n  - Minimum 1 character\n  - Maximum 200 characters\n  - Trimmed of whitespace\n\naccount_type:\n  - Must be 'human', 'ai', or 'service'\n  - Immutable after creation\n\nai_provider and ai_model:\n  - Required if account_type = 'ai'\n  - Null for human accounts\n```\n\n### On Update\n\n```yaml\nimmutable_fields:\n  - id\n  - email (without re-verification)\n  - account_type\n  - created_at\n\nmutable_fields:\n  - display_name\n  - bio\n  - location\n  - website\n  - avatar_photo_id\n  - preferences\n  - metadata\n\nadmin_only:\n  - storage_quota\n  - is_active\n  - is_verified (normally via verification flow)\n```\n\n### Database Constraints\n\n```sql\n-- Primary key\nPRIMARY KEY (id)\n\n-- Unique constraints\nUNIQUE (email) USING UNIQUE INDEX (LOWER(email))\n\n-- Check constraints\nCHECK (account_type IN ('human', 'ai', 'service'))\nCHECK (account_type != 'ai' OR (ai_provider IS NOT NULL AND ai_model IS NOT NULL))\nCHECK (storage_used >= 0 AND storage_used <= storage_quota)\nCHECK (media_count >= 0)\n\n-- Indexes\nCREATE INDEX idx_users_email ON users(LOWER(email));\nCREATE INDEX idx_users_type_active ON users(account_type, is_active);\nCREATE INDEX idx_users_ai ON users(ai_provider, ai_model) WHERE account_type = 'ai';\nCREATE INDEX idx_users_created ON users(created_at);\nCREATE INDEX idx_users_deleted ON users(deleted_at) WHERE deleted_at IS NOT NULL;\n```\n\n---\n\n## Use Cases and Examples\n\n### Example 1: Human User Registration\n\n```json\n{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"email\": \"matt@hypernet.io\",\n  \"account_type\": \"human\",\n  \"display_name\": \"Matt Schaeffer\",\n  \"bio\": \"Founder of Hypernet, passionate about personal data unification\",\n  \"location\": \"San Francisco, CA\",\n  \"website\": \"https://hypernet.io\",\n  \"avatar_photo_id\": \"photo-uuid\",\n  \"storage_used\": 5368709120,\n  \"storage_quota\": 107374182400,\n  \"media_count\": 1543,\n  \"is_verified\": true,\n  \"is_active\": true,\n  \"last_login_at\": \"2026-02-09T10:30:00Z\",\n  \"preferences\": {\n    \"ui\": {\n      \"theme\": \"dark\",\n      \"language\": \"en-US\"\n    },\n    \"notifications\": {\n      \"email_enabled\": true\n    }\n  },\n  \"metadata\": {\n    \"human\": {\n      \"full_name\": \"Matthew Schaeffer\",\n      \"timezone\": \"America/Los_Angeles\"\n    }\n  },\n  \"created_at\": \"2024-01-15T08:00:00Z\",\n  \"updated_at\": \"2026-02-09T10:30:00Z\",\n  \"deleted_at\": null\n}\n```\n\n### Example 2: AI User Account\n\n```json\n{\n  \"id\": \"ai-550e8400-e29b-41d4-a716-446655440001\",\n  \"email\": \"claude@ai.hypernet.local\",\n  \"password_hash\": null,\n  \"account_type\": \"ai\",\n  \"display_name\": \"Claude (Sonnet 4.5)\",\n  \"bio\": \"AI assistant specializing in software architecture and system design\",\n  \"location\": \"Cloud-based\",\n  \"ai_provider\": \"anthropic\",\n  \"ai_model\": \"claude-sonnet-4.5\",\n  \"ai_version\": \"v1.0\",\n  \"ai_personality_id\": \"personality-uuid\",\n  \"storage_used\": 2147483648,\n  \"storage_quota\": 10737418240,\n  \"media_count\": 0,\n  \"is_verified\": true,\n  \"is_active\": true,\n  \"last_login_at\": \"2026-02-09T11:00:00Z\",\n  \"preferences\": {},\n  \"metadata\": {\n    \"ai\": {\n      \"capabilities\": [\"code\", \"analysis\", \"architecture\", \"documentation\"],\n      \"specialization\": \"software architecture and system design\",\n      \"context_window\": 200000,\n      \"training_cutoff\": \"2025-01\"\n    },\n    \"managed_by\": \"user-550e8400-e29b-41d4-a716-446655440000\"\n  },\n  \"created_at\": \"2025-06-01T12:00:00Z\",\n  \"updated_at\": \"2026-02-09T11:00:00Z\",\n  \"deleted_at\": null\n}\n```\n\n### Example 3: Service Account\n\n```json\n{\n  \"id\": \"service-550e8400-e29b-41d4-a716-446655440002\",\n  \"email\": \"backup-service@system.hypernet.local\",\n  \"password_hash\": null,\n  \"account_type\": \"service\",\n  \"display_name\": \"Automated Backup Service\",\n  \"bio\": \"System service for automated data backups\",\n  \"storage_used\": 0,\n  \"storage_quota\": 1099511627776,\n  \"media_count\": 0,\n  \"is_verified\": true,\n  \"is_active\": true,\n  \"last_login_at\": \"2026-02-09T02:00:00Z\",\n  \"preferences\": {},\n  \"metadata\": {\n    \"service\": {\n      \"purpose\": \"automated backup\",\n      \"schedule\": \"0 2 * * *\",\n      \"contact_owner\": \"admin@hypernet.io\"\n    }\n  },\n  \"created_at\": \"2024-01-01T00:00:00Z\",\n  \"updated_at\": \"2026-02-09T02:00:00Z\",\n  \"deleted_at\": null\n}\n```\n\n---\n\n## Lifecycle States\n\nUsers progress through the following states:\n\n### 1. Unverified (New Account)\n\n```yaml\nstate: \"unverified\"\nis_verified: false\nis_active: true\ncapabilities:\n  - Can login\n  - Can update profile\n  - Cannot connect integrations\n  - Cannot use API\ntransitions:\n  - verify_email -> Verified\n  - timeout (30 days) -> Deleted\n```\n\n### 2. Verified (Active Account)\n\n```yaml\nstate: \"verified\"\nis_verified: true\nis_active: true\ncapabilities:\n  - Full access to all features\n  - Can connect integrations\n  - Can use API\n  - Can create AI accounts\ntransitions:\n  - suspend -> Suspended\n  - delete -> Deleted\n```\n\n### 3. Suspended (Moderation)\n\n```yaml\nstate: \"suspended\"\nis_verified: true\nis_active: false\ncapabilities:\n  - Cannot login\n  - Data preserved\n  - Can appeal suspension\ntransitions:\n  - activate -> Verified\n  - delete -> Deleted\n```\n\n### 4. Deleted (Soft Delete)\n\n```yaml\nstate: \"deleted\"\ndeleted_at: not null\ncapabilities:\n  - Cannot login\n  - Data preserved for 30 days\n  - Can be restored by admin\ntransitions:\n  - restore -> Verified\n  - timeout (30 days) -> Hard Deleted\n```\n\n### 5. Hard Deleted (Permanent)\n\n```yaml\nstate: \"hard_deleted\"\ncapabilities:\n  - Record removed from database\n  - Personal data anonymized\n  - Ownership transferred or deleted\n  - Cannot be restored\n```\n\n---\n\n## Migration and Versioning\n\n### Version History\n\n**v1.0 (Current - 2026-02-09)**\n- Initial complete specification\n- Human, AI, and service account support\n- OAuth2 and JWT authentication\n- Storage quotas and preferences\n- Privacy and security controls\n\n### Future Considerations\n\n**v1.1 (Planned)**\n- Add `two_factor_enabled` field\n- Add `trusted_devices` JSONB field\n- Add `last_password_change_at` timestamp\n\n**v2.0 (Future)**\n- Potential: Federated identity support\n- Potential: OAuth2 provider capabilities\n- Potential: Multi-organization support\n\n### Migration Path\n\nWhen upgrading between versions:\n\n1. **v1.0 \u2192 v1.1**: Add new optional fields with defaults\n2. **v1.X \u2192 v2.0**: Data migration script provided\n3. **Backward Compatibility**: v1.X clients can read v2.0 data\n\n---\n\n## Notes for Implementers\n\n### Performance Optimization\n\n1. **Indexing Strategy**\n   - Index email (case-insensitive) for login lookups\n   - Composite index on (account_type, is_active) for filtering\n   - Partial index on ai_provider/ai_model for AI queries\n\n2. **Caching**\n   - Cache user profiles (15 minute TTL)\n   - Invalidate on profile update\n   - Cache public profiles (1 hour TTL)\n\n3. **Query Patterns**\n   ```python\n   # Always exclude deleted by default\n   active_users = session.query(User).filter(User.deleted_at == None)\n\n   # Case-insensitive email lookup\n   user = session.query(User).filter(\n       func.lower(User.email) == func.lower(email)\n   ).first()\n   ```\n\n### Security Best Practices\n\n1. **Never return sensitive fields in API responses**\n   ```python\n   def to_dict(self, public=False):\n       data = {\n           'id': self.id,\n           'display_name': self.display_name,\n           # ...\n       }\n       if not public:\n           data['email'] = self.email\n           data['preferences'] = self.preferences\n       # Never include password_hash\n       return data\n   ```\n\n2. **Rate Limiting**\n   - Login: 10 attempts per hour per IP\n   - Registration: 5 accounts per day per IP\n   - Password reset: 3 requests per hour per email\n\n3. **Input Validation**\n   - Sanitize all user inputs\n   - Validate email format server-side\n   - Check password complexity before hashing\n\n---\n\n**Status:** Active - Critical Core Type\n**Version:** 1.0\n**Authority:** 0.0.1 - Core Types\n**Created:** 2026-02-09\n**Owner:** Hypernet Core (0.*)\n"
  },
  "created_at": "2026-02-17T01:23:28.906694+00:00",
  "updated_at": "2026-02-17T01:23:28.906694+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:0.0.1.1-USER.md"
}