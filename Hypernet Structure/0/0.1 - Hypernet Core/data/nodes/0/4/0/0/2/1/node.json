{
  "address": "0.4.0.0.2.1",
  "type_address": null,
  "data": {
    "name": "0.0.2.1-MEDIA.md",
    "type": "file",
    "extension": ".md",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.4 - Object Type Registry\\0.0.2 - Media Types\\0.0.2.1-MEDIA.md",
    "size": 35883,
    "content": "# MEDIA - Photos, Videos, Audio, and Documents Object Type\n\n**Type ID:** `hypernet.media.media`\n**Version:** 1.0\n**Category:** 0.0.2 - Media Types\n**Parent:** BaseObject\n**Status:** Active - Core Media Type\n**Created:** 2026-02-09\n**Last Updated:** 2026-02-09\n\n---\n\n## Object Type Metadata\n\n```yaml\ntype_name: \"Media\"\ntype_id: \"hypernet.media.media\"\nversion: \"1.0\"\nparent_type: \"BaseObject\"\ncategory: \"0.0.2 - Media Types\"\nabstract: false\ninstantiable: true\n```\n\n---\n\n## Purpose and Description\n\n### What is Media?\n\nThe Media object type represents any digital file imported into or created within Hypernet. This includes photos, videos, audio recordings, documents, and other file types. Media is the foundational content object in Hypernet's unified data model, enabling users to aggregate, organize, and manage their digital content from any source.\n\n### Revolutionary Design Philosophy\n\nHypernet treats all media as first-class objects with rich metadata, relationships, and lifecycle management:\n- **Source Agnostic** - Media from Instagram, Google Photos, local files, or AI-generated content all use the same object type\n- **Metadata Rich** - Automatic extraction and preservation of EXIF, file properties, and platform-specific metadata\n- **Relationship Aware** - Media can belong to albums, appear in posts, be tagged with people and locations\n- **AI Enhanced** - Automatic tagging, face detection, object recognition, and content analysis\n- **Privacy First** - Fine-grained privacy controls and encryption for sensitive content\n\n### Core Functions\n\n1. **Content Storage** - Store original files with optional compression and format conversion\n2. **Metadata Management** - Extract, preserve, and enrich metadata from all sources\n3. **Organization** - Group media into albums, tag with subjects, organize by time and location\n4. **Search and Discovery** - Full-text search, visual similarity, smart filters\n5. **Sharing and Collaboration** - Control who can view, download, or edit media\n6. **Lifecycle Management** - Track creation, modification, deletion, and archival\n\n### When to Use\n\n- Importing photos from social media platforms (Instagram, Facebook, etc.)\n- Uploading files from local devices or cloud storage\n- Storing AI-generated content (images, audio, documents)\n- Managing documents, receipts, screenshots, and other file types\n- Creating collections and galleries\n- Any scenario requiring file storage with rich metadata\n\n---\n\n## Inherited Fields from BaseObject\n\n```yaml\nid: UUID\n  - Globally unique media identifier\n  - Generated on creation or import\n\ncreated_at: DateTime\n  - Import timestamp (when added to Hypernet)\n  - Immutable\n  - May differ from taken_at (original creation time)\n\nupdated_at: DateTime\n  - Last modification timestamp\n  - Auto-updated on any field change or metadata update\n\ndeleted_at: DateTime (nullable)\n  - Soft delete timestamp\n  - Null for active media\n  - Media preserved in trash for 30 days before hard delete\n\nuser_id: UUID\n  - Foreign key to User who owns this media\n  - Required - all media must have an owner\n  - Immutable (use ownership transfer API for changes)\n\nmetadata: JSONB\n  - Extensible metadata storage\n  - See Metadata Schema section below\n  - Stores platform-specific data, EXIF, AI analysis\n```\n\n---\n\n## Required Fields\n\n### File Information\n\n```yaml\nfile_path: String(1000)\n  type: String\n  max_length: 1000\n  nullable: false\n  indexed: true\n  description: \"Relative path to file in object storage (S3, local, etc.)\"\n  format: \"users/{user_id}/media/{year}/{month}/{id}.{ext}\"\n  examples:\n    - \"users/uuid/media/2024/02/photo-uuid.jpg\"\n    - \"users/uuid/media/2024/02/video-uuid.mp4\"\n    - \"users/uuid/media/2024/02/doc-uuid.pdf\"\n  constraints:\n    - Path must be unique per user\n    - File must exist in object storage\n    - Supports hierarchical organization\n\nfile_size: BigInteger\n  type: BigInteger\n  nullable: false\n  indexed: true\n  description: \"File size in bytes\"\n  unit: \"bytes\"\n  constraints:\n    - Must be > 0\n    - Must not exceed user's storage quota\n    - Counted toward user's storage_used\n  validation:\n    - Verified on upload\n    - Re-validated on storage reconciliation\n\nmime_type: String(100)\n  type: String\n  max_length: 100\n  nullable: false\n  indexed: true\n  description: \"MIME type of the file\"\n  examples:\n    - \"image/jpeg\"\n    - \"image/png\"\n    - \"video/mp4\"\n    - \"audio/mpeg\"\n    - \"application/pdf\"\n    - \"image/heic\"\n  constraints:\n    - Must be valid MIME type\n    - Determines media_type classification\n    - Used for rendering and processing\n```\n\n### Media Classification\n\n```yaml\nmedia_type: Enum\n  type: String\n  max_length: 20\n  nullable: false\n  indexed: true\n  description: \"High-level classification of media\"\n  allowed_values:\n    - \"photo\": Still images (JPEG, PNG, GIF, HEIC, etc.)\n    - \"video\": Video files (MP4, MOV, AVI, etc.)\n    - \"audio\": Audio files (MP3, WAV, AAC, etc.)\n    - \"document\": Documents and text (PDF, DOCX, TXT, etc.)\n    - \"other\": Unrecognized or misc file types\n  derivation: \"Automatically determined from mime_type\"\n  examples:\n    - image/* -> \"photo\"\n    - video/* -> \"video\"\n    - audio/* -> \"audio\"\n    - application/pdf, text/* -> \"document\"\n\nfile_name: String(500)\n  type: String\n  max_length: 500\n  nullable: false\n  indexed: false\n  description: \"Original filename from source\"\n  examples:\n    - \"IMG_1234.jpg\"\n    - \"vacation_video.mp4\"\n    - \"meeting_notes.pdf\"\n    - \"441234567890_abc.jpg\" (Instagram export format)\n  constraints:\n    - Preserved from original source\n    - May include extension\n    - Not required to be unique\n    - Used for display and download\n```\n\n---\n\n## Optional Fields\n\n### Temporal Information\n\n```yaml\ntaken_at: DateTime\n  type: DateTime\n  nullable: true\n  indexed: true\n  timezone: true\n  description: \"When the media was originally created/captured\"\n  sources:\n    - EXIF DateTimeOriginal for photos\n    - Video file creation time\n    - Document creation date\n    - Platform timestamp from API\n  fallback: \"created_at if not available\"\n  usage: \"Primary field for timeline organization\"\n\ncaptured_at: DateTime\n  type: DateTime\n  nullable: true\n  indexed: true\n  timezone: true\n  description: \"Specific capture timestamp (may differ from taken_at)\"\n  purpose: \"Some platforms distinguish creation from capture time\"\n\nmodified_at: DateTime\n  type: DateTime\n  nullable: true\n  timezone: true\n  description: \"Last modification time from original source\"\n  examples:\n    - EXIF DateTime (if different from DateTimeOriginal)\n    - File system modified time\n```\n\n### Geolocation\n\n```yaml\nlatitude: Decimal(10,8)\n  type: Decimal\n  precision: 10\n  scale: 8\n  nullable: true\n  indexed: true\n  description: \"GPS latitude coordinate\"\n  range: \"-90.0 to 90.0\"\n  sources:\n    - EXIF GPS coordinates\n    - Video metadata\n    - Platform location data\n  privacy: \"Stripped from public exports if user preference set\"\n\nlongitude: Decimal(11,8)\n  type: Decimal\n  precision: 11\n  scale: 8\n  nullable: true\n  indexed: true\n  description: \"GPS longitude coordinate\"\n  range: \"-180.0 to 180.0\"\n  sources: \"Same as latitude\"\n\naltitude: Decimal(8,2)\n  type: Decimal\n  precision: 8\n  scale: 2\n  nullable: true\n  description: \"GPS altitude in meters\"\n  unit: \"meters\"\n  sources: \"EXIF GPS altitude\"\n\nlocation_name: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  indexed: true\n  description: \"Human-readable location name\"\n  examples:\n    - \"Golden Gate Bridge, San Francisco, CA\"\n    - \"Home\"\n    - \"Tokyo, Japan\"\n  sources:\n    - Reverse geocoded from lat/lng\n    - Platform location tag\n    - User-provided\n  searchable: true\n```\n\n### Dimensions (Photo/Video)\n\n```yaml\nwidth: Integer\n  type: Integer\n  nullable: true\n  description: \"Media width in pixels\"\n  constraints:\n    - Must be > 0 if provided\n    - Applicable to photos and videos\n  usage: \"Display and thumbnail generation\"\n\nheight: Integer\n  type: Integer\n  nullable: true\n  description: \"Media height in pixels\"\n  constraints:\n    - Must be > 0 if provided\n    - Applicable to photos and videos\n  usage: \"Display and thumbnail generation\"\n\nduration: Integer\n  type: Integer\n  nullable: true\n  description: \"Duration in seconds (video/audio)\"\n  unit: \"seconds\"\n  constraints:\n    - Must be > 0 if provided\n    - Only applicable to video and audio\n  examples:\n    - Video: 120 (2 minutes)\n    - Audio: 180 (3 minutes)\n```\n\n### Content Description\n\n```yaml\ntitle: String(500)\n  type: String\n  max_length: 500\n  nullable: true\n  indexed: true\n  description: \"User-provided or platform title\"\n  examples:\n    - \"Sunset at the beach\"\n    - \"Birthday party 2024\"\n    - \"Q4 Financial Report\"\n  searchable: true\n  sources:\n    - User input\n    - Platform caption\n    - Document title metadata\n\ncaption: Text\n  type: Text\n  nullable: true\n  max_length: 10000\n  description: \"Detailed description or caption\"\n  searchable: true\n  sources:\n    - Instagram/Facebook caption\n    - User-added description\n    - AI-generated description\n  format: \"Plain text or Markdown\"\n\nalt_text: String(1000)\n  type: String\n  max_length: 1000\n  nullable: true\n  description: \"Accessibility description\"\n  purpose: \"Screen reader support, SEO\"\n  sources:\n    - Platform alt text\n    - AI-generated description\n    - User-provided\n\ntags: JSONB\n  type: JSONB\n  nullable: false\n  default: []\n  description: \"Array of tag strings for categorization\"\n  structure: [\"tag1\", \"tag2\", \"tag3\"]\n  examples:\n    - [\"family\", \"vacation\", \"beach\"]\n    - [\"work\", \"presentation\", \"2024\"]\n  searchable: true\n  indexed: \"GIN index for containment queries\"\n```\n\n### Processing Status\n\n```yaml\nprocessing_status: Enum\n  type: String\n  max_length: 20\n  nullable: false\n  default: \"pending\"\n  indexed: true\n  description: \"Processing pipeline status\"\n  allowed_values:\n    - \"pending\": Uploaded but not processed\n    - \"processing\": Currently being processed\n    - \"completed\": Successfully processed\n    - \"failed\": Processing failed\n    - \"skipped\": Processing not needed\n  workflow:\n    pending -> processing -> completed\n    pending -> processing -> failed\n    pending -> skipped\n\nthumbnail_path: String(1000)\n  type: String\n  max_length: 1000\n  nullable: true\n  description: \"Path to generated thumbnail image\"\n  format: \"users/{user_id}/media/{year}/{month}/thumbnails/{id}_thumb.jpg\"\n  generation:\n    - Auto-generated for photos\n    - First frame for videos\n    - Icon for documents\n  sizes: \"Multiple sizes: 150x150, 300x300, 600x600\"\n\nhash_sha256: String(64)\n  type: String\n  max_length: 64\n  nullable: true\n  indexed: true\n  description: \"SHA-256 hash of file content\"\n  format: \"64 character hex string\"\n  purpose: \"Deduplication, integrity verification\"\n  computed: \"On upload or async processing\"\n\nhash_perceptual: String(64)\n  type: String\n  max_length: 64\n  nullable: true\n  indexed: true\n  description: \"Perceptual hash (pHash) for visual similarity\"\n  applicable: \"Photos and videos only\"\n  purpose: \"Find visually similar images, detect duplicates\"\n  computed: \"Via AI processing pipeline\"\n```\n\n### Source Information\n\n```yaml\nsource_platform: String(100)\n  type: String\n  max_length: 100\n  nullable: true\n  indexed: true\n  description: \"Platform/service where media originated\"\n  examples:\n    - \"instagram\"\n    - \"facebook\"\n    - \"google_photos\"\n    - \"dropbox\"\n    - \"local_upload\"\n    - \"ai_generated\"\n  usage: \"Track data provenance, display source badges\"\n\nsource_id: String(200)\n  type: String\n  max_length: 200\n  nullable: true\n  indexed: true\n  description: \"External ID from source platform\"\n  examples:\n    - Instagram media ID: \"2847593720193\"\n    - Google Photos ID: \"AF1QipN...\"\n  purpose: \"Prevent duplicate imports, sync updates\"\n\nsource_url: String(1000)\n  type: String\n  max_length: 1000\n  nullable: true\n  description: \"Original URL from platform (if applicable)\"\n  examples:\n    - \"https://www.instagram.com/p/ABC123/\"\n    - \"https://photos.google.com/photo/xyz\"\n  usage: \"Link back to original, attribution\"\n\nintegration_id: UUID\n  type: UUID\n  nullable: true\n  indexed: true\n  description: \"Foreign key to Integration that imported this media\"\n  references: \"Integration.id\"\n  cascade: \"ON DELETE SET NULL\"\n  purpose: \"Track which integration imported the media\"\n```\n\n---\n\n## Metadata Schema\n\nThe `metadata` JSONB field stores extensible platform-specific and analysis data:\n\n```json\n{\n  \"exif\": {\n    \"make\": \"Apple\",\n    \"model\": \"iPhone 15 Pro\",\n    \"lens\": \"iPhone 15 Pro back triple camera 6.86mm f/1.78\",\n    \"iso\": 200,\n    \"aperture\": \"f/1.78\",\n    \"shutter_speed\": \"1/120\",\n    \"focal_length\": \"6.86mm\",\n    \"white_balance\": \"Auto\",\n    \"flash\": \"No flash\",\n    \"orientation\": 1\n  },\n  \"platform\": {\n    \"instagram\": {\n      \"post_id\": \"ABC123\",\n      \"permalink\": \"https://instagram.com/p/ABC123\",\n      \"like_count\": 324,\n      \"comment_count\": 18,\n      \"filter\": \"Clarendon\",\n      \"is_video\": false\n    },\n    \"google_photos\": {\n      \"album_id\": \"xyz789\",\n      \"shared\": false,\n      \"archived\": false\n    }\n  },\n  \"ai_analysis\": {\n    \"labels\": [\n      {\"label\": \"sunset\", \"confidence\": 0.98},\n      {\"label\": \"beach\", \"confidence\": 0.95},\n      {\"label\": \"ocean\", \"confidence\": 0.93}\n    ],\n    \"faces\": [\n      {\n        \"face_id\": \"face-uuid\",\n        \"person_id\": \"person-uuid\",\n        \"confidence\": 0.97,\n        \"bounding_box\": {\"x\": 120, \"y\": 340, \"width\": 180, \"height\": 220}\n      }\n    ],\n    \"text\": \"Extracted text from image via OCR\",\n    \"dominant_colors\": [\"#FF6B4A\", \"#4A90E2\", \"#F5A623\"],\n    \"quality_score\": 0.89,\n    \"inappropriate_content\": false,\n    \"content_categories\": [\"nature\", \"landscape\"]\n  },\n  \"processing\": {\n    \"thumbnail_generated\": true,\n    \"hash_computed\": true,\n    \"ai_analyzed\": true,\n    \"transcoded\": false,\n    \"processing_time_ms\": 1234\n  },\n  \"file_info\": {\n    \"original_name\": \"IMG_1234.jpg\",\n    \"extension\": \"jpg\",\n    \"encoding\": \"UTF-8\",\n    \"compression\": \"JPEG\"\n  }\n}\n```\n\n---\n\n## Relationships to Other Object Types\n\n### Ownership\n\n```yaml\nowned_by: User\n  description: \"User who owns this media\"\n  cardinality: \"N:1 (many media, one owner)\"\n  implementation: \"user_id foreign key\"\n  cascade: \"ON DELETE CASCADE (delete media if user deleted)\"\n\nimported_by: Integration\n  description: \"Integration that imported this media\"\n  cardinality: \"N:1 (many media, one integration)\"\n  implementation: \"integration_id foreign key\"\n  cascade: \"ON DELETE SET NULL\"\n```\n\n### Organization\n\n```yaml\nin_albums: Album\n  description: \"Albums containing this media\"\n  cardinality: \"M:N (many media, many albums)\"\n  link_type: \"album_media\"\n  implementation: \"Join table with ordering\"\n  examples:\n    - Photo appears in \"Vacation 2024\" and \"Best Photos\" albums\n\nappears_in: SocialPost\n  description: \"Social posts featuring this media\"\n  cardinality: \"M:N (many media, many posts)\"\n  link_type: \"post_media\"\n  implementation: \"Join table with ordering\"\n  examples:\n    - Photo used in Instagram post and Facebook post\n```\n\n### People and Places\n\n```yaml\ndepicts: Person\n  description: \"People appearing in this media\"\n  cardinality: \"M:N (many media, many people)\"\n  link_type: \"media_person\"\n  implementation: \"Join table with face metadata\"\n  sources:\n    - Face recognition\n    - Manual tagging\n\ntaken_at_location: Location\n  description: \"Named location where media was captured\"\n  cardinality: \"N:1 (many media, one location)\"\n  link_type: \"taken_at\"\n  implementation: \"Location object with reverse geocoding\"\n```\n\n### Derivatives\n\n```yaml\nhas_thumbnails: Media\n  description: \"Thumbnail versions of this media\"\n  cardinality: \"1:N (one original, many thumbnails)\"\n  link_type: \"thumbnail_of\"\n  implementation: \"parent_media_id foreign key\"\n\ntranscoded_versions: Media\n  description: \"Format-converted versions (e.g., HEIC to JPEG)\"\n  cardinality: \"1:N (one original, many versions)\"\n  link_type: \"version_of\"\n```\n\n---\n\n## API Endpoints\n\n### Media Upload\n\n```http\nPOST /api/v1/media\n  Description: Upload new media file\n  Headers:\n    Authorization: Bearer {access_token}\n    Content-Type: multipart/form-data\n  Request Body:\n    file: [binary file data]\n    title: \"Optional title\"\n    caption: \"Optional caption\"\n    tags: [\"tag1\", \"tag2\"]\n    taken_at: \"2024-02-09T14:30:00Z\"\n  Response: 201 Created\n    {\n      \"id\": \"media-uuid\",\n      \"file_name\": \"IMG_1234.jpg\",\n      \"file_size\": 2456789,\n      \"mime_type\": \"image/jpeg\",\n      \"media_type\": \"photo\",\n      \"processing_status\": \"pending\",\n      \"created_at\": \"2026-02-09T15:00:00Z\"\n    }\n  Processing:\n    - File stored in object storage\n    - Hash computed\n    - Thumbnail generation queued\n    - AI analysis queued\n    - Returns immediately with pending status\n  Limits:\n    - Max file size: 5 GB per file\n    - Rate limit: 100 uploads per hour per user\n```\n\n### Media Retrieval\n\n```http\nGET /api/v1/media/{id}\n  Description: Get media metadata\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    {complete media object}\n  Privacy:\n    - Only owner can access\n    - Returns 404 if not found or unauthorized\n\nGET /api/v1/media/{id}/file\n  Description: Download original media file\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    Content-Type: {mime_type}\n    Content-Disposition: attachment; filename=\"{file_name}\"\n    [binary file data]\n  Options:\n    ?size=thumbnail - Return thumbnail instead of original\n    ?format=jpg - Convert format on-the-fly (if supported)\n\nGET /api/v1/media/{id}/thumbnail\n  Description: Get thumbnail image\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    size: 150|300|600 (default: 300)\n  Response: 200 OK\n    Content-Type: image/jpeg\n    [thumbnail image data]\n  Caching:\n    - Cache-Control: public, max-age=86400\n    - ETag support for efficient caching\n```\n\n### Media Management\n\n```http\nPATCH /api/v1/media/{id}\n  Description: Update media metadata\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"title\": \"Updated title\",\n      \"caption\": \"Updated caption\",\n      \"tags\": [\"new\", \"tags\"],\n      \"latitude\": 37.7749,\n      \"longitude\": -122.4194,\n      \"location_name\": \"San Francisco, CA\"\n    }\n  Response: 200 OK\n    {updated media object}\n  Constraints:\n    - Cannot modify: file_path, file_size, hash fields\n    - Can modify: title, caption, tags, location, dates\n\nDELETE /api/v1/media/{id}\n  Description: Soft delete media\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 204 No Content\n  Behavior:\n    - Sets deleted_at timestamp\n    - File preserved for 30 days\n    - User storage_used updated\n    - Media removed from albums and posts\n```\n\n### Bulk Operations\n\n```http\nGET /api/v1/media\n  Description: List user's media with filtering\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    media_type: photo|video|audio|document\n    album_id: {album-uuid} - Media in specific album\n    tag: {tag-name} - Media with specific tag\n    location: {location-name} - Media at location\n    date_from: 2024-01-01\n    date_to: 2024-12-31\n    limit: 50 (default: 50, max: 200)\n    offset: 0\n    sort: taken_at|created_at|file_size (default: taken_at)\n    order: asc|desc (default: desc)\n  Response: 200 OK\n    {\n      \"media\": [{media objects}],\n      \"total\": 1543,\n      \"limit\": 50,\n      \"offset\": 0\n    }\n\nPOST /api/v1/media/bulk-update\n  Description: Update multiple media at once\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"media_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"],\n      \"updates\": {\n        \"tags\": [\"vacation\", \"2024\"],\n        \"location_name\": \"Hawaii\"\n      }\n    }\n  Response: 200 OK\n    {\n      \"updated_count\": 3,\n      \"media\": [{updated media objects}]\n    }\n\nDELETE /api/v1/media/bulk-delete\n  Description: Delete multiple media at once\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"media_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n    }\n  Response: 200 OK\n    {\n      \"deleted_count\": 3\n    }\n```\n\n---\n\n## Database Schema (SQLAlchemy Model Reference)\n\n```python\nfrom sqlalchemy import (\n    Column, String, BigInteger, Integer, Enum as SQLEnum,\n    DateTime, Numeric, ForeignKey, Index, CheckConstraint, Text\n)\nfrom sqlalchemy.dialects.postgresql import UUID, JSONB, ARRAY\nfrom sqlalchemy.orm import relationship\nfrom app.models.base import BaseObject\n\nclass Media(BaseObject):\n    \"\"\"\n    Media object - photos, videos, audio, documents\n\n    Inherits from BaseObject: id, user_id, created_at, updated_at, deleted_at, metadata\n    \"\"\"\n\n    __tablename__ = \"media\"\n\n    # File Information (Required)\n    file_path = Column(\n        String(1000),\n        nullable=False,\n        index=True,\n        doc=\"Relative path to file in object storage\"\n    )\n    file_size = Column(\n        BigInteger,\n        nullable=False,\n        index=True,\n        doc=\"File size in bytes\"\n    )\n    mime_type = Column(\n        String(100),\n        nullable=False,\n        index=True,\n        doc=\"MIME type of the file\"\n    )\n\n    # Media Classification (Required)\n    media_type = Column(\n        SQLEnum('photo', 'video', 'audio', 'document', 'other',\n                name='media_type_enum'),\n        nullable=False,\n        index=True,\n        doc=\"High-level media classification\"\n    )\n    file_name = Column(\n        String(500),\n        nullable=False,\n        doc=\"Original filename from source\"\n    )\n\n    # Temporal Information (Optional)\n    taken_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        index=True,\n        doc=\"When media was originally created/captured\"\n    )\n    captured_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        index=True,\n        doc=\"Specific capture timestamp\"\n    )\n    modified_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"Last modification time from source\"\n    )\n\n    # Geolocation (Optional)\n    latitude = Column(\n        Numeric(10, 8),\n        nullable=True,\n        index=True,\n        doc=\"GPS latitude coordinate\"\n    )\n    longitude = Column(\n        Numeric(11, 8),\n        nullable=True,\n        index=True,\n        doc=\"GPS longitude coordinate\"\n    )\n    altitude = Column(\n        Numeric(8, 2),\n        nullable=True,\n        doc=\"GPS altitude in meters\"\n    )\n    location_name = Column(\n        String(500),\n        nullable=True,\n        index=True,\n        doc=\"Human-readable location name\"\n    )\n\n    # Dimensions (Optional)\n    width = Column(\n        Integer,\n        nullable=True,\n        doc=\"Media width in pixels\"\n    )\n    height = Column(\n        Integer,\n        nullable=True,\n        doc=\"Media height in pixels\"\n    )\n    duration = Column(\n        Integer,\n        nullable=True,\n        doc=\"Duration in seconds (video/audio)\"\n    )\n\n    # Content Description (Optional)\n    title = Column(\n        String(500),\n        nullable=True,\n        index=True,\n        doc=\"User-provided or platform title\"\n    )\n    caption = Column(\n        Text,\n        nullable=True,\n        doc=\"Detailed description or caption\"\n    )\n    alt_text = Column(\n        String(1000),\n        nullable=True,\n        doc=\"Accessibility description\"\n    )\n    tags = Column(\n        JSONB,\n        nullable=False,\n        default=[],\n        doc=\"Array of tag strings\"\n    )\n\n    # Processing Status (Optional)\n    processing_status = Column(\n        SQLEnum('pending', 'processing', 'completed', 'failed', 'skipped',\n                name='processing_status_enum'),\n        nullable=False,\n        default='pending',\n        index=True,\n        doc=\"Processing pipeline status\"\n    )\n    thumbnail_path = Column(\n        String(1000),\n        nullable=True,\n        doc=\"Path to generated thumbnail\"\n    )\n    hash_sha256 = Column(\n        String(64),\n        nullable=True,\n        index=True,\n        doc=\"SHA-256 hash of file content\"\n    )\n    hash_perceptual = Column(\n        String(64),\n        nullable=True,\n        index=True,\n        doc=\"Perceptual hash for visual similarity\"\n    )\n\n    # Source Information (Optional)\n    source_platform = Column(\n        String(100),\n        nullable=True,\n        index=True,\n        doc=\"Platform where media originated\"\n    )\n    source_id = Column(\n        String(200),\n        nullable=True,\n        index=True,\n        doc=\"External ID from source platform\"\n    )\n    source_url = Column(\n        String(1000),\n        nullable=True,\n        doc=\"Original URL from platform\"\n    )\n    integration_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('integrations.id', ondelete='SET NULL'),\n        nullable=True,\n        index=True,\n        doc=\"Integration that imported this media\"\n    )\n\n    # Relationships\n    owner = relationship(\"User\", foreign_keys=[BaseObject.user_id])\n    integration = relationship(\"Integration\", foreign_keys=[integration_id])\n    albums = relationship(\n        \"Album\",\n        secondary=\"album_media\",\n        back_populates=\"media\"\n    )\n\n    # Table Constraints\n    __table_args__ = (\n        # File size must be positive\n        CheckConstraint('file_size > 0', name='check_file_size_positive'),\n\n        # Dimensions must be positive if provided\n        CheckConstraint(\n            'width IS NULL OR width > 0',\n            name='check_width_positive'\n        ),\n        CheckConstraint(\n            'height IS NULL OR height > 0',\n            name='check_height_positive'\n        ),\n        CheckConstraint(\n            'duration IS NULL OR duration > 0',\n            name='check_duration_positive'\n        ),\n\n        # Latitude range\n        CheckConstraint(\n            'latitude IS NULL OR (latitude >= -90 AND latitude <= 90)',\n            name='check_latitude_range'\n        ),\n\n        # Longitude range\n        CheckConstraint(\n            'longitude IS NULL OR (longitude >= -180 AND longitude <= 180)',\n            name='check_longitude_range'\n        ),\n\n        # Composite indexes\n        Index('idx_media_user_type', 'user_id', 'media_type'),\n        Index('idx_media_taken_at', 'taken_at'),\n        Index('idx_media_location', 'latitude', 'longitude'),\n        Index('idx_media_source', 'source_platform', 'source_id'),\n        Index('idx_media_hash', 'hash_sha256'),\n\n        # GIN index for tags array\n        Index('idx_media_tags', 'tags', postgresql_using='gin'),\n    )\n\n    def __repr__(self):\n        return f\"<Media(id={self.id}, type={self.media_type}, file={self.file_name})>\"\n\n    @property\n    def is_image(self):\n        return self.media_type == 'photo'\n\n    @property\n    def is_video(self):\n        return self.media_type == 'video'\n\n    @property\n    def is_audio(self):\n        return self.media_type == 'audio'\n\n    @property\n    def has_location(self):\n        return self.latitude is not None and self.longitude is not None\n```\n\n---\n\n## Privacy and Security Considerations\n\n### Access Control\n\n1. **Ownership Enforcement**\n   - Media only accessible by owner\n   - No public sharing without explicit permission\n   - Album sharing controls cascaded to media\n\n2. **Location Privacy**\n   - GPS coordinates stripped from public exports by default\n   - User preference: \"Strip location from shared media\"\n   - Coarse location only (city-level) in shared contexts\n\n3. **Content Security**\n   - Files stored in private object storage (S3, etc.)\n   - Pre-signed URLs with expiration for downloads\n   - Thumbnail access requires authentication\n\n### Data Protection\n\n1. **Encryption**\n   - Files encrypted at rest (S3 server-side encryption)\n   - Sensitive metadata encrypted in database\n   - TLS for all file transfers\n\n2. **Deduplication**\n   - Hash-based deduplication at user level\n   - Original files preserved even if duplicates exist\n   - Storage savings passed to user\n\n3. **GDPR Compliance**\n   - User can export all media and metadata\n   - User can delete all media (soft delete with 30-day grace)\n   - Face recognition data deleted on user request\n\n---\n\n## Validation Rules\n\n### On Upload\n\n```yaml\nfile:\n  - Must be valid file format\n  - Size must be > 0 and <= 5 GB\n  - MIME type must match file content\n  - Virus scan passed\n\nuser_quota:\n  - storage_used + file_size <= storage_quota\n  - Reject upload if quota exceeded\n\nmetadata:\n  - title max 500 chars\n  - caption max 10,000 chars\n  - tags: each tag max 100 chars, max 50 tags\n```\n\n### On Update\n\n```yaml\nimmutable_fields:\n  - id, user_id\n  - file_path, file_size, mime_type\n  - hash_sha256, hash_perceptual\n  - created_at\n\nmutable_fields:\n  - title, caption, alt_text, tags\n  - location fields (lat, lng, location_name)\n  - taken_at, captured_at\n  - width, height, duration (if incorrect initially)\n```\n\n---\n\n## Use Cases and Examples\n\n### Example 1: Instagram Photo Import\n\n```json\n{\n  \"id\": \"media-550e8400-e29b-41d4-a716-446655440000\",\n  \"user_id\": \"user-uuid\",\n  \"file_path\": \"users/user-uuid/media/2024/02/photo-uuid.jpg\",\n  \"file_size\": 2456789,\n  \"mime_type\": \"image/jpeg\",\n  \"media_type\": \"photo\",\n  \"file_name\": \"441234567890_abc.jpg\",\n  \"taken_at\": \"2024-02-09T14:30:00Z\",\n  \"latitude\": 37.7749,\n  \"longitude\": -122.4194,\n  \"location_name\": \"San Francisco, CA\",\n  \"width\": 1080,\n  \"height\": 1080,\n  \"title\": \"Golden Gate at sunset\",\n  \"caption\": \"Beautiful evening walk across the bridge #sunset #goldengatebridge\",\n  \"tags\": [\"sunset\", \"travel\", \"sanfrancisco\"],\n  \"processing_status\": \"completed\",\n  \"thumbnail_path\": \"users/user-uuid/media/2024/02/thumbnails/photo-uuid_thumb.jpg\",\n  \"hash_sha256\": \"abc123...\",\n  \"hash_perceptual\": \"def456...\",\n  \"source_platform\": \"instagram\",\n  \"source_id\": \"2847593720193\",\n  \"source_url\": \"https://www.instagram.com/p/ABC123/\",\n  \"integration_id\": \"integration-uuid\",\n  \"metadata\": {\n    \"exif\": {\n      \"make\": \"Apple\",\n      \"model\": \"iPhone 15 Pro\",\n      \"iso\": 200\n    },\n    \"platform\": {\n      \"instagram\": {\n        \"like_count\": 324,\n        \"comment_count\": 18,\n        \"filter\": \"Clarendon\"\n      }\n    },\n    \"ai_analysis\": {\n      \"labels\": [\n        {\"label\": \"bridge\", \"confidence\": 0.98},\n        {\"label\": \"sunset\", \"confidence\": 0.95}\n      ]\n    }\n  },\n  \"created_at\": \"2026-02-09T15:00:00Z\",\n  \"updated_at\": \"2026-02-09T15:05:00Z\",\n  \"deleted_at\": null\n}\n```\n\n### Example 2: Local Video Upload\n\n```json\n{\n  \"id\": \"media-660e8400-e29b-41d4-a716-446655440001\",\n  \"user_id\": \"user-uuid\",\n  \"file_path\": \"users/user-uuid/media/2024/02/video-uuid.mp4\",\n  \"file_size\": 125829120,\n  \"mime_type\": \"video/mp4\",\n  \"media_type\": \"video\",\n  \"file_name\": \"birthday_party.mp4\",\n  \"taken_at\": \"2024-02-08T18:00:00Z\",\n  \"width\": 1920,\n  \"height\": 1080,\n  \"duration\": 180,\n  \"title\": \"Sarah's Birthday Party\",\n  \"caption\": \"Amazing celebration with friends and family!\",\n  \"tags\": [\"birthday\", \"family\", \"celebration\"],\n  \"processing_status\": \"completed\",\n  \"thumbnail_path\": \"users/user-uuid/media/2024/02/thumbnails/video-uuid_thumb.jpg\",\n  \"hash_sha256\": \"xyz789...\",\n  \"source_platform\": \"local_upload\",\n  \"created_at\": \"2026-02-09T16:00:00Z\",\n  \"updated_at\": \"2026-02-09T16:10:00Z\",\n  \"deleted_at\": null\n}\n```\n\n### Example 3: PDF Document\n\n```json\n{\n  \"id\": \"media-770e8400-e29b-41d4-a716-446655440002\",\n  \"user_id\": \"user-uuid\",\n  \"file_path\": \"users/user-uuid/media/2024/02/doc-uuid.pdf\",\n  \"file_size\": 5242880,\n  \"mime_type\": \"application/pdf\",\n  \"media_type\": \"document\",\n  \"file_name\": \"Q4_2024_Report.pdf\",\n  \"taken_at\": \"2024-01-15T09:00:00Z\",\n  \"title\": \"Q4 2024 Financial Report\",\n  \"tags\": [\"work\", \"finance\", \"2024\", \"report\"],\n  \"processing_status\": \"completed\",\n  \"thumbnail_path\": \"users/user-uuid/media/2024/02/thumbnails/doc-uuid_thumb.jpg\",\n  \"hash_sha256\": \"report123...\",\n  \"source_platform\": \"local_upload\",\n  \"metadata\": {\n    \"file_info\": {\n      \"pages\": 24,\n      \"author\": \"Finance Team\",\n      \"creation_date\": \"2024-01-15T09:00:00Z\"\n    },\n    \"ai_analysis\": {\n      \"text\": \"Extracted text content via OCR...\",\n      \"categories\": [\"finance\", \"business\"]\n    }\n  },\n  \"created_at\": \"2026-02-09T17:00:00Z\",\n  \"updated_at\": \"2026-02-09T17:05:00Z\",\n  \"deleted_at\": null\n}\n```\n\n---\n\n## Lifecycle States\n\n### 1. Uploaded (Pending Processing)\n\n```yaml\nstate: \"uploaded\"\nprocessing_status: \"pending\"\ncapabilities:\n  - File stored in object storage\n  - Metadata extracted from file\n  - Awaiting thumbnail generation\n  - Awaiting AI analysis\ntransitions:\n  - start_processing -> Processing\n```\n\n### 2. Processing\n\n```yaml\nstate: \"processing\"\nprocessing_status: \"processing\"\noperations:\n  - Thumbnail generation\n  - Hash computation\n  - AI label detection\n  - Face recognition\n  - OCR (if applicable)\ntransitions:\n  - complete -> Active\n  - error -> Failed\n```\n\n### 3. Active (Fully Processed)\n\n```yaml\nstate: \"active\"\nprocessing_status: \"completed\"\ncapabilities:\n  - Full searchability\n  - Thumbnail available\n  - AI analysis complete\n  - Can be added to albums\n  - Can be shared\ntransitions:\n  - delete -> Deleted\n  - reprocess -> Processing\n```\n\n### 4. Failed (Processing Error)\n\n```yaml\nstate: \"failed\"\nprocessing_status: \"failed\"\nbehavior:\n  - File preserved\n  - Original metadata available\n  - No thumbnail or AI data\n  - Retry processing available\ntransitions:\n  - retry -> Processing\n  - delete -> Deleted\n```\n\n### 5. Deleted (Soft Delete)\n\n```yaml\nstate: \"deleted\"\ndeleted_at: not null\nbehavior:\n  - File moved to trash\n  - 30-day retention\n  - Removed from albums\n  - Not visible in UI\ntransitions:\n  - restore -> Active\n  - timeout (30 days) -> Hard Deleted\n```\n\n---\n\n## Notes for Implementers\n\n### Performance Optimization\n\n1. **Indexing Strategy**\n   - Composite index on (user_id, media_type) for filtered lists\n   - Index on taken_at for timeline views\n   - GIN index on tags JSONB for tag searches\n   - Spatial index on (latitude, longitude) for map views\n\n2. **Caching**\n   - Cache thumbnails with CDN (CloudFront, etc.)\n   - Cache media metadata (5 minute TTL)\n   - Cache search results (1 minute TTL)\n\n3. **Async Processing**\n   - Use job queue (Celery, RQ) for processing pipeline\n   - Process uploads asynchronously\n   - Return immediately with pending status\n\n### Storage Optimization\n\n1. **Deduplication**\n   ```python\n   # Check if file already exists for user\n   existing = Media.query.filter_by(\n       user_id=user_id,\n       hash_sha256=computed_hash\n   ).first()\n\n   if existing:\n       # Create new Media record pointing to same file\n       # Don't upload duplicate file\n   ```\n\n2. **Cleanup Jobs**\n   - Delete files after 30 days in trash\n   - Clean orphaned files (no database record)\n   - Compress old thumbnails\n\n---\n\n**Status:** Active - Core Media Type\n**Version:** 1.0\n**Authority:** 0.0.2 - Media Types\n**Created:** 2026-02-09\n**Owner:** Hypernet Core (0.*)\n"
  },
  "created_at": "2026-02-15T11:54:04.702633+00:00",
  "updated_at": "2026-02-15T11:54:04.702633+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:0.0.2.1-MEDIA.md"
}