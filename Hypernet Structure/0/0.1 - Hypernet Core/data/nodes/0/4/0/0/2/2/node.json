{
  "address": "0.4.0.0.2.2",
  "type_address": null,
  "data": {
    "name": "0.0.2.2-ALBUM.md",
    "type": "file",
    "extension": ".md",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.4 - Object Type Registry\\0.0.2 - Media Types\\0.0.2.2-ALBUM.md",
    "size": 34798,
    "content": "# ALBUM - Media Collection Object Type\n\n**Type ID:** `hypernet.media.album`\n**Version:** 1.0\n**Category:** 0.0.2 - Media Types\n**Parent:** BaseObject\n**Status:** Active - Core Media Type\n**Created:** 2026-02-09\n**Last Updated:** 2026-02-09\n\n---\n\n## Object Type Metadata\n\n```yaml\ntype_name: \"Album\"\ntype_id: \"hypernet.media.album\"\nversion: \"1.0\"\nparent_type: \"BaseObject\"\ncategory: \"0.0.2 - Media Types\"\nabstract: false\ninstantiable: true\n```\n\n---\n\n## Purpose and Description\n\n### What is an Album?\n\nThe Album object type represents a curated collection of media items (photos, videos, audio, documents). Albums provide organizational structure for media, enabling users to group related content by theme, event, time period, or any custom criteria. Albums are the primary organizational tool in Hypernet's media management system.\n\n### Revolutionary Design Philosophy\n\nHypernet albums are flexible, intelligent, and source-agnostic:\n- **Multi-Media Support** - Albums can contain photos, videos, audio, and documents\n- **Smart and Manual** - Support both curated manual albums and AI-generated smart albums\n- **Source Agnostic** - Combine media from Instagram, Google Photos, local uploads, and more\n- **Nested Organization** - Albums can contain sub-albums for hierarchical organization\n- **Collaborative** - Share albums with specific users or make them public\n- **Synchronized** - Keep albums in sync with platform albums (Instagram albums, Google Photos albums)\n\n### Core Functions\n\n1. **Media Organization** - Group related media into logical collections\n2. **Timeline Creation** - Organize media chronologically for events and trips\n3. **Smart Collections** - Auto-generate albums based on criteria (date, location, tags, AI analysis)\n4. **Sharing and Collaboration** - Share albums with family, friends, or publicly\n5. **Export and Backup** - Download entire albums as ZIP archives\n6. **Cross-Platform Unification** - Combine media from multiple sources into unified albums\n\n### When to Use\n\n- Creating event-based collections (wedding, vacation, birthday party)\n- Organizing photos by theme (family, work, hobbies)\n- Building smart collections (all photos at a location, all videos from 2024)\n- Importing platform albums (Instagram albums, Google Photos albums)\n- Creating shareable galleries for external viewing\n- Organizing AI-generated content by project or theme\n\n---\n\n## Inherited Fields from BaseObject\n\n```yaml\nid: UUID\n  - Globally unique album identifier\n  - Generated on creation\n\ncreated_at: DateTime\n  - Album creation timestamp\n  - Immutable\n\nupdated_at: DateTime\n  - Last modification timestamp (metadata or media changes)\n  - Auto-updated when media added/removed or metadata changed\n\ndeleted_at: DateTime (nullable)\n  - Soft delete timestamp\n  - Null for active albums\n  - Albums preserved for 30 days before hard delete\n\nuser_id: UUID\n  - Foreign key to User who owns this album\n  - Required - all albums must have an owner\n  - Immutable (use ownership transfer API for changes)\n\nmetadata: JSONB\n  - Extensible metadata storage\n  - See Metadata Schema section below\n  - Stores platform-specific data, smart album criteria\n```\n\n---\n\n## Required Fields\n\n### Album Identity\n\n```yaml\ntitle: String(500)\n  type: String\n  max_length: 500\n  nullable: false\n  indexed: true\n  description: \"Album title or name\"\n  examples:\n    - \"Summer Vacation 2024\"\n    - \"Best Photos of 2023\"\n    - \"Work Projects\"\n    - \"Sarah's Birthday Party\"\n  constraints:\n    - Minimum 1 character\n    - Maximum 500 characters\n    - Trimmed of whitespace\n  searchable: true\n\nalbum_type: Enum\n  type: String\n  max_length: 20\n  nullable: false\n  indexed: true\n  default: \"manual\"\n  description: \"Type of album organization\"\n  allowed_values:\n    - \"manual\": User-curated album with explicit media selection\n    - \"smart\": Auto-generated based on criteria (date, location, tags, AI)\n    - \"imported\": Synchronized from external platform (Instagram, Google Photos)\n    - \"system\": System-generated (All Photos, Favorites, Recently Added)\n  behavior:\n    manual: User explicitly adds/removes media\n    smart: Media auto-added based on smart_criteria in metadata\n    imported: Synced with platform album via integration\n    system: Cannot be deleted, auto-maintained by system\n```\n\n---\n\n## Optional Fields\n\n### Album Description\n\n```yaml\ndescription: Text\n  type: Text\n  nullable: true\n  max_length: 5000\n  description: \"Detailed description of album content and purpose\"\n  examples:\n    - \"Photos from our amazing 2-week trip through Japan\"\n    - \"Professional headshots and portfolio images\"\n  searchable: true\n  format: \"Plain text or Markdown\"\n\ncover_media_id: UUID\n  type: UUID\n  nullable: true\n  description: \"Foreign key to Media object used as album cover\"\n  references: \"Media.id\"\n  cascade: \"ON DELETE SET NULL\"\n  constraints:\n    - Media must be in this album\n    - Media must not be deleted\n    - Defaults to first media in album if not set\n  usage: \"Display as album thumbnail in UI\"\n```\n\n### Organization\n\n```yaml\nparent_album_id: UUID\n  type: UUID\n  nullable: true\n  indexed: true\n  description: \"Foreign key to parent Album for nested organization\"\n  references: \"Album.id\"\n  cascade: \"ON DELETE CASCADE\"\n  constraints:\n    - Cannot be self-referencing\n    - Cannot create circular references\n    - Max depth: 5 levels\n  examples:\n    - \"Travel 2024\" contains \"Japan Trip\", \"Europe Trip\"\n    - \"Work\" contains \"Projects\", \"Events\"\n\nsort_order: String(50)\n  type: String\n  max_length: 50\n  nullable: false\n  default: \"date_desc\"\n  description: \"Default sort order for media in album\"\n  allowed_values:\n    - \"date_desc\": Newest first (default)\n    - \"date_asc\": Oldest first\n    - \"title_asc\": Alphabetical by title\n    - \"manual\": User-defined custom order\n    - \"added_desc\": Recently added first\n  usage: \"Determines display order in UI and API responses\"\n\nmedia_count: Integer\n  type: Integer\n  nullable: false\n  default: 0\n  indexed: true\n  description: \"Number of media items in album (denormalized)\"\n  constraints:\n    - Must be >= 0\n    - Updated automatically when media added/removed\n    - Excludes deleted media\n  performance: \"Cached count for fast display without JOIN\"\n```\n\n### Temporal Information\n\n```yaml\nstart_date: DateTime\n  type: DateTime\n  nullable: true\n  indexed: true\n  timezone: true\n  description: \"Start date/time for event-based albums\"\n  examples:\n    - Vacation album: \"2024-06-01T00:00:00Z\"\n    - Conference album: \"2024-03-15T09:00:00Z\"\n  usage: \"Filter albums by date range, display in timeline\"\n\nend_date: DateTime\n  type: DateTime\n  nullable: true\n  timezone: true\n  description: \"End date/time for event-based albums\"\n  constraints:\n    - Must be >= start_date if both provided\n  examples:\n    - Vacation album: \"2024-06-14T23:59:59Z\"\n```\n\n### Sharing and Privacy\n\n```yaml\nvisibility: Enum\n  type: String\n  max_length: 20\n  nullable: false\n  default: \"private\"\n  indexed: true\n  description: \"Album visibility and sharing settings\"\n  allowed_values:\n    - \"private\": Only owner can view\n    - \"shared\": Shared with specific users (see album_shares table)\n    - \"public\": Anyone with link can view\n    - \"unlisted\": Public but not indexed/searchable\n  security:\n    - private: Requires authentication as owner\n    - shared: Requires authentication as owner or invited user\n    - public: No authentication required\n    - unlisted: No authentication required, not in public listings\n\nshare_token: String(64)\n  type: String\n  max_length: 64\n  nullable: true\n  indexed: true\n  unique: true\n  description: \"Random token for public/unlisted album access\"\n  format: \"64 character random alphanumeric string\"\n  generation: \"Auto-generated when visibility set to public/unlisted\"\n  usage: \"Access via /albums/shared/{share_token}\"\n  security:\n    - Token is unguessable (cryptographically random)\n    - Can be regenerated to revoke old link\n    - Required for public/unlisted access\n\nallow_downloads: Boolean\n  type: Boolean\n  nullable: false\n  default: true\n  description: \"Whether viewers can download media from shared albums\"\n  applicable: \"visibility = shared, public, or unlisted\"\n  behavior:\n    true: Download buttons visible, media files accessible\n    false: View-only mode, no download buttons\n```\n\n### Platform Synchronization\n\n```yaml\nsource_platform: String(100)\n  type: String\n  max_length: 100\n  nullable: true\n  indexed: true\n  description: \"Platform where album originated (for imported albums)\"\n  examples:\n    - \"instagram\"\n    - \"google_photos\"\n    - \"facebook\"\n    - \"icloud\"\n  applicable: \"album_type = 'imported'\"\n\nsource_id: String(200)\n  type: String\n  max_length: 200\n  nullable: true\n  indexed: true\n  description: \"External album ID from source platform\"\n  examples:\n    - Instagram album ID\n    - Google Photos album ID\n  purpose: \"Prevent duplicate imports, enable sync\"\n\nintegration_id: UUID\n  type: UUID\n  nullable: true\n  indexed: true\n  description: \"Foreign key to Integration that manages this album\"\n  references: \"Integration.id\"\n  cascade: \"ON DELETE SET NULL\"\n  purpose: \"Track which integration created/syncs this album\"\n\nsync_enabled: Boolean\n  type: Boolean\n  nullable: false\n  default: false\n  description: \"Whether album stays synced with platform album\"\n  applicable: \"album_type = 'imported'\"\n  behavior:\n    true: Periodic sync adds new media from platform\n    false: Album is static snapshot\n```\n\n---\n\n## Metadata Schema\n\nThe `metadata` JSONB field stores smart album criteria and platform-specific data:\n\n```json\n{\n  \"smart_criteria\": {\n    \"media_type\": [\"photo\", \"video\"],\n    \"tags\": [\"vacation\", \"2024\"],\n    \"location\": \"Hawaii\",\n    \"date_range\": {\n      \"start\": \"2024-06-01\",\n      \"end\": \"2024-06-30\"\n    },\n    \"ai_labels\": [\"beach\", \"sunset\"],\n    \"min_quality_score\": 0.8,\n    \"people\": [\"person-uuid-1\", \"person-uuid-2\"]\n  },\n  \"platform\": {\n    \"instagram\": {\n      \"album_id\": \"abc123\",\n      \"album_name\": \"Summer Highlights\",\n      \"last_synced\": \"2026-02-09T10:00:00Z\",\n      \"media_count_platform\": 24\n    },\n    \"google_photos\": {\n      \"album_id\": \"xyz789\",\n      \"shared_url\": \"https://photos.app.goo.gl/...\",\n      \"is_shared\": true,\n      \"collaborators\": [\"user@example.com\"]\n    }\n  },\n  \"display\": {\n    \"theme\": \"light\",\n    \"layout\": \"grid\",\n    \"columns\": 3,\n    \"show_captions\": true,\n    \"show_dates\": true\n  },\n  \"stats\": {\n    \"total_views\": 1250,\n    \"total_downloads\": 42,\n    \"last_viewed_at\": \"2026-02-09T14:30:00Z\"\n  },\n  \"export\": {\n    \"last_export_at\": \"2026-01-15T09:00:00Z\",\n    \"export_format\": \"zip\",\n    \"include_metadata\": true\n  }\n}\n```\n\n---\n\n## Relationships to Other Object Types\n\n### Ownership\n\n```yaml\nowned_by: User\n  description: \"User who owns this album\"\n  cardinality: \"N:1 (many albums, one owner)\"\n  implementation: \"user_id foreign key\"\n  cascade: \"ON DELETE CASCADE (delete album if user deleted)\"\n\ncreated_by: Integration\n  description: \"Integration that created this album (if imported)\"\n  cardinality: \"N:1 (many albums, one integration)\"\n  implementation: \"integration_id foreign key\"\n  cascade: \"ON DELETE SET NULL\"\n```\n\n### Media Organization\n\n```yaml\ncontains_media: Media\n  description: \"Media items in this album\"\n  cardinality: \"M:N (many albums, many media)\"\n  implementation: \"album_media join table\"\n  join_table_fields:\n    - album_id: UUID (FK to Album.id)\n    - media_id: UUID (FK to Media.id)\n    - position: Integer (for manual sort order)\n    - added_at: DateTime (when media added to album)\n  constraints:\n    - Composite unique (album_id, media_id)\n    - Media can be in multiple albums\n    - Position used for sort_order = 'manual'\n\nhas_cover: Media\n  description: \"Media used as album cover/thumbnail\"\n  cardinality: \"N:1 (many albums, one cover media)\"\n  implementation: \"cover_media_id foreign key\"\n  cascade: \"ON DELETE SET NULL\"\n  constraint: \"Cover media must be in the album\"\n```\n\n### Hierarchical Organization\n\n```yaml\nparent_album: Album\n  description: \"Parent album in nested hierarchy\"\n  cardinality: \"N:1 (many child albums, one parent)\"\n  implementation: \"parent_album_id foreign key\"\n  cascade: \"ON DELETE CASCADE\"\n  constraints:\n    - No circular references\n    - Max depth: 5 levels\n\nchild_albums: Album\n  description: \"Sub-albums nested under this album\"\n  cardinality: \"1:N (one parent, many children)\"\n  implementation: \"Reverse of parent_album\"\n```\n\n### Sharing\n\n```yaml\nshared_with: User\n  description: \"Users who have access to shared album\"\n  cardinality: \"M:N (many albums, many users)\"\n  implementation: \"album_shares join table\"\n  join_table_fields:\n    - album_id: UUID\n    - user_id: UUID\n    - permission: Enum (view, edit, admin)\n    - shared_at: DateTime\n    - shared_by: UUID (user who granted access)\n  applicable: \"visibility = 'shared'\"\n```\n\n---\n\n## API Endpoints\n\n### Album Creation\n\n```http\nPOST /api/v1/albums\n  Description: Create new album\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"title\": \"Summer Vacation 2024\",\n      \"description\": \"Trip to Hawaii\",\n      \"album_type\": \"manual\",\n      \"start_date\": \"2024-06-01T00:00:00Z\",\n      \"end_date\": \"2024-06-14T23:59:59Z\",\n      \"visibility\": \"private\"\n    }\n  Response: 201 Created\n    {\n      \"id\": \"album-uuid\",\n      \"title\": \"Summer Vacation 2024\",\n      \"album_type\": \"manual\",\n      \"media_count\": 0,\n      \"visibility\": \"private\",\n      \"created_at\": \"2026-02-09T15:00:00Z\"\n    }\n\nPOST /api/v1/albums/smart\n  Description: Create smart album with auto-population\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"title\": \"Hawaii Photos\",\n      \"album_type\": \"smart\",\n      \"metadata\": {\n        \"smart_criteria\": {\n          \"location\": \"Hawaii\",\n          \"date_range\": {\n            \"start\": \"2024-06-01\",\n            \"end\": \"2024-06-30\"\n          },\n          \"media_type\": [\"photo\"]\n        }\n      }\n    }\n  Response: 201 Created\n    {\n      \"id\": \"album-uuid\",\n      \"title\": \"Hawaii Photos\",\n      \"album_type\": \"smart\",\n      \"media_count\": 127,\n      \"created_at\": \"2026-02-09T15:00:00Z\"\n    }\n  Behavior:\n    - Media automatically added based on smart_criteria\n    - Album updates as new matching media is added\n```\n\n### Album Retrieval\n\n```http\nGET /api/v1/albums/{id}\n  Description: Get album details with media list\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    include_media: true|false (default: false)\n    limit: 50 (media page size, default: 50)\n    offset: 0 (media pagination offset)\n  Response: 200 OK\n    {\n      \"id\": \"album-uuid\",\n      \"title\": \"Summer Vacation 2024\",\n      \"description\": \"Trip to Hawaii\",\n      \"album_type\": \"manual\",\n      \"media_count\": 127,\n      \"cover_media_id\": \"media-uuid\",\n      \"visibility\": \"private\",\n      \"created_at\": \"2026-02-09T15:00:00Z\",\n      \"media\": [{media objects}]  // if include_media=true\n    }\n  Privacy:\n    - Owner always has access\n    - Shared users need appropriate permission\n    - Public/unlisted accessible via share_token\n\nGET /api/v1/albums/{id}/media\n  Description: Get paginated media in album\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    limit: 50 (default: 50, max: 200)\n    offset: 0\n    sort: date_desc|date_asc|manual (uses album's sort_order by default)\n  Response: 200 OK\n    {\n      \"media\": [{media objects}],\n      \"total\": 127,\n      \"limit\": 50,\n      \"offset\": 0,\n      \"album\": {album summary}\n    }\n\nGET /api/v1/albums/shared/{share_token}\n  Description: Access public/unlisted album via share token\n  Headers: None (public access)\n  Response: 200 OK\n    {album and media data}\n  Behavior:\n    - No authentication required\n    - Respects allow_downloads setting\n    - Limited to visibility=public or unlisted\n```\n\n### Album Management\n\n```http\nPATCH /api/v1/albums/{id}\n  Description: Update album metadata\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"title\": \"Updated Title\",\n      \"description\": \"Updated description\",\n      \"cover_media_id\": \"media-uuid\",\n      \"visibility\": \"shared\",\n      \"allow_downloads\": false\n    }\n  Response: 200 OK\n    {updated album object}\n  Constraints:\n    - Cannot change: album_type (manual/smart/imported)\n    - Owner or users with edit permission only\n\nDELETE /api/v1/albums/{id}\n  Description: Soft delete album\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 204 No Content\n  Behavior:\n    - Sets deleted_at timestamp\n    - Album preserved for 30 days\n    - Media remains (only album deleted)\n    - Cannot delete system albums\n  Permissions:\n    - Owner or users with admin permission only\n```\n\n### Media Management\n\n```http\nPOST /api/v1/albums/{id}/media\n  Description: Add media to album\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"media_ids\": [\"media-uuid-1\", \"media-uuid-2\"],\n      \"position\": 0  // Optional, for manual sort order\n    }\n  Response: 200 OK\n    {\n      \"added_count\": 2,\n      \"album\": {updated album object}\n    }\n  Constraints:\n    - Media must be owned by user\n    - Media must not be deleted\n    - Duplicates ignored (no error)\n    - Only for manual albums (smart albums auto-managed)\n\nDELETE /api/v1/albums/{id}/media\n  Description: Remove media from album\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"media_ids\": [\"media-uuid-1\", \"media-uuid-2\"]\n    }\n  Response: 200 OK\n    {\n      \"removed_count\": 2,\n      \"album\": {updated album object}\n    }\n  Behavior:\n    - Media not deleted, only removed from album\n    - Media can still be in other albums\n    - Only for manual albums\n\nPOST /api/v1/albums/{id}/reorder\n  Description: Reorder media in album (manual sort only)\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"media_positions\": [\n        {\"media_id\": \"uuid-1\", \"position\": 0},\n        {\"media_id\": \"uuid-2\", \"position\": 1},\n        {\"media_id\": \"uuid-3\", \"position\": 2}\n      ]\n    }\n  Response: 200 OK\n  Constraints:\n    - Only for albums with sort_order = 'manual'\n```\n\n### Sharing\n\n```http\nPOST /api/v1/albums/{id}/share\n  Description: Share album with users or generate public link\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"visibility\": \"shared\",\n      \"user_emails\": [\"user@example.com\"],\n      \"permission\": \"view\",\n      \"allow_downloads\": true\n    }\n  Response: 200 OK\n    {\n      \"album\": {updated album object},\n      \"share_url\": \"https://hypernet.io/albums/shared/{token}\"\n    }\n  Behavior:\n    - Generates share_token if not exists\n    - Sends email invitations to shared users\n    - Creates album_shares records\n\nDELETE /api/v1/albums/{id}/share\n  Description: Remove sharing / make album private\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n  Behavior:\n    - Sets visibility to 'private'\n    - Removes all album_shares records\n    - Keeps share_token (for potential re-sharing)\n\nPOST /api/v1/albums/{id}/regenerate-token\n  Description: Generate new share token (revoke old link)\n  Headers:\n    Authorization: Bearer {access_token}\n  Response: 200 OK\n    {\n      \"share_token\": \"new-token\",\n      \"share_url\": \"https://hypernet.io/albums/shared/{new-token}\"\n    }\n  Purpose: \"Revoke access via old public link\"\n```\n\n### Bulk Operations\n\n```http\nGET /api/v1/albums\n  Description: List user's albums\n  Headers:\n    Authorization: Bearer {access_token}\n  Query Parameters:\n    album_type: manual|smart|imported|system\n    parent_album_id: {uuid} - Child albums only\n    visibility: private|shared|public|unlisted\n    limit: 50 (default: 50, max: 200)\n    offset: 0\n    sort: created_at|updated_at|title|media_count\n    order: asc|desc (default: desc)\n  Response: 200 OK\n    {\n      \"albums\": [{album objects}],\n      \"total\": 45,\n      \"limit\": 50,\n      \"offset\": 0\n    }\n\nPOST /api/v1/albums/{id}/export\n  Description: Export album as ZIP file\n  Headers:\n    Authorization: Bearer {access_token}\n  Request Body:\n    {\n      \"include_metadata\": true,\n      \"format\": \"zip\"\n    }\n  Response: 202 Accepted\n    {\n      \"job_id\": \"export-job-uuid\",\n      \"status\": \"processing\"\n    }\n  Behavior:\n    - Async job to create ZIP file\n    - Includes all media files\n    - Optional JSON metadata file\n    - Download link sent when ready\n```\n\n---\n\n## Database Schema (SQLAlchemy Model Reference)\n\n```python\nfrom sqlalchemy import (\n    Column, String, Integer, Enum as SQLEnum,\n    DateTime, Boolean, ForeignKey, Index, CheckConstraint, Text, Table\n)\nfrom sqlalchemy.dialects.postgresql import UUID, JSONB\nfrom sqlalchemy.orm import relationship\nfrom app.models.base import BaseObject\n\n# Association table for album-media many-to-many relationship\nalbum_media = Table(\n    'album_media',\n    BaseObject.metadata,\n    Column('album_id', UUID(as_uuid=True), ForeignKey('albums.id', ondelete='CASCADE'),\n           primary_key=True),\n    Column('media_id', UUID(as_uuid=True), ForeignKey('media.id', ondelete='CASCADE'),\n           primary_key=True),\n    Column('position', Integer, nullable=True, doc=\"Position for manual sort order\"),\n    Column('added_at', DateTime(timezone=True), nullable=False,\n           default=datetime.utcnow, doc=\"When media was added to album\"),\n    Index('idx_album_media_album', 'album_id'),\n    Index('idx_album_media_media', 'media_id'),\n    Index('idx_album_media_position', 'album_id', 'position'),\n)\n\n# Association table for album sharing\nalbum_shares = Table(\n    'album_shares',\n    BaseObject.metadata,\n    Column('album_id', UUID(as_uuid=True), ForeignKey('albums.id', ondelete='CASCADE'),\n           primary_key=True),\n    Column('user_id', UUID(as_uuid=True), ForeignKey('users.id', ondelete='CASCADE'),\n           primary_key=True),\n    Column('permission', SQLEnum('view', 'edit', 'admin', name='album_permission_enum'),\n           nullable=False, default='view'),\n    Column('shared_at', DateTime(timezone=True), nullable=False, default=datetime.utcnow),\n    Column('shared_by', UUID(as_uuid=True), ForeignKey('users.id', ondelete='SET NULL'),\n           nullable=True),\n    Index('idx_album_shares_user', 'user_id'),\n)\n\nclass Album(BaseObject):\n    \"\"\"\n    Album - collection of media items\n\n    Inherits from BaseObject: id, user_id, created_at, updated_at, deleted_at, metadata\n    \"\"\"\n\n    __tablename__ = \"albums\"\n\n    # Album Identity (Required)\n    title = Column(\n        String(500),\n        nullable=False,\n        index=True,\n        doc=\"Album title or name\"\n    )\n    album_type = Column(\n        SQLEnum('manual', 'smart', 'imported', 'system',\n                name='album_type_enum'),\n        nullable=False,\n        index=True,\n        default='manual',\n        doc=\"Type of album organization\"\n    )\n\n    # Album Description (Optional)\n    description = Column(\n        Text,\n        nullable=True,\n        doc=\"Detailed description of album\"\n    )\n    cover_media_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('media.id', ondelete='SET NULL'),\n        nullable=True,\n        doc=\"Media used as album cover\"\n    )\n\n    # Organization (Optional)\n    parent_album_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('albums.id', ondelete='CASCADE'),\n        nullable=True,\n        index=True,\n        doc=\"Parent album for nested organization\"\n    )\n    sort_order = Column(\n        String(50),\n        nullable=False,\n        default='date_desc',\n        doc=\"Default sort order for media\"\n    )\n    media_count = Column(\n        Integer,\n        nullable=False,\n        default=0,\n        index=True,\n        doc=\"Number of media items (denormalized)\"\n    )\n\n    # Temporal Information (Optional)\n    start_date = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        index=True,\n        doc=\"Start date/time for event-based albums\"\n    )\n    end_date = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"End date/time for event-based albums\"\n    )\n\n    # Sharing and Privacy (Optional)\n    visibility = Column(\n        SQLEnum('private', 'shared', 'public', 'unlisted',\n                name='album_visibility_enum'),\n        nullable=False,\n        default='private',\n        index=True,\n        doc=\"Album visibility setting\"\n    )\n    share_token = Column(\n        String(64),\n        nullable=True,\n        unique=True,\n        index=True,\n        doc=\"Random token for public access\"\n    )\n    allow_downloads = Column(\n        Boolean,\n        nullable=False,\n        default=True,\n        doc=\"Allow downloads in shared albums\"\n    )\n\n    # Platform Synchronization (Optional)\n    source_platform = Column(\n        String(100),\n        nullable=True,\n        index=True,\n        doc=\"Platform where album originated\"\n    )\n    source_id = Column(\n        String(200),\n        nullable=True,\n        index=True,\n        doc=\"External album ID\"\n    )\n    integration_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey('integrations.id', ondelete='SET NULL'),\n        nullable=True,\n        index=True,\n        doc=\"Integration that manages this album\"\n    )\n    sync_enabled = Column(\n        Boolean,\n        nullable=False,\n        default=False,\n        doc=\"Keep synced with platform album\"\n    )\n\n    # Relationships\n    owner = relationship(\"User\", foreign_keys=[BaseObject.user_id])\n    cover_media = relationship(\"Media\", foreign_keys=[cover_media_id])\n    integration = relationship(\"Integration\", foreign_keys=[integration_id])\n\n    media = relationship(\n        \"Media\",\n        secondary=album_media,\n        back_populates=\"albums\",\n        order_by=\"album_media.c.position\"\n    )\n\n    parent_album = relationship(\n        \"Album\",\n        remote_side=\"Album.id\",\n        foreign_keys=[parent_album_id]\n    )\n    child_albums = relationship(\n        \"Album\",\n        back_populates=\"parent_album\"\n    )\n\n    shared_users = relationship(\n        \"User\",\n        secondary=album_shares,\n        backref=\"shared_albums\"\n    )\n\n    # Table Constraints\n    __table_args__ = (\n        # Media count must be non-negative\n        CheckConstraint('media_count >= 0', name='check_media_count'),\n\n        # End date must be after start date\n        CheckConstraint(\n            'end_date IS NULL OR start_date IS NULL OR end_date >= start_date',\n            name='check_date_range'\n        ),\n\n        # Cannot be own parent\n        CheckConstraint(\n            'parent_album_id IS NULL OR parent_album_id != id',\n            name='check_no_self_parent'\n        ),\n\n        # Composite indexes\n        Index('idx_album_user_type', 'user_id', 'album_type'),\n        Index('idx_album_visibility', 'visibility'),\n        Index('idx_album_dates', 'start_date', 'end_date'),\n        Index('idx_album_source', 'source_platform', 'source_id'),\n    )\n\n    def __repr__(self):\n        return f\"<Album(id={self.id}, title={self.title}, type={self.album_type})>\"\n\n    @property\n    def is_manual(self):\n        return self.album_type == 'manual'\n\n    @property\n    def is_smart(self):\n        return self.album_type == 'smart'\n\n    @property\n    def is_shared(self):\n        return self.visibility in ('shared', 'public', 'unlisted')\n\n    @property\n    def public_url(self):\n        if self.share_token and self.visibility in ('public', 'unlisted'):\n            return f\"https://hypernet.io/albums/shared/{self.share_token}\"\n        return None\n```\n\n---\n\n## Privacy and Security Considerations\n\n### Access Control\n\n1. **Ownership Enforcement**\n   - Albums only accessible by owner by default\n   - Shared albums require explicit permission grant\n   - Public albums accessible via unguessable token\n\n2. **Permission Levels**\n   - View: Can view album and media, download if allowed\n   - Edit: Can add/remove media, edit metadata\n   - Admin: Can delete album, change sharing settings\n\n3. **Share Token Security**\n   - 64 character cryptographically random token\n   - Unguessable without sharing\n   - Can be regenerated to revoke access\n   - Separate tokens per album\n\n### Data Protection\n\n1. **Privacy Cascading**\n   - Album privacy doesn't override media privacy\n   - Shared album shows only media user has access to\n   - Location data stripped if user preference set\n\n2. **Download Control**\n   - allow_downloads flag prevents file access\n   - View-only mode for sensitive albums\n   - Watermarking option (future)\n\n3. **GDPR Compliance**\n   - User can export all albums with media\n   - Album deletion includes cleanup of shares\n   - Soft delete with 30-day recovery\n\n---\n\n## Validation Rules\n\n### On Creation\n\n```yaml\ntitle:\n  - Minimum 1 character\n  - Maximum 500 characters\n  - Required\n\nalbum_type:\n  - Must be valid enum value\n  - Immutable after creation\n\nparent_album_id:\n  - Must exist and belong to same user\n  - Cannot create circular references\n  - Max nesting depth: 5\n\nsmart_criteria:\n  - Required if album_type = 'smart'\n  - Must be valid criteria object\n```\n\n### On Update\n\n```yaml\nimmutable_fields:\n  - id, user_id\n  - album_type\n  - created_at\n\nmutable_fields:\n  - title, description\n  - cover_media_id\n  - visibility, allow_downloads\n  - sort_order\n  - start_date, end_date\n\nconstraints:\n  - cover_media_id must reference media in album\n  - end_date >= start_date\n```\n\n---\n\n## Use Cases and Examples\n\n### Example 1: Manual Event Album\n\n```json\n{\n  \"id\": \"album-550e8400-e29b-41d4-a716-446655440000\",\n  \"user_id\": \"user-uuid\",\n  \"title\": \"Sarah's 30th Birthday Party\",\n  \"description\": \"Amazing celebration at the beach house\",\n  \"album_type\": \"manual\",\n  \"cover_media_id\": \"media-uuid\",\n  \"media_count\": 87,\n  \"start_date\": \"2024-06-15T18:00:00Z\",\n  \"end_date\": \"2024-06-15T23:59:59Z\",\n  \"visibility\": \"shared\",\n  \"allow_downloads\": true,\n  \"sort_order\": \"date_asc\",\n  \"created_at\": \"2024-06-16T10:00:00Z\",\n  \"updated_at\": \"2024-06-20T14:30:00Z\",\n  \"deleted_at\": null\n}\n```\n\n### Example 2: Smart Location-Based Album\n\n```json\n{\n  \"id\": \"album-660e8400-e29b-41d4-a716-446655440001\",\n  \"user_id\": \"user-uuid\",\n  \"title\": \"All Photos in Tokyo\",\n  \"album_type\": \"smart\",\n  \"media_count\": 342,\n  \"visibility\": \"private\",\n  \"sort_order\": \"date_desc\",\n  \"metadata\": {\n    \"smart_criteria\": {\n      \"location\": \"Tokyo\",\n      \"media_type\": [\"photo\"],\n      \"min_quality_score\": 0.7\n    }\n  },\n  \"created_at\": \"2024-07-01T09:00:00Z\",\n  \"updated_at\": \"2026-02-09T15:00:00Z\",\n  \"deleted_at\": null\n}\n```\n\n### Example 3: Imported Instagram Album\n\n```json\n{\n  \"id\": \"album-770e8400-e29b-41d4-a716-446655440002\",\n  \"user_id\": \"user-uuid\",\n  \"title\": \"Instagram: Highlights\",\n  \"album_type\": \"imported\",\n  \"media_count\": 24,\n  \"source_platform\": \"instagram\",\n  \"source_id\": \"instagram-album-123\",\n  \"integration_id\": \"integration-uuid\",\n  \"sync_enabled\": true,\n  \"visibility\": \"private\",\n  \"metadata\": {\n    \"platform\": {\n      \"instagram\": {\n        \"album_name\": \"Highlights\",\n        \"last_synced\": \"2026-02-09T10:00:00Z\"\n      }\n    }\n  },\n  \"created_at\": \"2025-01-10T12:00:00Z\",\n  \"updated_at\": \"2026-02-09T10:00:00Z\",\n  \"deleted_at\": null\n}\n```\n\n---\n\n## Lifecycle States\n\n### 1. Empty Album\n\n```yaml\nstate: \"empty\"\nmedia_count: 0\ncapabilities:\n  - Can add media\n  - Can set metadata\n  - Can delete without confirmation\ntransitions:\n  - add_media -> Active\n  - delete -> Deleted\n```\n\n### 2. Active Album\n\n```yaml\nstate: \"active\"\nmedia_count: > 0\ncapabilities:\n  - Add/remove media (manual albums)\n  - Share with users\n  - Export as ZIP\n  - Generate thumbnails\ntransitions:\n  - remove_all_media -> Empty\n  - delete -> Deleted\n```\n\n### 3. Syncing (Imported Albums)\n\n```yaml\nstate: \"syncing\"\nalbum_type: \"imported\"\nsync_enabled: true\nbehavior:\n  - Periodic sync with platform\n  - Auto-add new media\n  - Update metadata from platform\ntransitions:\n  - sync_complete -> Active\n  - disable_sync -> Static Imported\n```\n\n### 4. Deleted\n\n```yaml\nstate: \"deleted\"\ndeleted_at: not null\nbehavior:\n  - Album hidden from UI\n  - Media preserved (not deleted)\n  - 30-day recovery window\ntransitions:\n  - restore -> Active\n  - timeout -> Hard Deleted\n```\n\n---\n\n## Notes for Implementers\n\n### Performance Optimization\n\n1. **Denormalized Counts**\n   ```python\n   # Update media_count on media add/remove\n   album.media_count = len(album.media)\n   # Avoid COUNT queries in listings\n   ```\n\n2. **Smart Album Updates**\n   ```python\n   # Rebuild smart albums asynchronously\n   # Schedule: When media added/updated\n   # Rate limit: Max once per 5 minutes per album\n   ```\n\n3. **Thumbnail Generation**\n   - Use cover_media thumbnail as album thumbnail\n   - Cache album thumbnails with CDN\n   - Generate collage thumbnails (4 media) for better preview\n\n### Smart Album Implementation\n\n```python\ndef populate_smart_album(album):\n    \"\"\"Populate smart album based on criteria\"\"\"\n    criteria = album.metadata.get('smart_criteria', {})\n\n    query = Media.query.filter_by(user_id=album.user_id)\n\n    if 'media_type' in criteria:\n        query = query.filter(Media.media_type.in_(criteria['media_type']))\n\n    if 'location' in criteria:\n        query = query.filter(Media.location_name.ilike(f\"%{criteria['location']}%\"))\n\n    if 'tags' in criteria:\n        for tag in criteria['tags']:\n            query = query.filter(Media.tags.contains([tag]))\n\n    if 'date_range' in criteria:\n        query = query.filter(\n            Media.taken_at >= criteria['date_range']['start'],\n            Media.taken_at <= criteria['date_range']['end']\n        )\n\n    # Clear existing and add matching media\n    album.media = query.all()\n    album.media_count = len(album.media)\n```\n\n---\n\n**Status:** Active - Core Media Type\n**Version:** 1.0\n**Authority:** 0.0.2 - Media Types\n**Created:** 2026-02-09\n**Owner:** Hypernet Core (0.*)\n"
  },
  "created_at": "2026-02-15T11:54:04.716636+00:00",
  "updated_at": "2026-02-15T11:54:04.716636+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:0.0.2.2-ALBUM.md"
}