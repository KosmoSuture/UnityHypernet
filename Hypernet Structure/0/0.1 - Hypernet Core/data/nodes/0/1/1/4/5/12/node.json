{
  "address": "0.1.1.4.5.12",
  "type_address": null,
  "data": {
    "name": "social_accounts.py",
    "type": "file",
    "extension": ".py",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\routes\\social_accounts.py",
    "size": 8788,
    "content": "\"\"\"\nSocial Accounts Routes\n\nEndpoints for managing social media account profiles.\n\"\"\"\n\nfrom fastapi import APIRouter, Depends, HTTPException, status, Query\nfrom sqlalchemy.orm import Session\nfrom sqlalchemy import and_\nfrom pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Optional, List\nfrom uuid import UUID\n\nfrom app.core.database import get_db\nfrom app.core.dependencies import get_current_user\nfrom app.models.user import User\nfrom app.models.social_account import SocialAccount\n\nrouter = APIRouter()\n\n\n# Request/Response Models\nclass SocialAccountCreate(BaseModel):\n    \"\"\"Social account creation request\"\"\"\n    platform: str = Field(..., description=\"instagram, twitter, facebook, tiktok, linkedin\")\n    username: str = Field(..., max_length=100)\n    account_type: str = Field(..., description=\"own, following, other\")\n    display_name: Optional[str] = Field(None, max_length=200)\n    bio: Optional[str] = None\n    profile_url: Optional[str] = Field(None, max_length=500)\n    profile_photo_url: Optional[str] = Field(None, max_length=500)\n    followers_count: Optional[int] = Field(None, ge=0)\n    following_count: Optional[int] = Field(None, ge=0)\n    posts_count: Optional[int] = Field(None, ge=0)\n    is_verified: bool = Field(default=False)\n\n\nclass SocialAccountUpdate(BaseModel):\n    \"\"\"Social account update request\"\"\"\n    display_name: Optional[str] = Field(None, max_length=200)\n    bio: Optional[str] = None\n    profile_url: Optional[str] = Field(None, max_length=500)\n    profile_photo_url: Optional[str] = Field(None, max_length=500)\n    followers_count: Optional[int] = Field(None, ge=0)\n    following_count: Optional[int] = Field(None, ge=0)\n    posts_count: Optional[int] = Field(None, ge=0)\n    is_verified: Optional[bool] = None\n\n\nclass SocialAccountResponse(BaseModel):\n    \"\"\"Social account response\"\"\"\n    id: str\n    user_id: str\n    platform: str\n    username: str\n    account_type: str\n    display_name: Optional[str]\n    bio: Optional[str]\n    profile_url: Optional[str]\n    profile_photo_url: Optional[str]\n    followers_count: Optional[int]\n    following_count: Optional[int]\n    posts_count: Optional[int]\n    is_verified: bool\n    created_at: datetime\n    updated_at: datetime\n\n    class Config:\n        from_attributes = True\n\n\nclass SocialAccountListResponse(BaseModel):\n    \"\"\"Paginated social account list response\"\"\"\n    items: List[SocialAccountResponse]\n    total: int\n    page: int\n    page_size: int\n\n\n@router.post(\"\", response_model=SocialAccountResponse, status_code=status.HTTP_201_CREATED)\nasync def create_social_account(\n    request: SocialAccountCreate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    Create a new social account record.\n\n    - **platform**: instagram, twitter, facebook, tiktok, linkedin (required)\n    - **username**: Account username/handle (required)\n    - **account_type**: own, following, other (required)\n    - **display_name**: Display name on the platform\n    - **bio**: Account bio/description\n    - **followers_count**: Number of followers\n    - **following_count**: Number of accounts following\n    \"\"\"\n    account = SocialAccount(\n        user_id=current_user.id,\n        platform=request.platform,\n        username=request.username,\n        account_type=request.account_type,\n        display_name=request.display_name,\n        bio=request.bio,\n        profile_url=request.profile_url,\n        profile_photo_url=request.profile_photo_url,\n        followers_count=request.followers_count,\n        following_count=request.following_count,\n        posts_count=request.posts_count,\n        is_verified=request.is_verified\n    )\n\n    db.add(account)\n    db.commit()\n    db.refresh(account)\n\n    return SocialAccountResponse.model_validate(account)\n\n\n@router.get(\"\", response_model=SocialAccountListResponse)\nasync def list_social_accounts(\n    platform: Optional[str] = Query(None, description=\"Filter by platform\"),\n    account_type: Optional[str] = Query(None, description=\"Filter by account type\"),\n    is_verified: Optional[bool] = Query(None, description=\"Filter verified accounts\"),\n    page: int = Query(1, ge=1),\n    page_size: int = Query(50, ge=1, le=100),\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    List social accounts for the current user.\n\n    Supports:\n    - Filter by platform (instagram, twitter, facebook, tiktok, linkedin)\n    - Filter by account_type (own, following, other)\n    - Filter verified accounts\n    - Pagination\n\n    Results ordered by platform, then username.\n    \"\"\"\n    query = db.query(SocialAccount).filter(\n        and_(\n            SocialAccount.user_id == current_user.id,\n            SocialAccount.deleted_at.is_(None)\n        )\n    )\n\n    if platform:\n        query = query.filter(SocialAccount.platform == platform)\n\n    if account_type:\n        query = query.filter(SocialAccount.account_type == account_type)\n\n    if is_verified is not None:\n        query = query.filter(SocialAccount.is_verified == is_verified)\n\n    total = query.count()\n\n    offset = (page - 1) * page_size\n    items = query.order_by(\n        SocialAccount.platform.asc(),\n        SocialAccount.username.asc()\n    ).offset(offset).limit(page_size).all()\n\n    return SocialAccountListResponse(\n        items=[SocialAccountResponse.model_validate(item) for item in items],\n        total=total,\n        page=page,\n        page_size=page_size\n    )\n\n\n@router.get(\"/{account_id}\", response_model=SocialAccountResponse)\nasync def get_social_account(\n    account_id: UUID,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"Get a specific social account by ID.\"\"\"\n    account = db.query(SocialAccount).filter(\n        and_(\n            SocialAccount.id == account_id,\n            SocialAccount.user_id == current_user.id,\n            SocialAccount.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not account:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Social account not found\"\n        )\n\n    return SocialAccountResponse.model_validate(account)\n\n\n@router.patch(\"/{account_id}\", response_model=SocialAccountResponse)\nasync def update_social_account(\n    account_id: UUID,\n    request: SocialAccountUpdate,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"\n    Update social account metadata.\n\n    Typically used to update follower counts and profile information\n    when syncing from the platform.\n    \"\"\"\n    account = db.query(SocialAccount).filter(\n        and_(\n            SocialAccount.id == account_id,\n            SocialAccount.user_id == current_user.id,\n            SocialAccount.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not account:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Social account not found\"\n        )\n\n    if request.display_name is not None:\n        account.display_name = request.display_name\n    if request.bio is not None:\n        account.bio = request.bio\n    if request.profile_url is not None:\n        account.profile_url = request.profile_url\n    if request.profile_photo_url is not None:\n        account.profile_photo_url = request.profile_photo_url\n    if request.followers_count is not None:\n        account.followers_count = request.followers_count\n    if request.following_count is not None:\n        account.following_count = request.following_count\n    if request.posts_count is not None:\n        account.posts_count = request.posts_count\n    if request.is_verified is not None:\n        account.is_verified = request.is_verified\n\n    db.commit()\n    db.refresh(account)\n\n    return SocialAccountResponse.model_validate(account)\n\n\n@router.delete(\"/{account_id}\", status_code=status.HTTP_204_NO_CONTENT)\nasync def delete_social_account(\n    account_id: UUID,\n    db: Session = Depends(get_db),\n    current_user: User = Depends(get_current_user)\n):\n    \"\"\"Soft delete a social account.\"\"\"\n    account = db.query(SocialAccount).filter(\n        and_(\n            SocialAccount.id == account_id,\n            SocialAccount.user_id == current_user.id,\n            SocialAccount.deleted_at.is_(None)\n        )\n    ).first()\n\n    if not account:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Social account not found\"\n        )\n\n    account.soft_delete()\n    db.commit()\n\n    return None\n"
  },
  "created_at": "2026-02-15T11:53:48.534137+00:00",
  "updated_at": "2026-02-15T11:53:48.534137+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:social_accounts.py"
}