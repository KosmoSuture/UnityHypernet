{
  "address": "0.1.1.9.4.8",
  "type_address": null,
  "data": {
    "name": "integration.py",
    "type": "file",
    "extension": ".py",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\0.1.1 - Core System\\app\\models\\integration.py",
    "size": 4139,
    "content": "\"\"\"\nIntegration Models\n\nSQLAlchemy models for integrations and integration_secrets tables.\n\nImplements: 0.0.1 - Core Types / Integration.md\n\"\"\"\n\nfrom sqlalchemy import Column, String, Text, Integer, Boolean, DateTime, ForeignKey, CheckConstraint, func\nfrom sqlalchemy.dialects.postgresql import UUID\nfrom sqlalchemy.orm import relationship\n\nfrom app.models.base import OwnedObject, BaseObject\n\n\nclass Integration(OwnedObject):\n    \"\"\"\n    Connected external services (Instagram, Google Photos, Gmail, etc.).\n\n    Manages OAuth2 connections and sync state for external integrations.\n    \"\"\"\n\n    __tablename__ = \"integrations\"\n\n    # Integration Details (Required)\n    integration_type = Column(\n        String(50),\n        nullable=False,\n        index=True,\n        doc=\"Integration type: instagram, google_photos, gmail, dropbox, etc.\"\n    )\n\n    integration_name = Column(\n        String(200),\n        nullable=False,\n        doc=\"User-friendly name (e.g., 'My Instagram', 'Work Gmail')\"\n    )\n\n    status = Column(\n        String(50),\n        nullable=False,\n        default='pending',\n        index=True,\n        doc=\"Status: pending, connected, disconnected, error\"\n    )\n\n    # OAuth2 (Optional)\n    token_expires_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"When access token expires (NULL if doesn't expire)\"\n    )\n\n    # Sync State (Optional)\n    last_sync_at = Column(\n        DateTime(timezone=True),\n        nullable=True,\n        doc=\"Last successful sync timestamp\"\n    )\n\n    last_sync_status = Column(\n        String(50),\n        nullable=True,\n        doc=\"Last sync status: success, partial, failed\"\n    )\n\n    sync_cursor = Column(\n        Text,\n        nullable=True,\n        doc=\"Pagination cursor for incremental sync (platform-specific)\"\n    )\n\n    items_synced = Column(\n        Integer,\n        nullable=False,\n        default=0,\n        doc=\"Total items imported from this integration\"\n    )\n\n    # Status (Optional)\n    is_enabled = Column(\n        Boolean,\n        nullable=False,\n        default=True,\n        doc=\"User can disable without deleting\"\n    )\n\n    # Relationships\n    user = relationship(\"User\", back_populates=\"integrations\", foreign_keys=[OwnedObject.user_id])\n    secrets = relationship(\"IntegrationSecret\", back_populates=\"integration\", uselist=False, cascade=\"all, delete-orphan\")\n\n    # Constraints\n    __table_args__ = (\n        CheckConstraint(\n            \"status IN ('pending', 'connected', 'disconnected', 'error')\",\n            name='chk_integration_status'\n        ),\n        CheckConstraint(\n            \"last_sync_status IS NULL OR last_sync_status IN ('success', 'partial', 'failed')\",\n            name='chk_sync_status'\n        ),\n        CheckConstraint(\n            \"items_synced >= 0\",\n            name='chk_items_synced'\n        ),\n    )\n\n    def __repr__(self):\n        return f\"<Integration(id={self.id}, type={self.integration_type}, name={self.integration_name})>\"\n\n\nclass IntegrationSecret(BaseObject):\n    \"\"\"\n    OAuth tokens and secrets for integrations.\n\n    Stored separately for security. Should be encrypted at rest.\n    One-to-one relationship with Integration.\n    \"\"\"\n\n    __tablename__ = \"integration_secrets\"\n\n    # Foreign key to integration (one-to-one)\n    integration_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey(\"integrations.id\", ondelete=\"CASCADE\"),\n        unique=True,\n        nullable=False,\n        index=True,\n        doc=\"Integration this secret belongs to\"\n    )\n\n    # OAuth2 Tokens (should be encrypted at rest)\n    access_token = Column(\n        Text,\n        nullable=True,\n        doc=\"OAuth2 access token (encrypted)\"\n    )\n\n    refresh_token = Column(\n        Text,\n        nullable=True,\n        doc=\"OAuth2 refresh token (encrypted)\"\n    )\n\n    # Relationships\n    integration = relationship(\"Integration\", back_populates=\"secrets\")\n\n    def __repr__(self):\n        return f\"<IntegrationSecret(integration_id={self.integration_id})>\"\n"
  },
  "created_at": "2026-02-17T01:21:58.582684+00:00",
  "updated_at": "2026-02-17T01:21:58.582684+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:integration.py"
}