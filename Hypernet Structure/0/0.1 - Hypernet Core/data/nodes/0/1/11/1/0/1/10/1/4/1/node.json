{
  "address": "0.1.11.1.0.1.10.1.4.1",
  "type_address": null,
  "data": {
    "name": "v0001.json",
    "type": "file",
    "extension": ".json",
    "path": "C:\\Hypernet\\Hypernet Structure\\0\\0.1 - Hypernet Core\\data\\history\\0\\1\\10\\1\\4\\v0001.json",
    "size": 12131,
    "content": "{\n  \"version\": 1,\n  \"content_hash\": \"ef79fe82644548f5\",\n  \"snapshot_at\": \"2026-02-17T01:22:00.421737+00:00\",\n  \"node\": {\n    \"address\": \"0.1.10.1.4\",\n    \"type_address\": null,\n    \"data\": {\n      \"name\": \"health_records.py\",\n      \"type\": \"file\",\n      \"extension\": \".py\",\n      \"path\": \"C:\\\\Hypernet\\\\Hypernet Structure\\\\0\\\\0.1 - Hypernet Core\\\\app\\\\routes\\\\health_records.py\",\n      \"size\": 11363,\n      \"content\": \"\\\"\\\"\\\"\\nHealth Records API Routes\\n\\nProvides CRUD operations for health and medical record management\\nincluding appointments, medications, measurements, and medical history.\\n\\\"\\\"\\\"\\n\\nfrom fastapi import APIRouter, Depends, HTTPException, Query, status\\nfrom sqlalchemy.orm import Session\\nfrom sqlalchemy import and_, or_\\nfrom typing import Optional, List\\nfrom datetime import datetime, date\\nfrom uuid import UUID\\nfrom decimal import Decimal\\nfrom pydantic import BaseModel, Field\\n\\nfrom app.core.database import get_db\\nfrom app.core.dependencies import get_current_user\\nfrom app.models.user import User\\nfrom app.models.health_record import HealthRecord\\n\\n\\nrouter = APIRouter()\\n\\n\\n# Pydantic Models for Request/Response\\nclass HealthRecordCreate(BaseModel):\\n    record_type: str = Field(..., description=\\\"appointment, medication, lab_result, vital_sign, diagnosis, immunization, allergy, procedure, other\\\")\\n    record_date: datetime\\n    provider_name: Optional[str] = Field(None, max_length=300)\\n    facility_name: Optional[str] = Field(None, max_length=300)\\n    description: Optional[str] = Field(None, max_length=1000)\\n    diagnosis_codes: List[str] = Field(default_factory=list)\\n    medication_name: Optional[str] = Field(None, max_length=300)\\n    dosage: Optional[str] = Field(None, max_length=200)\\n    frequency: Optional[str] = Field(None, max_length=200)\\n    measurement_type: Optional[str] = Field(None, max_length=100, description=\\\"e.g., blood_pressure, weight, temperature, heart_rate\\\")\\n    measurement_value: Optional[str] = Field(None, max_length=100)\\n    measurement_unit: Optional[str] = Field(None, max_length=50)\\n    file_paths: List[str] = Field(default_factory=list)\\n    is_important: bool = Field(default=False)\\n    notes: Optional[str] = None\\n\\n\\nclass HealthRecordUpdate(BaseModel):\\n    description: Optional[str] = Field(None, max_length=1000)\\n    diagnosis_codes: Optional[List[str]] = None\\n    medication_name: Optional[str] = Field(None, max_length=300)\\n    dosage: Optional[str] = Field(None, max_length=200)\\n    frequency: Optional[str] = Field(None, max_length=200)\\n    is_important: Optional[bool] = None\\n    notes: Optional[str] = None\\n\\n\\nclass HealthRecordResponse(BaseModel):\\n    id: UUID\\n    user_id: UUID\\n    record_type: str\\n    record_date: datetime\\n    provider_name: Optional[str]\\n    facility_name: Optional[str]\\n    description: Optional[str]\\n    diagnosis_codes: List[str]\\n    medication_name: Optional[str]\\n    dosage: Optional[str]\\n    frequency: Optional[str]\\n    measurement_type: Optional[str]\\n    measurement_value: Optional[str]\\n    measurement_unit: Optional[str]\\n    file_paths: List[str]\\n    is_important: bool\\n    notes: Optional[str]\\n    created_at: datetime\\n    updated_at: datetime\\n\\n    class Config:\\n        from_attributes = True\\n\\n\\nclass HealthRecordListResponse(BaseModel):\\n    items: List[HealthRecordResponse]\\n    total: int\\n    page: int\\n    page_size: int\\n    pages: int\\n\\n\\n# Endpoints\\n@router.post(\\\"\\\", response_model=HealthRecordResponse, status_code=status.HTTP_201_CREATED)\\nasync def create_health_record(\\n    record_data: HealthRecordCreate,\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Create a new health record.\\\"\\\"\\\"\\n    record = HealthRecord(\\n        user_id=current_user.id,\\n        **record_data.dict()\\n    )\\n    db.add(record)\\n    db.commit()\\n    db.refresh(record)\\n    return record\\n\\n\\n@router.get(\\\"\\\", response_model=HealthRecordListResponse)\\nasync def list_health_records(\\n    record_type: Optional[str] = Query(None, description=\\\"Filter by record type\\\"),\\n    provider_name: Optional[str] = Query(None, description=\\\"Filter by provider\\\"),\\n    facility_name: Optional[str] = Query(None, description=\\\"Filter by facility\\\"),\\n    measurement_type: Optional[str] = Query(None, description=\\\"Filter by measurement type\\\"),\\n    is_important: Optional[bool] = Query(None, description=\\\"Filter important records\\\"),\\n    start_date: Optional[date] = Query(None, description=\\\"Start date (YYYY-MM-DD)\\\"),\\n    end_date: Optional[date] = Query(None, description=\\\"End date (YYYY-MM-DD)\\\"),\\n    search: Optional[str] = Query(None, description=\\\"Search in description, medication, notes\\\"),\\n    page: int = Query(1, ge=1, description=\\\"Page number\\\"),\\n    page_size: int = Query(50, ge=1, le=100, description=\\\"Items per page\\\"),\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"List health records with optional filtering.\\\"\\\"\\\"\\n    query = db.query(HealthRecord).filter(\\n        and_(\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None)\\n        )\\n    )\\n\\n    if record_type:\\n        query = query.filter(HealthRecord.record_type == record_type)\\n\\n    if provider_name:\\n        query = query.filter(HealthRecord.provider_name.ilike(f\\\"%{provider_name}%\\\"))\\n\\n    if facility_name:\\n        query = query.filter(HealthRecord.facility_name.ilike(f\\\"%{facility_name}%\\\"))\\n\\n    if measurement_type:\\n        query = query.filter(HealthRecord.measurement_type == measurement_type)\\n\\n    if is_important is not None:\\n        query = query.filter(HealthRecord.is_important == is_important)\\n\\n    if start_date:\\n        query = query.filter(HealthRecord.record_date >= datetime.combine(start_date, datetime.min.time()))\\n\\n    if end_date:\\n        query = query.filter(HealthRecord.record_date <= datetime.combine(end_date, datetime.max.time()))\\n\\n    if search:\\n        search_pattern = f\\\"%{search}%\\\"\\n        query = query.filter(\\n            or_(\\n                HealthRecord.description.ilike(search_pattern),\\n                HealthRecord.medication_name.ilike(search_pattern),\\n                HealthRecord.notes.ilike(search_pattern)\\n            )\\n        )\\n\\n    total = query.count()\\n\\n    # Order by importance, then record_date descending\\n    query = query.order_by(\\n        HealthRecord.is_important.desc(),\\n        HealthRecord.record_date.desc()\\n    )\\n\\n    offset = (page - 1) * page_size\\n    items = query.offset(offset).limit(page_size).all()\\n\\n    pages = (total + page_size - 1) // page_size\\n\\n    return HealthRecordListResponse(\\n        items=items,\\n        total=total,\\n        page=page,\\n        page_size=page_size,\\n        pages=pages\\n    )\\n\\n\\n@router.get(\\\"/medications\\\", response_model=HealthRecordListResponse)\\nasync def list_medications(\\n    active_only: bool = Query(True, description=\\\"Only show current medications\\\"),\\n    page: int = Query(1, ge=1, description=\\\"Page number\\\"),\\n    page_size: int = Query(50, ge=1, le=100, description=\\\"Items per page\\\"),\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"List medications with special focus on active prescriptions.\\\"\\\"\\\"\\n    query = db.query(HealthRecord).filter(\\n        and_(\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None),\\n            HealthRecord.record_type == 'medication'\\n        )\\n    )\\n\\n    if active_only:\\n        # Consider medication active if record_date is within last 90 days\\n        from datetime import timedelta\\n        cutoff_date = datetime.utcnow() - timedelta(days=90)\\n        query = query.filter(HealthRecord.record_date >= cutoff_date)\\n\\n    total = query.count()\\n\\n    query = query.order_by(HealthRecord.record_date.desc())\\n\\n    offset = (page - 1) * page_size\\n    items = query.offset(offset).limit(page_size).all()\\n\\n    pages = (total + page_size - 1) // page_size\\n\\n    return HealthRecordListResponse(\\n        items=items,\\n        total=total,\\n        page=page,\\n        page_size=page_size,\\n        pages=pages\\n    )\\n\\n\\n@router.get(\\\"/providers\\\", response_model=List[str])\\nasync def list_providers(\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get all unique provider names from user's health records.\\\"\\\"\\\"\\n    providers = db.query(HealthRecord.provider_name).filter(\\n        and_(\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None),\\n            HealthRecord.provider_name.isnot(None)\\n        )\\n    ).distinct().order_by(HealthRecord.provider_name).all()\\n\\n    return [provider[0] for provider in providers if provider[0]]\\n\\n\\n@router.get(\\\"/facilities\\\", response_model=List[str])\\nasync def list_facilities(\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get all unique facility names from user's health records.\\\"\\\"\\\"\\n    facilities = db.query(HealthRecord.facility_name).filter(\\n        and_(\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None),\\n            HealthRecord.facility_name.isnot(None)\\n        )\\n    ).distinct().order_by(HealthRecord.facility_name).all()\\n\\n    return [facility[0] for facility in facilities if facility[0]]\\n\\n\\n@router.get(\\\"/{record_id}\\\", response_model=HealthRecordResponse)\\nasync def get_health_record(\\n    record_id: UUID,\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Get a specific health record by ID.\\\"\\\"\\\"\\n    record = db.query(HealthRecord).filter(\\n        and_(\\n            HealthRecord.id == record_id,\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None)\\n        )\\n    ).first()\\n\\n    if not record:\\n        raise HTTPException(\\n            status_code=status.HTTP_404_NOT_FOUND,\\n            detail=\\\"Health record not found\\\"\\n        )\\n\\n    return record\\n\\n\\n@router.patch(\\\"/{record_id}\\\", response_model=HealthRecordResponse)\\nasync def update_health_record(\\n    record_id: UUID,\\n    record_data: HealthRecordUpdate,\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Update a health record's metadata.\\\"\\\"\\\"\\n    record = db.query(HealthRecord).filter(\\n        and_(\\n            HealthRecord.id == record_id,\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None)\\n        )\\n    ).first()\\n\\n    if not record:\\n        raise HTTPException(\\n            status_code=status.HTTP_404_NOT_FOUND,\\n            detail=\\\"Health record not found\\\"\\n        )\\n\\n    update_data = record_data.dict(exclude_unset=True)\\n    for field, value in update_data.items():\\n        setattr(record, field, value)\\n\\n    record.updated_at = datetime.utcnow()\\n    db.commit()\\n    db.refresh(record)\\n\\n    return record\\n\\n\\n@router.delete(\\\"/{record_id}\\\", status_code=status.HTTP_204_NO_CONTENT)\\nasync def delete_health_record(\\n    record_id: UUID,\\n    db: Session = Depends(get_db),\\n    current_user: User = Depends(get_current_user)\\n):\\n    \\\"\\\"\\\"Soft delete a health record.\\\"\\\"\\\"\\n    record = db.query(HealthRecord).filter(\\n        and_(\\n            HealthRecord.id == record_id,\\n            HealthRecord.user_id == current_user.id,\\n            HealthRecord.deleted_at.is_(None)\\n        )\\n    ).first()\\n\\n    if not record:\\n        raise HTTPException(\\n            status_code=status.HTTP_404_NOT_FOUND,\\n            detail=\\\"Health record not found\\\"\\n        )\\n\\n    record.deleted_at = datetime.utcnow()\\n    db.commit()\\n\\n    return None\\n\"\n    },\n    \"created_at\": \"2026-02-17T01:20:05.383122+00:00\",\n    \"updated_at\": \"2026-02-17T01:20:05.383122+00:00\",\n    \"deleted_at\": null,\n    \"source_type\": \"import\",\n    \"source_id\": \"file:health_records.py\"\n  }\n}"
  },
  "created_at": "2026-02-17T01:22:02.172490+00:00",
  "updated_at": "2026-02-17T01:22:02.172490+00:00",
  "deleted_at": null,
  "source_type": "import",
  "source_id": "file:v0001.json"
}