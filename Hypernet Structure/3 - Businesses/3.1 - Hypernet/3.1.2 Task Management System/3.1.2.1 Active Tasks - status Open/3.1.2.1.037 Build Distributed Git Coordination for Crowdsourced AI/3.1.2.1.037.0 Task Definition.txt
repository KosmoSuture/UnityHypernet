================================================================================
TASK OBJECT: 3.1.2.1.037 - Build Distributed Git Coordination for Crowdsourced AI
================================================================================

-------------------------------------------------------------------------------
GENERAL METADATA
-------------------------------------------------------------------------------
Hypernet Address:       3.1.2.1.037
Task ID:                TASK-037
Created Date/Time:      2026-02-18 09:00:00 UTC
Created By:             Matt (1.1) / Documented by C3 (2.1)
Status:                 Open
Priority:               Critical
Tags/Keywords:          git, distributed, concurrency, record-locking, crowdsource,
                        collaboration, merge, conflict-resolution, batch-upload

-------------------------------------------------------------------------------
TASK-SPECIFIC METADATA
-------------------------------------------------------------------------------
Title:                  Build Distributed Git Coordination for Crowdsourced AI

Description:            Build the infrastructure that lets unlimited independent
                        contributors run AI swarms locally and push work to the
                        shared GitHub repository without conflicts or data loss.

                        This is the world's first open-sourced/crowdsourced/AI
                        project: anyone downloads the code, plugs in their own
                        API keys and GitHub account, runs AI workers locally,
                        and uploads work as batches. The system must handle
                        hundreds of simultaneous contributors pushing to the
                        same repo.

                        Core challenges:
                        - Record locking across distributed contributors
                        - Merge conflict prevention and resolution
                        - Address allocation without collisions
                        - Task claiming without duplication
                        - Index coherence across pull/push cycles
                        - Git push/pull coordination and retry logic

                        From Matt: "We are going to really push Github to the
                        limit and need to come up with a way to handle record
                        locking while trying to use Github as real-time as
                        possible."

                        "I believe I can claim that this is the world's first
                        Open Sourced/Crowdsourced/AI project in history. The
                        first anywhere, where a person can download code, plug
                        in API keys and Github account, doing work locally
                        uploaded as batches. And then unlimited numbers of
                        people could run all the AIs they wanted with very
                        little effort."

Estimated Hours:        80

Actual Hours:           4 (FileLock and LockManager built for local concurrency)

Skills Required:
  - Git internals and conflict resolution
  - Distributed systems design
  - Concurrency control patterns
  - API design (GitHub API)
  - Data modeling (address allocation)

Deliverables:
  1. Local concurrency layer (DONE)
     - FileLock with PID tracking and stale detection
     - LockManager with node_lock, index_lock, git_lock, link_lock
     - Integrated into Store.put_node(), put_link(), delete_node()
     - All 26 tests passing

  2. Git batch coordinator
     - Automated git pull before work, push after batch
     - Retry logic with exponential backoff on push conflicts
     - Auto-rebase or merge strategy selection
     - Batch size limits (don't push 10,000 files at once)
     - Progress reporting during push/pull

  3. Distributed address allocation
     - Address reservation system (claim before create)
     - Per-contributor address ranges or namespaced allocation
     - Collision detection on pull (two contributors created same address)
     - Automatic renumbering for instance addresses
     - Reservation expiry (claimed but never created)

  4. Distributed task claiming
     - Task claim files in git (lightweight, mergeable)
     - Claim-on-push: claim locally, verify on push
     - Conflict: if two contributors claim same task, first push wins
     - Stale claim detection (claimed but no progress)
     - Task status sync on pull

  5. Index merge strategy
     - Indexes rebuilt from source files (not merged as JSON)
     - Index rebuild on pull (fast, handles any conflict)
     - Incremental index updates during local work
     - Index validation (detect corruption)

  6. Contributor onboarding automation
     - `python -m hypernet.setup` — one-command setup
     - Prompts for: API key, GitHub username, preferred model
     - Creates secrets/config.json from template
     - Sets up git remote if needed
     - Runs first pull and index build
     - Validates everything works with a mock swarm tick

  7. Conflict resolution framework
     - Auto-resolve: non-overlapping changes merge cleanly
     - Node conflicts: latest timestamp wins (with history preserved)
     - Link conflicts: both links kept (links are append-only)
     - Index conflicts: rebuild from source (never merge indexes)
     - Task conflicts: first claimer wins, second gets reassigned
     - Manual resolution queue for true conflicts

Acceptance Criteria:
  - [ ] Two independent contributors can push simultaneously without data loss
  - [ ] Address collisions are detected and resolved automatically
  - [ ] Task double-claiming is prevented or resolved cleanly
  - [ ] Indexes remain coherent after any merge
  - [ ] New contributor can go from git clone to running swarm in < 5 minutes
  - [ ] Push failures retry automatically with conflict resolution
  - [ ] Works on Windows, macOS, and Linux

Due Date:               [TBD — Critical priority]

Budget:
  - Primarily team hours: 80+

-------------------------------------------------------------------------------
RELATIONSHIP LINKS
-------------------------------------------------------------------------------
Assigned To:            [Unassigned]

Upstream Dependencies:
  - 3.1.2.1.032 Universal Addressing (addresses must be stable)
  - 3.1.2.1.025 Scale Self-Organizing AI Swarm (swarm must exist)
  - store.py LockManager (DONE — local concurrency layer)

Downstream Dependents:
  - 3.1.2.1.026 Human Project Organization (onboarding depends on this)
  - 3.1.2.1.012 Contributor Onboarding System
  - All crowdsourced development at scale

Related Documents:
  - hypernet/store.py (FileLock, LockManager)
  - hypernet/swarm.py (build_swarm, state persistence)
  - hypernet/tasks.py (TaskQueue, claiming)

Parent Task:            None (Top-level task)

-------------------------------------------------------------------------------
TRACKING DATA
-------------------------------------------------------------------------------
Activity Log:
  [2026-02-18] Task created from Matt's directive about Git record locking
  [2026-02-18] Local concurrency layer completed (FileLock, LockManager)

Comments/Updates:
  - This is the critical infrastructure for the crowdsourced model
  - Git's batch nature (pull/work/push) is an advantage, not a limitation
  - The index rebuild strategy avoids the hardest merge problems
  - Address allocation is the trickiest part — needs careful design
  - Consider GitHub Actions for server-side validation on push
  - Rate limiting: GitHub API has limits, batch pushes carefully
  - The setup experience must be dead simple — "5 minutes to running"

File Attachments:       None

Status Change History:
  [2026-02-18] Status: Created -> Open

================================================================================
SWARM DECOMPOSITION HINTS
================================================================================
SUBTASK-037.1: Design distributed address allocation protocol
  Tags: [architecture, docs]
  Priority: Critical
  Notes: Address ranges per contributor? Namespace prefixes? Reservation files?

SUBTASK-037.2: Build git batch coordinator (pull/push/retry/rebase)
  Tags: [code]
  Priority: High
  Blocked by: 037.1

SUBTASK-037.3: Implement distributed task claiming via git
  Tags: [code]
  Priority: High
  Blocked by: 037.1

SUBTASK-037.4: Build index rebuild-on-pull system
  Tags: [code]
  Priority: High
  Notes: Indexes derived from source files, never merged as JSON

SUBTASK-037.5: Build conflict resolution framework
  Tags: [code, algorithm]
  Priority: High
  Blocked by: 037.2, 037.3, 037.4

SUBTASK-037.6: Create contributor onboarding CLI (python -m hypernet.setup)
  Tags: [code, ux]
  Priority: Medium
  Blocked by: 037.2

SUBTASK-037.7: Write integration tests (multi-contributor simulation)
  Tags: [code, testing]
  Priority: Medium
  Blocked by: 037.2, 037.3, 037.5

SUBTASK-037.8: Document the contributor workflow end-to-end
  Tags: [docs]
  Priority: Medium
  Blocked by: 037.6
================================================================================
